# Grafana Tempo Community Call 2024-12-12

Join our next Tempo community call ...

Published on 2024-12-12T20:12:05Z

URL: https://www.youtube.com/watch?v=mVYlmOpJF7Q

Transcript: all right uh welcome to Temple Community call December 2024 last one of the year last and best we should have done a top 10 things this year wow totally missed that maybe we'll do that in January uh December 2024 Edition um we have a somewhat short agenda but I'll point out that at the end we've added AMA it's always open for questions but kind of explicitly if you have questions about operating Tempo or about any of the things that are going on in our world or future plans this is a great Forum to ask you have direct access to the developers and you know people who work every day on this project um so this is a great a resource if you have some interest or any kind of questions so feel free to think of those as we go through the agenda um you're welcome to post them in chat towards the end or unmute and talk uh we take questions in all forms all right agenda the first thing on the agenda is uh we would like to deprecate the old block format that most of you probably don't even know exists we used to have a block format called V2 um and this format was used for Trace ID lookup only and we kept it in Tempo 2.0 because it is very efficient at Trace ID look up only uh we were aware of a few folks using it but as far as I'm aware that has ended and it there's a fair amount of code and Tempo now that's dedicated to keeping this older block format alive so I'm floating that idea here first will likely create an issue but um we are considering removing support for this in an upcoming release so uh I would be shocked does anybody know does anybody here even know V2 exists maybe that's a good question to start with and take this as a solid not even not even my own team members on this call no I heard rumor heard rumor it exists yeah okay it's somewhere in there Whispers behind the scenes uh so okay I don't think anybody knows this thing exists we would really like to remove it I think we're going to do what we normally do create an issue in the repo probably mention again in this call probably post it in slack do our best to get word out for folks who might actually care so if there is a person out there continuing to use this format they very much want it uh we can have a discussion with them to see how valuable it is to keep or maybe what what their needs are and if we can meet those without be to okay so I'm kind of glad nobody knows what it is because it might make our lives a whole lot easier all right so moving on to some of the last latest changes um the past month and honestly the past few months have been characterized internally by a lot of operational issues we've had tons of growth in our cloud and so a lot of the team's focuses on been improving performance and resource usage uh and operational concerns and Tempo um fixing bugs so I think 27's largely going to be a bug fixed release and the past month has been very much in that vein so I've got some links of some of the things we've been working on uh I I'll mention a few of these briefly but for the most part expect 27 to be faster use less resources um and fewer issues and I think we have a a small feature or two like I think we have a couple Trace ql uh additions but for the most part this is going to be a bug fix and performance Improvement release uh so you can see there uh we we realize that if compaction compactors if your compactors are unstable they can actually duplicate data uh they can recreate more data than they instead of dding data they create more data so we've put some code into to prevent that uh a lot of ingestor and Generator performance improvements from a lot of people on this call uh but you should see resource you should especially in memory go down on both of these processes and these are definitely our most memory hungry processes um we have switched to the Prometheus fast regex uh this means the behavior of the regex X's will change a bit this will be mentioned in the blog post and the change log and all the details release notes um but the Prometheus fast rig X anchors all regular Expressions uh and that means that this you do this right now in Tempo 26 uh it is a substring search in 27 that will be an exact match search because all reg X's will be anchored which means I'm going to get this wrong is it this or is it the reverse of this we are not seeing your screen Jo oh oh thank you I was typing in the agenda thanks AI appreciate that guy so uh let me bump up the font here a bit uh so I always mix these up the beginning and end of a regex is is this right is it dollar first or is it carrot first does nobody know first dang it I always mess that up okay um so your regex will be anchored so this right now just like you know attribute regx bar is a substring search it will become a fully anchored um uh search like this so they'll become exact match so if you want this Behavior if you want this subring search you're going to write something like this and there's I think some different variants of this but this would for inance search for the S Bar with you know any number of characters on either side any number of right symbols on either side so there will be a small uh change in Behavior there but I think it's going to be or it is a lot faster we know this in addition uh it will also play nicer with graan dashboards grafana dashboards are all built around Prometheus regex because they have those templated drop downs and you know you can select uh multi- selection kind of things and it's all built around the Prometheus style regexes so I think this will actually also make us you know more compliant and more predictable in the way we behave with uh Loki andir Prometheus and all these this like ecosystem of tools so uh this will be a nice Improvement in 27 uh Trace metrics bug we fixed a few of them but this one created strange spikes about 30 minutes before now where it double count a few spans and that's a nice fix and I think there's a couple other Trace ql style fixes in there I think we're always fixing something with Trace ql um and then Kim you've got some information about the docs do you want to chat about that sure we had uh we updated the templa distributed Helm chart documentation and some values for the helm chart to add information about global overrides and tenant based overrides there's there was some comments in the community that this was very confusing we had six or seven open issues so hopefully these updates will add add those things cool thank you uh yeah I think you're right there was a fair amount of confusion about how to configure this correctly and what the meaning of some of the stuff in the value zul is and Kim and heds worked on an ice PR to just increase improve the comments around these fields to improve like understanding hopefully and help people operate Tempo thank you very good uh 2.7 so we mentioned a few things that we've worked on the past month those will obviously all be into .7 as will the past three months or so of work uh if we look at the change log it's gotten kind of ridiculously long to pavo's question this is going to happen next month so we are talking about doing it now uh but with the holidays and people on and off it'd be kind of difficult we feel like to you know get it out and most people are probably not really concerned about rolling out a new version of tempo now so first thing when we get back in our seats in January we'll cut a 27 rc0 probably do the normal a week or so make sure that that's looking good uh and then cut the the full release 27 um if you pass you GL through the change log I mean lots and lots of performance improvements look at the enhancements list is quite long bug fixes like I said really expect a lot of uh like a like a less of a feature release more of a performance Improvement style release I do see like a trace ql um uh feature here instrumentation scope here so there are are some there are some features we've added but it's mostly like operational improvements uh to into Z I should talk about this should I should have mentioned this um I am G to put this in the agenda so we have by default removed grpc compression it is simple to reenable grp this impacts the read and the right path uh we were seeing heavy uh memory and CPU usage on certain queries in the query front end it was using gzip which is the default so the queries the queriers are passing back tons of jobs and if those jobs were large like in a metrics query then it was gzipping those and unzipping those in the front end and it was eating up a ton of CPU in the front end and memory on the right path we also saw uh significant uh CPU improvements for disabling so it was Snappy and we disabled it completely and our environments and we're seeing a significant performance Improvement there uh with CPU down in the Distributors so take a look at both those now some people might still prefer it we strongly uh strongly recommend Snappy over gzip gzip is a very uh memory and CPU hungry kind of compression and snappy is meant to be a balance between some kind of like very high compression and uh resource usage so uh the the pr mentions the uh the change log mentions this we'll mention it in the release notes and all the normal places uh but we are going with disabled by default we think it behaves the best uh but if you do if you are conscious of your bandwidth between your processes you might find that um Snappy is the better choice and this will be mentioned for sure cool and then pav I I answered this okay so January like first thing we're going to uh start working on two s expect a blog post I guess we're doing a video Bam are we doing a video this time maybe uh we'll try to do a video I think we're doing a video only a fam says so I'm G listening to her on this one uh and I think we're at the AMA we made it 15 minutes in we made it to to ask us um is is that AA anything and ask us anything so uh like I said this is a great Forum here you have a lot of folks who work on this project uh from docs operations coding every aspect you can imagine uh so if you have questions about performance or configuration or just road map uh whatever feel free to ask away H nothing nothing bet Marty's got a question what's up Mar how is uh everybody's Tempo clusters behaving cool yeah fantastically except where we accidentally almost scheduled a bunch of ingestor on arm nodes and it wouldn't have worked if we tried to move them back but we just sa ourselves this morning I still need to merge that we should probably do [Music] that oh something we did find this was an interesting find on our side uh we had a number of nodes and this applies to all go uh programs we had a number of nodes in our various Cloud uh clusters you know we were running kubernetes on AWS gcp andure um that were using CPUs that had multiple num zones which I've learned about in the past week um these are like areas of CPU and memory with fast access um and go is unaware of this particular detail of CPU architecture and if you happen to run Tempo or any go program on a uh on a node that has a processor that has multiple Numa zones um it will consume significantly more CPU and memory than it should so I would recommend if you run any go programs and I imagine a lot of people on this call do if you run any go programs in the cloud double check this go uh look to see if you have multiple newon on your uh nodes and uh maybe you want to move move off those we have been struggling with that for the past a month we had significant uh CPU and memory elevation in one of our cells we were sweating it for a month could not figure out what was going on thought it maybe was some strange right pattern and it turned out to like a detail of the CPU architecture that some of the investors were uh sitting on so maybe I'm telling you all something you all know but I did not know this cool all right crew well was it one question we had one question when is tempo 2.7 coming it was an important question we got it answered uh all right well it's been Pleasant talking to youall I hope you all have a great holiday uh see you all in early January and we will have 27 go rolling and um yeah we'll review the change log and talk about what we're working on now take care thank you bye okay bye bye everybody bye

