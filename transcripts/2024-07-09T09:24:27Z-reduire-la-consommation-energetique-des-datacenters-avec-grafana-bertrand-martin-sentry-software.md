# Réduire la consommation énergétique des datacenters avec Grafana - Bertrand Martin @ Sentry Software

Réduire la consommation énergétique des datacenters avec Grafana : Une réussite écologique (Bertrand Martin @ Sentry ...

Published on 2024-07-09T09:24:27Z

URL: https://www.youtube.com/watch?v=2H-a8Xp5LCE

Transcript: c'est tech merci donc je suis martinur de C Software et je vais vous parler je vais vous parler de ce qu'on a fait nous ce qu'on a testé nous en développant notre propre logiciel pour réduire l'emtele notre bazar notre notre dat alors juste en quelques mots on est une petite société de logiciel développe on est spécialisé dans on est spécialisé dans les logiciels de supervision informatique c'estdon fait des logiciels qui vont détecter des par dans les systèmes informatiqu un disque qui lâche une tempéature qui monte une carte qui est déconnectée ce genre de chos dans les dat Center donc c'est vraiment un outil c'est un outil un logiciel c'est l'informatique pourformatici je dire c'est c'est très en pour expliquer ce que je fais c'est très compliqué personne ne comprend c'est donc c'est un expliquer vos études c'est pareil la som comprend rien dans votre famille je veux dire et donc euh donc en fait des logiciels qui détectent les pan voilà on a notre logiciel est utilisé dans beaucoup de grandes entreprises grand data center des les grosses banques des des gouvernements des l'industrie les Télécom et cetera et cetera donc et bon je vous en parlerai après on est on est euh on a commencé récemment à travailler notamment sur les technos récentes de ce qu'on appelle l'observabilité avant on c'est la supervision informatique mainant on fait de l'observabilité il y a quelques nuances mais j'imagine que vous voyez ça en cour euh et notamment on participe au projet open source Open thélémérie qui est un standard pour la supervision informatique pour définir des des trucs tout bêes comme la consommation CPU sur vre PC la consommation mémoir mais ça fait les T d'autres choses également euh on participe on est sponsor de la Green Software Foundation je sais pas si quelqu par vous connaissent les G Software Foundation euh on participe j'aita jug alur dernier àaton là c'était c'était cétait rigolo euh on est sponsor actionnaire de team for the planet qui ont annoncé d'ailleurs million d'euros ce matin auprès de l'État en plus de ce que nous autres ur av mis et euh on a souscrit à science space target qui est une l' organisation qui incite les entreprises les grandes entreprises à euh mesurer et euh réduire l'emprint de carbone de leur système en général de leurs activités alors comment ça marche l'emprinte carbone on entend parler euh on sait tout ce qu'il faut réduire mais ça demande une certaine organisation dans les entreprises on met en place une démarche qui est étap très très simple qui est tout d'abord de mesurer où est-ce que ENF où est-ce que l'entreprise en est combien d'émissions carbon de combien d'émission de carbone elle est responsable différentes manières entre du rûler du charbon consommer l'électricité euh fournir des des des objets qui peuent même cons de l'électricité ou qui Brent de l'essence euh donc mesurer calculer sur un an combien combien d'émissions carbon une entreprise est responsable ensuite euh se les objectif de réduction parce que à l'époque ronit que c'était la cata et que on se dit ah oui en 2050 neutralité carbone et CETA si 50 euh donc fa des objectifs genre% cette année %année suivante 5 % l'année d'après et cetera arrivé progressivement et après tu sais pas ok c'est bien d'avoir des objectifs parce queil y a beaucoup de responsable qui V communiquer qui on faire ce qu'on appelle greening les responsables entreprises mais également responsable de politique dire oui objectif c'est de faire% ce qu'il disent et il n a pas d'action rére la difficulté pour une entreprise pour une organisation quelonque c'est de dire alors un petit peu de théorie rapidement petit petit rrapéf alors un petit peu théorie d'abord grossièrement vous faire simplement alors quels sont les dans l'IT dans l'informatique quels sont les trois grandes sources de d'émission alors comme Monsieur le Directeur disait tout d'abord il y a les terminaux les terminaux effectivement sont le téléphone les PC et cetera les télés plus l'écran est grand plus responsableémission carbone deuxièmement dans une entreprise les Data Center ce cas làement les les d'OP ai ils ont avoir optimisé le dernier GPT 4 bon il fait il cons quand même pas mal machin et ensuite euh et ensuite il y a une entreprise tous les services IT externes qu'elle va utiliser est sur Azure elle est sur AWS ou des servic quelconque comme je sais pas si vous connaissezan et cetera très utilisé dans dans entreprise bon voilà on et là je ne parle que des émissions carbone ok je ne parle pas de la consommation d'eau je ne parle pas de la consommation de terr RAR pour pour fabriquer tout ça mais ça va êtreé tout à l'heure on va juste parler des émissions carbone responsa du rchauffement climatique alors si on ça c'est marrant c'est décal [Musique] on peut découper les émissions de carbone de deux manières il y a tout d'abord les émission carbone lié à la construction du machin téléphone l'écran du serveuron appelle carint carint plein de nom différents on est encore au tout début de la standardisation de ce genre de mtri et donc le vocabulaire change les termes ch il y a des tas de querelles d'expert c'est c'est c'est très intéressant et donc deuxièmement bah le le les émissions carbone lié à l'utilisation du device donc simplement l'électricité consom chtié c'est juste ça et donc en fait pour les terminaux ou les dat Center ou les services en ligne les services en ligne ce n'est pas la même proportion sur les terminaux effectivement c'est essentiellement de de les émissions carbone sont essentiellement lié à la fabrication du terminal plus l'écran est gros plus c'est important et ça représente typiquement 80 % sur le cycle de vie de votre téléphone c'est 80 % lié à la fabrication c'est pour ça qu'effectivement pour réduire l'emprint de carbone associé à un téléphone mobile ce qu'il faut c'est éviter de remplacer TR souvent voilà il y a d'autres d'autres d'utres solution le fait qu'il consomme plus soulectricité ça va finalement pas faire une grande différence c'est le contraire sur les Data Center les serveurs qui veut sou de 24 C qui sont pas spécialement optimisés pour pas consomer d'électricité et qui ont de Ré en général plus longue que les que que les termine ok euh là encore ça dépend en France on est plutôt pas mal puisque l'énergie l'électricité est très carboné comparé à d'autres d'autres pays comme les États-Unis ou l'Allemagne donc nous plutôt d'être genre 70 30 on ser plutôt 5050 en France mais pour la question se pose globalement on va pas juste se poser la question sur qu'est-ce qu'on fait euh ensuite pour ce qui est du les services Cloud bon j'ai 55050 parce qu'en fait pas donné c'est pas c'est pas exa c'est pas exactement c'est pas trop publque c'est il y a beaucoup la communication dessus mais les chiffres exacts on euh ensuite oui alors dernier point théorique làdessus sur le le le protocole de koto celu défini dans les émissions carbone on les classifié en trois scopes SC 1 2 et 3 Al scope 1 pour faire simple c'est ce que vous cramez donc l'essence l'essence dans la voiture le charbon dans le bar le feu chiner voilà c'est ce vous le le scope 2 c'est l'électricitéélectricité et scock 3 c'est beaucoup plus compliqué c'est c'est tr ce que vous avez acheté pour fabriquer votre produit c'est tout euh également tout ce qui est toutes les émissions carbon lié à l'utilisation du produit que vous avez vendu par c'est très très très compliqué alors euh aujourd'hui les entreprises euh la plupart alors en Europe on va dire mais dans beaucoup de pays sont contraintes maintenant légalement de fournir un bilan carbone euh alors annuel ou t les 3 sem ça dépend des régions et si ne font pas Pete pénalité pas trop pour l'stant pas les gouvernements non pas é à trop méchant avec les entreprise mais il y a une obligation légale une obligation légale et l'obligation c'est ça carbone voilà mettez scope 1 scope 2 VO globalement scope 3 en vrai il y a tellement de disputes sur comment qu'est-ce qu'on met qu'est-ce qu'on met PASF c'est compliqué mais c'est important parce qu' ité euh il y en a déjà qui commencent à tricher qui disent bon moi je enfin je ne suis responsable de rien c'est monur voilà c'est il y a des gens qui trichent donc on va les experts se sur le sujet on va finir par arriver à diff standard les lois sont différentes dans différents pays dans dans différents pays mais voilà va arriver à quelque chose donc bref tout ça pour vous dire que dans les choses dans les choses à considérer dans dansatique c'est SC électricité d'abord et 3 je [Musique] reviance mais on a une ser est le logiciel qu'on développe censé superviser détecter les pas de matériel dans n'importe quel type d'équipement qu'on trouve dans un data center euh donc machine HP BM Huawei netap EMC euh n'importe il va contre on sache retrouver l'information dire si le disque il est en forme si le CPU ne chauffe pas trop si la mémoire ça va bien si la ligne n'est pas débranchée et cetera et cetera donc en fait on a tous ces types de système dans notre dat Center donc en fait on a voilà qui sont tous pas pas deux pareil donc pour un administrateur système vous AZ de l'administration système c'est un vitable cauchemar pas de par je veux tout différ et donc on s dit ok faut il faut qu'on mesureut qu'on mesure déjà faut qu'on mesure comment on fait pour mesurer le l'emprunte de carbone liée à l'utilisation d' et bien simplement on peut prendre on peut commencer par prendre sa facturef en France ça on prend sa facture combien de kilwh vous AZ cons vous multipliez par ce qu'on appelle l'intensité carbone de votre fournisseur d'électricité en France c'est assz B le nombre de Gram de de par MW produit et et puis voilà vouszz un chiffre ça bon mais c'est pas très précis donc ce qu'on peut faire également c'estant c'est d'installer ce qu'on appelle des PDU unit dans chacun des vous êtes déjà dans un datacenter qui est déjà dans un datenter C expérience super froid euh B bref dans chacun des racs il y a ce qu'on appelle un ce qu'on appelle un pduélectricité donc on a des smart PDU qui sont connectés au réseau et on peut interroger donc Smart PDU c'est juste prise et donc vous interroger en Enor protocole s vous dire voilà la prise 12 elle consomme 230 W la prise 13 elle consomme 47 et C et voilà vous faites vous essayez de de de récupérer toutes les données vous mettez ça dans une belle feuille Excel alors rigolez pas il beaucoup grand entreprises qui utilisent encore Excel Excel run vous intégreer tout ça mais ça ça pose un TR problème c'est que vous avez une somme voilà de de choses physiques la prise 13 la prise 14 47 dans le datacenter B vous savez pas à quoi ça correspond et c'est la deuxième question devons vous poser la plupart des administrateurs système c'est bah ouais je manger mon totage et mon truc et maintenant qu'est-ce que je fais avec ça et c'est vrai que si vous nêtes pas capable de dire ok bah c'est la prise vous 1 ça correspond au ser VMware je pas combien voilà et bien les administrateurs V Pasir dire tiens que jeutiliser je supprimer et donc voilà on était dans cette situation comment on fait on a les SPU on a tous les machins mais après on s'est dit aussi on a notre propre logiciel déjà qui fait déjà quelque chose nous com on doit détecter les pannes pour chacun chacune de ces machines bah on va tester tous les curs quoi euh je sa pas s'il y en a quiouill sur leur PC qui ont V installer libre hardware monitor de truc en il y a différents til qui permettent de voir le le les voltage le le la puissance consommée les différents trucs la température non vous avez déjà vous déjà qui tu dis ça selon son PC qui rigole son PC bref oui parce que voil POS des questions faut avoir la bonne alne pour pour faire tourner le bon g et euh on fait ce genre de chose sur tout types de machin notre logiciel il récupération notamment la la température de température et les capteur de consommation électrique c'est super déjà de récupérer tout ça sauf que bon à l'époque notre logiciel propriétaire la pour stir les donnes Mach de tout révelopper pour tout refire sur standards couverts enant d'abord promus pu voil PIR envoyer toutes les données dans promus qui conna promus visualisé dans qui con effectivement dans le dans le redesign en question on a commencé à se poser des questionsah oui comment on représente la consmation machine comment la température des question très B c'est quoi le nom de la matrique du gen c'est hwat mais d'accord avec tout le monde par que du coup comme travailler dans le standard re télémétrie tout ça c'est des questions d'observabilité c'est rendre la consommation électrique et dansentr un carbone une machine observable donc dans l'observabilité il y a le standard Open télémétri qui a entendu parler de open télémétrie super open télémétrie excellent standard euh et donc qu'est-ce qu'on a fait nous on a contribué à définir ce qu'on appelle les conventions sémantiques sur le hardware voilà comment c'est quoi le nom de la métrique c'est quoi les attributs et cetera et cetera ce qu'on a fait pour pouvoir retrouver en fait fait cet exercice de notre côté demain les constructeurs les autres développeurs de solution de supervision d'observabilité et bien ils suiveront les mêmes conventions que nous pour que toutes ces données là arrivent un jour dans une base prométhus Mimir et puiss être représenté alors là dans exemple dans gra et et voilà du coup on avait notre logiciel qui était transformé et qui remontait donc les données de consommation électrique les températures on all extraire l'intensité carbon de VF chez RTE et le prix deélectricité et on a pu construire ce genre de on voit alors dans les détails c'est quelques machines pas grand chose euh et ben la consommation électrique la consommationrique juste des machines du total juste de la machine des machines l'empr de carbone don vous avez en wat en kilwh MW sur une journée sur un mois sur une année le coût associé et l'emprunte carb associé calculé en live en fait donc Mo sommes il fait ses sommes intégrées c'est pas des moyennes qui sont qui sont non non on a la consommation électrique instantanée multiplié par l'intensité carbale instantanée et tout ça c'est des requêtes qui sont pass c'est que chaque petit pe là en fait c'est c'est une c'est une requête dans le promtus et puis on sort le résultat qu'on affiche qu'on affiche en dans dans un panel donc déjà ça en fait déjà on é très très très publ sur surfana on était élu parmi les meilleurs [Musique] dashb merci merci bref ok donc là on a mesuré on est contentaintenant qu'est-ce qu'on fait qu'est-ce qu'on fait pour réduire deè étape mesurer puis réduire option vous avezmion première option ferme votre data center Metz tout dansre cl une option effffectivement Google Microsoft et Azure mais aussi scaleway OVH sont bien seront bien meilleur que vous système pour pour optimiser la de ils sont très bons il sont voilà bon après ça co une BL mais voilà marche deuxème option vous vous réduisez les choses vous chasser le G Mme savoir que globalement en moyenne 40% des rourcesati dans un dat Center son rien personneoup et une trè option que j'ai ré la températureaz alors oui donc parmi vous dat Center vousz remarqu en général il fait froid sur classique général 18° et c'est très Bron par des ventil qui tourne àond et en fait faut sair dans dat Center l'électricité est consommé pas seulement pour faire tourner les serveurs les systèmes de stockage mais beaucoup pour refroidir l'ensemble alors là c'est de la thermo alors bref si vous mettez 100 W dans un système électrique il y a 100 W qui ressortent en chaleur fait pas de a pas d'énergie Mécque qui s donc 100 W dans vot PC de chaleur radiateur donc du coup si vous considrez ça ferm pourir maintenir la température constante Natur né il 40% 40%énergie qui est utilisé pourroidir les sy de0% pour lesu et 4% pour je comp l'électricité euh et en fait du coup euh les les experts du domaine ont inventé des des MTR ça fait long temps ça fait 20 temps euh pour mesurer l'efficacité d'un d'un data center on appelle ça le pui power usage effectiveness c'est le premier c'est le plus simple il en a plein d'autres euh qui simplement divise euh quce quo déjà ah oui c'est ça divise le total par euh ce qui est utile donc le total par la partie or OK et un un dat Center typique classique mauvais faire c'estvais meilleurs dat Center Google mrosoft 1,5 plus plus donc ce qu'on const que ça c'est vraalementusance mais dans pays ausunis il fautir quand vous si vous la mettez à 18°g une certaine quantité d'électricité si vous la mettez à 19 en fait vous baissz la consommation de cette cl de 5 % chaque degré c'est quasiment linéaire au début c'est beaucoup en fait différence donc en fait dans un vous le fait tourner° RA 40 60 19 ça fait ça va faire 35 65 mon à 20° c'est encore plus c'est encore meilleur 21 meilleur et cetera et cetera la question c'est jusquù on peut aller et c'est ça la bonne question et surtout la question qu'on pourrait se poser c'est pourquoi est-ce que les mec qui tourne à 18°g pourquoi est-ce que vous savez bah personne ne sait les mec on leur POS la question ils savent pas B je crois ça ça tourne à 18°g donc B on va peut-être pas s'amuser par qu'on si on réchauffe le machin ça risque de cramer tout ça tout ça effectivement en fait ce qu'il faut pour s'autoriser de d'augmenter la température c'est et bien faut superviser le machin C Tom est bien parce que nous que fait on le fait on va on va récupérer cette information sur tous les capteurs de toutes les machines les équip et on va regarder s'ils sont s'ils approchent non d'un seuil d'alerte on sur une machine on va pouir calculer sur machine 12 cap il a°gr 8°g 17°g 22 degr de marge par rapport au seuil d'air donc ça veut dire que cette machine on peutter de 8 degr al regardez la deuxème machine la M Mme chose après one ça on lance on balance une énorme requête Prom QL prus dans le et on obtient un ch qui n dit OK et ben sur ce gros de machine vous pouvez augmenter la température de temps ce qu'on appelleting margine la marge de réchauffement ça va arver pas breet le standardisé euh et donc du coup dans notre dans notre grafana on on est on a desques géantes pour pouvoir calculer sur un site ok euh tout d'abord quelle est sa température ambiante alors sans installer juste en regardant les machine à combien sont et cetera on calcule on estme ça en purure logiciel on fait tout not truc des fait sans aucun capteur supplémentaire sur le logiciel on arrive à mesurer ça pu on arrive à calculer du coup euh bah quelle serait la la la température théorique maximale qu'on pourrait mettre sur ce data center voilà dans ce dans ce cas à 29°g on pourrait calculer combien d'électricité serait euh épargné euh pour en en changeant ce ce ce réglage de CL vous on change la température la consigne le thermostat d'un système de clim queement il va fonctionner moins souvent dit 29 deg il va moins et donc alors nous super c'est génial vraiment une e de génieidée de génie donc on fait Mach le truc et puis et puis le résultat c'était on 17° les de ça et le truc il nous dit bah il faudrait descendre par ça marche en fait oui bah cétait normal parce qu'en fait notre serveur était pas du tout organisé correctement effectivement il y a des machines qui déjà à la limite quoi et effectivement on a pu voilà pareil petit des petits tri de pour représenter réartion des machines la mar de réchauffement et donc qu'est-ce qu'on a fait et ben on a bougé des machines on a descendu des machines plus proches des des des sorties d'air on a les vieux P qui traînent on les a ouverts on a sorti les disquesux pour les mettre pour mettre au frais euh c'est passteur et on est passé de làhaut voilà j' une machine typiquement il y avait 3 degr de de de réchauffement possible à 18°gr en fait on a pu voir notre margine sur le site qui a augmenté et ce qui fait que du cours ok donc maintenant on peut augmenter la température de machamb naturellement on y est allé progressivement on était à 18 donc disait tu peux monter à 29 tout suite et on voilà de de et C pour arriver finalement euhon recommence de pas dépasser une marge de réchauffement de 5 de et le résultat bien qu'on avait qu'on a économisé 20 % dans la clim ça amélioré notre pu est descendu de 1 5 à 145 ça fa ça fait Mo 7 % sur les consommations sur les émissions carbon de notre s Server on é très content et en plus on a publié tout ça sous forme ouverte donc c'està dire que c'est disponible pour tout le monde qui voudrait l'utiliser les entreprises toutes les entreprises qui ont des Data Center pourrai se servir de cette solution pour ça qu'est-ce qu'est-ce de quoi ils ont besoin alors il a de logiciel alors du coup on a fait une version gratuite par que si on voulait comme vous sauver la plan faire pay gratite de gres entreis et ensite donc on instleu notre logiciel pour collecter les données dans le Center les donnes dans un [Musique] ou n'importe quel équipement prus et ensuite et bien utiliser les dashboardement pour utiliser tout c Mées collectés et comprendre ce qui se passe dans dater et réduire sa consommation voilà voilà merci àoup je [Applaudissements] crois alors je P les questions les prend après sur de SAF si vous avez des questions tout de suite là vous êtes chaud chaud j'ai une question pour que je m'installe vas-y vas-y euh le les capteurs de température c'est en imp pas sont externes à la aux machines enfin comment tu alors est-ce qu'en gros est-ce que tues capteurs de température ils sent pas trop à l'intérieur des machines pour arriver à savoir la température de la salle comment tu pass de l'un à l'autre c'est c'est c'est une bonne question alors on peut tout à fait utiler des capteurs externe supplémentaire mais nous on a fait là dans notre exemple de de ne prendre aucun autre euh deutiliser AUC de capteur paren fait dans dans les serveurs typiquement il y a des capteurs un peu partout sur les disques sur les sur lesim et les capteurs de température ambiante surtout de temp la température de l'air entrant parf l'air sortant donc du coup on a la température à la position de la machine ça qui est intéressant c'est que si la machine elle est au ras du sol a si elle est tout en haut elle va pas avoir la même température d'air et qu' faut qu'il faut savoir optimiser une autre question pour ça vous a pris combien de temps pour passer 18 deg à alors on l' fait progressivement on a fait 1 degr le plan céit un par semaine puis moment j'ai de tous les jours VO mais dans un dans un très grand dat Center vraiment un don par semaine c'est bien c'est la technique qui é utilisée par Google d'ailleurs pour obtenir son avmter ça pour obtenir leur p je je je je je suis là voilà et GP on cherche également on embauche également des stages également allez voir avec

