# Grafana at Continental Scale: Monitoring the National Ecological Observatory Network (NEON)

The National Ecological Observatory Network, or NEON project, is a continental-scale ecological monitoring network comprising ...

Published on 2024-04-25T23:49:13Z

URL: https://www.youtube.com/watch?v=ADQnCuFbBEY

Transcript: [Music] you're here all right thank you so much for having me it's an honor to be here uh my name is Robert hnet as brother Matt mentioned I'm an IT service administrator with the national ecological Observatory Network also known as the neon project in the United States I should mention that the US national ecological Observatory network is a project solely funded by the US National Science Foundation uh please note this disclaimer so a little bit about myself um I've got about 15 years experience working in ecology and remote sensing in Hawaiian uh Forest I'm coming from the entire opposite side of the planet I was born and raised in Hoi and much of my professional experience uh has just been out measuring trees uh I worked many years with the US Forest Service and the University of Hawaii as a tree climber plant survey and ID technici and a tower technician maintaining freestanding climate Towers uh big ones greater than 30 meters tall uh so in 2019 as the neon project was completing their um construction on their final field site at P makaala Natural Area Reserve not 10 miles from my house I was lucky enough to join the team as a senior field ecologist in charge of the instrumentation on this shiny new tower with tons of sensors on it in 2021 I join the IT service desk where much of my job is involved in facilitating Observatory monitoring functions uh including grafana um I have a short video that would much better explain what neon is who we are and what we do in two minutes than I could and it'll also give you kind of a visual idea of what I'm going to be talking about neon scope is very broad so I should mention before playing the video that if you want to learn more about um the Airborne platform or observational sampling then just take a look at these links later from floods and wildfires to land use and invasive species our ecosystems are constantly changing the national ecological Observatory Network or neon is designed to collect data at field sites across the United States to help us better understand these ecosystems and how and why they change over time the neon project will transform SCI scientist's ability to study our nation's ecosystems by providing a wealth of open data and a continental scale infrastructure for research studies neon is unique in two ways first neon uses a combination of data collection methods that are spatially integrated within and across field sites and second the data collection methods used are standardized across all sites to enable comparisons across the continent as a result the data can be used to integrate ecological observations across multiple scales detect changes in how our ecosystems function and enable forecasting of environmental change to inform Resource Management decisions neon field sites are strategically located in both terrestrial and freshwater aquatic ecosystems across the United States they represent the vegetation land forms and climates of those regions at each each field site neon uses a combination of automated instruments observational sampling and Airborne remote sensing Technologies to collect data that characterize plants animals soils nutrients freshwater and atmosphere neon's automated instruments collect data 24/7 at terrestrial and Aquatic field sites Across the Nation flux towers that rise above the plant canopy at terrestrial sites collect a full profile of atmospheric measurements along with sensors installed in the ground that monitor soil Health at aquatic sites a smaller meteorological station collects atmospheric data and other sensors monitor surface water and groundwater quality all right so let's cut it there from floods and wildfires to land use and invasive species next okay excuse me so um with that said uh it is a great irony of neon that the ecosystem that we're trying to measure seems like it's constantly trying to destroy our field sites we've got animals nesting pooping on fighting with and trying to eat sensors we've got trees crushing sensors after wind storms we've got lightning strikes we've even got controlled Burns around sites uh for fire mitigation if you thought it was a challenge to maintain networking infrastructure in a server room or scientific instruments in a lab allow me to share with you an Ode to the neon field science technician [Music] [Applause] [Music] [Applause] [Music] [Applause] [Music] all [Music] [Music] this all [Applause] [Music] so with that last video in mind you can imagine how important it is to have a comprehensive monitoring platform as neon transitions to grafana for site monitoring let's compare our fundamental capabilities with the former state-of-the-art um so previously on-site data visualization was extremely limited and you could basically look at what was happening now and that was it with no historical look back um monitoring and alerting was performed on batch data at 24-hour intervals uh you can imagine how frustrating it might be coming from a field site only to realize something had broken just as you left with the next site visit planned weeks uh in the future um sometimes days away a drive that is um and then additionally uh we didn't have any infrastructure monitoring um it was largely relegated to technicians logging into a switch to infer its status at the at any given point in time whereas with grafana Tex utiliz two instances we have one that's on these uh servers at the at the field sites themselves that they can use independent of communications and then we have an aggregated version in the cloud in gcp um where you can look at near realtime data across the country from any field site um as well as having instantaneous alerts uh we're using victorium metrics um so we have those visualized over the time series and then we also have now comprehensive monitoring capabilities across our all of our infrastructure on site so the transition to graphon at neon began in 2019 is as we were replacing aging field site Hardware um the backend development started and but grafana work didn't really start until 2021 uh when I joined the IT service desk uh in November 2022 we deployed our first site at Central Plains experimental research station in Colorado and that was our first site to deploy this new software we incrementally deployed it across the network and completed all tower sites in November of last year um there are generally five people working off and on on this project and my role is the field operations dashboard engineer um I maintain all the dashboards uh and design them that I'm sharing with you today they're utilized by 77 full-time talented hardworking field technicians out in the field as well as headquarters staff that help them coordinate um maintenance activities and with that let's put on our imaginary work boots and hard hats and let's take a tour of some of the dashboards all right so our target audience for the dashboards on site is largely the field science technician uh they're not necessarily graphon experts so we tried to develop um a site Focus interface that uh includes a menu that divides up sites by sensor types and infrastructure into different dashboards allowing technicians to drill down at different different systems and subsystems on their site uh when text log into grafana on their site this would be the default landing page right now we're looking at my former site P maala or site code pum there at the top let's take a quick tour to get a sense of how we use these things uh so at the top we have some general stats that inform General site Health including power status and network status uh here we have a table that shows all the sensors streaming within a given site uh note the row count there so at pum there's 116 individual sensors with multiple data streams uh here you can find out unique IDs for all the sensors as well as their locations and other defining characteristics uh this stat would show whether or not the site instance has synced up with the gcp instance um since we have the ability to backfill the data when Communications are down we don't want technicians to infer missing data when it's just being backfilled and if we were really on site of pum right now this wouldn't have any other op options besides pum at the top uh but if we were looking at gcp we could jump anywhere to any site and look at the same time series which is really cool halfway down the page we have some graphs showing our message volume for all the sensor data on site as well as our interfaces and router traffic coming off of the uh off the internet there uh moving down to the bottom section the entire bottom half of the site Hub is devoted to just general alerts for the site the top features a stat showing how many alerts where and um what kind of alert is firing there in the table and then on the bottom we have a donut graph that shows approximately the proportion where it's happening and then temporarily on a uh status timeline graph primarily though this dashboard is just the landing page uh to allow users to easily jump around their sites I designed this menu before the dashboard select plug-in had the ability to translate variables so the idea is no matter what time series you're looking at or any variables you have selected you should be able to click anywhere in your site and they should translate from dashboard to dashboard making it seamless so getting on to the neon sensor data uh this dashboard features all sensors that are defined as air sensors uh when sensors are installed by technicians they're given a set of context labels that inform what they are what they do and where they're located in this example I've jumped from pakala in Hawaii to to kza Prairie in Kansas so if any technician ever has any doubt uh which sensors in which dashboard I list all the relevant dashboards at the top of the page along with their preferred knowings and manufacturer IDs right below that is a cluster of panels that generalizes about just the alerts for all the sensors on that site or excuse me on that dashboard um this should help Point texts directly to problems and not just overwhelm them with graphs uh here we see that a dual fan that typically aspirates an air temperature sensor it's starting to fail for some reason it's out of range maybe the flow might be restricted what could cause something like that H right um so uh neon Towers have varying Heights uh depending on the height of the surrounding tree canopy and that translates to how many measurement levels in sense that they have um so we can drill down to like a specific level on our Tower by using our location variable at the top and it filters all of our panels on the loc uh for that location on the tower so then let's select our time series for when this particular alert's firing and see if we can figure out what's going on uh you might notice that this alert changes in severity over time it's kind of slight but it changes color there uh we found that pending time intervals on alerts often missed intermittent failures and so instead we applied a percentage over time usually like 10% on the hour um before escalating the severity on alert uh when we scroll down to the panels featuring this alert or this uh the sensor in this alert I should say uh the series is highlighted instantly red when it goes out of range and we use this technique when it's just like a single data series that's out of range um so this is generally how text would use a simple sensor dashboard but let's look at something more complex so all the sensor that we all the sensor data that we collect goes into various data products which we publish freely for the public um the most complicated data products from a tower site are the Edie covariant systems these are some of neon's Flagship data products which use sensors across the whole site including wind sensors gas analyzers and they measure the movement of uh and storage of carbon dioxide water vapor and energy within a tree canopy uh it effectively measures the bread of an ecosystem over time this uh storage exchange dashboard is one of two gas exchange systems that neon sites feature it is extremely challenging for a site to deliver a valid data product because of the number of sensors infrastructure Automation and scientific assumptions being made in the final data product so monitoring all of it is essential uh and there are many many components uh so let's dig into this dashboard again we see alerts related to sensors in just this dashboard but also we have annotations that tell us the status of the software that controls the automation for the air pumps and valves Etc additionally we get an annotation if the exporter for the sensor data fails or if a Data Logger is suddenly not resp responding uh this can help users infer uh when multiple issues seem to pop up across multiple sensors or data streams at once uh we also have a relative link to Loki here uh which provides links uh to the logs for the Control software during the exact time series which you're looking at in grafana which is really helpful if you're trying to see if something is like real or a bug so something like that so before we scroll down this dashboard again let's note this alert at the top that a rotary pump uh voltage is is low it's failed so scrolling down immediately we see in reference to this alert uh some stats which are very red and very out of range compared to everything else uh in that series uh this is a big deal one air pump failing could invalidate all the data for the entire Edco Varian system and depending on which one these pumps aren't always available um and this is really what keeps Tower technicians up at night wondering when the next pump might fail uh here are some more stat panels including reference gases uh and several stat panels for the individual gas analyzers neon sites utilize automation to remotely calibrate and validate these uh gas sensors daily to ensure data quality and it requires the use of compressed air cylinders on site um they're refresh yearly but they can be subject to leaks and that can be really hard to detect and costly calibrations and validations also can't occur without this and so the data is invalid and the data is lost uh so this panel here shows the status of different valves on site used to sample air from different levels on the tower as well as the valves that are used to control these validations and calibrations on site uh to give you some idea of the complexity of the plumbing on a tower I'll just flash this schematic it's spaghetti uh so this panel uh below here um shows the concentration of carbon dioxide from the air measured across two different um gas analyzers on site and zooming up on these two panels gives you some idea of how we cycle sampling levels on the tower also what it looks like when one of the gas analyzers under go a daily calibration receiving low medium and high span gases so this is a Time series panel for all the air pumps on site like what we just talked about um including the one that we just failed that we saw just failed um it looks like it failed longer than two days ago and this Control software tried to run the pump again and failed so someone's going to have to look at that uh these are time series panels here showing all the different flows and pressures in the sampling lines uh comparing these values with pump voltages can help neon technicians identify leaky Plumbing or leak or kinked lines which can break pumps compromise data and are extremely hard to detect uh here's where a suspected squirrel at Leno took a taste uh in Alabama that's like halfway up the tower by the way uh moving on uh this panel on the top shows the water vapor concentration in the air from all the gas analyzers on site these green spikes are actually generated by an auto sampler robot that injects calibrated water samples into the lines and vaporizes them uh while the B bottom panel just shows the mass airflow controllers that can control how much flow U um excuse me control how much air by volume is is sampled this is what the robot looks like um mov down the page the top panel here shows valid validation gas depletion over time uh we actually have this corrected for fluctuations in temperature throughout the day in real time using an environmental probe and the ideal gas law uh we're doing this with a query it's pretty cool it makes it um a little bit easier to see when when leaks are happening the bottom panel there uh shows a 4-day Delta that highlights if like one cylinder might be leaking more than the others over time on the right here we have pressure readings from all the gas analyzers with expected thresholds and set points visualized on the same graph and finally at the bottom of this dashboard we have unadjusted gas loss on the left which you can see is a bit wavy with temperature variations throughout the day and the delivery pressure of all those cylinders on site um from their Regulators Plum to the instruments and the last panel here is the status of the many data loggers with the Eddie coar with an Edie coov Varian sensor related sensor plugged into it and that's an ovarian sensor dashboard it's a ton of panels and information the point being that it all adds up to a data product and even one of these panels indicating a problem could mean that the entire site's data product is invalid there are other sensor dashboards with similarly group sensors with comparable data streams and shared infrastructure um we've looked at air sensors and antiovarian dashboards but let's look at some of the infrastructure dashboards so as I mentioned previous previously um infrastructure monitoring at neon was largely relegated to field technicians logging into a device like a switch or or something and looking at the HTML interface and at and just getting a sense of how it's doing at that given point in time the ability to look back historically at switch status provides a lot of information about the connectivity on each of those ports and what may have led or LED to or caused a failure uh cable failures are actually one of the most common issues that neon technicians face so here we can see that a Data Logger plugged into Port three has sent some bad traffic scrolling down we see a state timeline graph which shows an indication of all the data rate of all the sensors on that switch we know that there is bad traffic on Port 3 and we see the data rate across Those sensors drop off for a second scrolling down we see a Time series graph showing when those bad packets were sent from the switch and it actually seems to correlate with temporally anyway with the sensors dropping off above but it's intermittent so what could be causing that this brings us to the last category of dashboards for site monitoring which I've named pilikia J ho means trouble it sounded a lot more interesting than incidents issues and problems which are pretty loaded terms uh anyway so under pikia we have dashboards that generalize about all the alerts on site but we also have a dashboard completely devoted to diagnosing and detecting issues like this like packet loss so this dashboard as I mentioned is entirely devoted to detecting packet loss across the whole site and not just one switch but it also includes some neon sensor data that might help us infer cause here we see bad packets on our time series from soil plot five over the last week we can see this Behavior started on the second and there also appears to be a number of ports that sent bad traffic around the same time around different points on the tower again bad packets are usually an indication of like a physical problem with the connection or the port or the or the cable since one of the data products that we measure is rain precipitation and we have rain sensors all over the site and one of the most common failure modes is when a port or cable fails because of water getting into it we can notice temporally that there's a correlation between this bad traffic and this rain event and here another rain event on the 3 we also saw an increase in the bad traffic from that same port I can infer as a technician that this port likely has water issues and there should be a Data Logger out there shorting or something unless unless somebody goes out there and checks it out do you guys remember this picture from the sensor destruction Montage uh being able to quickly test and visualize these metrics in real time and compare them allows us to do interesting things like translate these real world events and scenarios into useful alerts like there's water in your Port go check it out um and being able to compare neon sensor data to infrastructure data helps neon Tex infer when the ecosystem that we're trying to measure might be responsible for the hardware failure at your site which brings us to the alerts dashboard where we can find out information about all the alerts in the site within a Time series in question uh again we have General metrics related to alerts across the whole site the addition of this time series graph counting average alerts over time uh so at the same time series selected we can see by filtering this table that we do in fact have an alert that says that there is likely water Ingress in this port let's select that Alert in this table and filter for just that selecting that alert filters it and gives us a link to the alerting component in grafana which allows technicians to find out more information about this alert so let's find out more so the alerting component has done a great job of rendering their alert rules from our alert manager and can show technicians exactly what we're testing and give them a summary of what we're trying to trying to look at and since we have all these dashboards replicated in the cloud we can actually compare the number of alerts over time between sites and that allows us to identify systemic issues across the observatory I've also made dashboards to show visualize those I could go on for hours uh but we're almost out of time so as we near completion of the software deployment with only 10 sites out of 81 remaining grafana has already revolutionized the way that technicians maintain and monitor their sites and we are excited to continue to find exciting and new ways to to use this software thank you

