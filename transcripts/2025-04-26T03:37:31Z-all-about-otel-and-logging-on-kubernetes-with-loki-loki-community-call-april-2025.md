# All about OTel and Logging on Kubernetes with Loki (Loki Community Call April 2025)

In this pre-recorded Loki Community Call, we talk all about OTel and logging on Kubernetes with Cyril Tovena, Ward Bekker, Jay ...

Published on 2025-04-26T03:37:31Z

URL: https://www.youtube.com/watch?v=27ZHOg-LaM0

Transcript: Hey everyone, welcome to a little bit of a different kind of Loki community call. We are right now at CubeCon EU in London at the Excel and I'm here with a bunch of my colleagues. I'm Nicole Vanderven. I'm a senior developer advocate at Graphana Labs. Yeah, I'm Mark Becker. I'm um right now I'm part of a new team uh that uh I recently joined but I've been also working as kind of a Loki subject matter expert for quite some time. Hey everyone, I'm Storina software engineer on the Loki team. Excited to be here. Hey all. Well, I am Tom for the day because I had to sneak into the event to let this all happen. Um but no, I'm Jay Clifford. I am Nicole's official sidekick but also a developer advocate. Who's your sidekick? Hey, what? No. No. Okay. sidekick. Nobody wants to be Rob back. They just want to be Robin. So, how many CubeCons has everyone been to? I think that's probably a good question to kick off. Good question. That's a good question. I I think this is my third year. I would agree. I'm I'm free as well. Yeah. Yeah. Three. So, I went to the one in Paris last year and the year before that in my hometown Amsterdam. Oh, wow. There you go. I think I did four. Four. All right. Well, he's just one up now. One up there. I think this is my fourth as well. Yeah. And they did the North American one. Yes. Yeah. I saw you there. Yeah. Yeah. And then Salt Lake City. Ah, okay. Okay. Yeah. Love it. So, this is day two. We are at the Graphana booth. We've snuck in really early to talk about open telemetry. It's like the talk of the town at CubeCon at the moment. I would say at least like 60% of talks that we've seen has mentioned open telemetry in some form. Um, a lot around Gen AI and everything else and how we're standardizing semantics in open telemetry which is like above my head at the moment. But I think what we wanted to do was get to like the core of what open telemetry was again and kind of refer it back to Loki at some point. Um but I guess sir what could you sort of take us through exactly sort of what open cemetery is sort of what why do we have it and where did it come from? Yeah so open cemetery is a CNCF project so it's uh it's maintained by the community uh and it's uh you know an open project where everyone can contribute if if they want to. It's not actually owned by a specific vendor um as opposed to other projects. And the idea is to uh basically have instrumentation that that will be uh you know uh generic for everyone and base for everyone to use. So it's a it's it's there's no vendor looking and uh yeah it's it's a standardization framework for telemetry basically that's the that's the idea. Um I guess it became very popular with tracing first. So I think everyone knows open telemetry through tracing. Um everyone started with that but slowly you know the uh open telemetry team added more uh signal like uh uh metrics and then logs um and I think logs is now kind of like stable uh but yeah trace was stable for a while um and we also worked quite heavily on um adding profiling as the fourth build so that's true the the pyroscopes team at uh graphana uh yeah pioneer the uh the this new signal um I actually don't know where we are on the uh if it's like alpha or stable. I think it's still alpha. Uh but yeah, we have a fourth signal now in the open telemetry. Uh they were talking about even adding more right. There was something about adding some more front end things. Yeah. So yeah. Do we was it did we not donate um was it Faroh or Baylor? Sorry, Baylor to to the the foundation which was pretty cool as well. It was in the process of doing that. But it's it's interesting that you say like it it did start with Trac's, right? But Jay and I at Jay's talk, we there was a guy who came to the booth also and then and then went up to Jay and Tom at the end of their talk and he was he'd gone the opposite route. His company was just starting to get into like he he was basically building an observability stack and he felt pressured to go to hotel but they didn't actually need traces. He's just like, "We'll probably need traces later, but we want it to be future proof. We don't want to do something now and then have to change later." Like he was really seeking guidance for, you know, do you does he even have to do hotel? Um what are your views on that? Would you recommend if people were getting started now? What should should they go right away? So I think um if as we're talking about Loki today uh logging I think it makes a lot of sense. So uh if you are using open telemetry it's probably easier to get started nowadays with Loki. Uh like there's a lot of best practices uh that we uh apply when you use the OTLP endpoints in Loki. Uh and um that makes it way easier to make sure that um you don't need to think too hard about which labels to apply uh which is kind of a common challenge right for new users that are new to Loki and we also make sure that all the additional attributes that you get in open telemetry um app part of the semantic conventions if people know that term they also will be put into structured metadata in the right way. So we we just make sure that the data from hotel is stored correctly and it makes you just a little bit more um uh faster, quicker uh to get up and running with Loki. So yeah, I would definitely recommend it. So I guess from like fundamentally looking at open telemetry, you you get a ton of metadata, right, that comes with it and that's kind of like it's it's used to sort of combine all of the other different telemetry signals together so you have a more cohesive experience like with your data. Um, and I thought it was an interesting question when we spoke to him because he was like, "Oh, well, I'm already ingesting some logs into Loki and I'm already doing this in Prometheus. I can create correlations like in Graphana. I'm worried about the overhead of open telemetry. Like do should I should I jump onto this um how did he refer to it? jump onto this trend and and get on it is like what's what what would you say his benefit is if he just jumped on to open cemetery apart from best practices in in Loki is it that extra metadata that that insight between telemetry signals you get or is it you know the vendor lock in or yeah I think it's both so it's a it's a you when you use ametry you get the correlation for free so that's a big that's a big thing uh and you probably need to integrate multiple signal to leverage that um I guess the other the other big benefit is like no vendor login. So you you can just uh change the output source of where you want to store your data. So if you were using graph labs, you can move to another uh uh back end easily by just changing the configuration. So that's one of the another big one. Um and I'm not surprised I'm not surprised that uh you your user was talking about like starting with logs cuz you know what I said that um tracing was most popular at the beginning. It's because it just was the first and that's how the project started. But ultimately it's actually harder to start with tracing because it requires uh changes in in your code. You need to instrument inside the code or add add to your HTTP handler for instance. Uh so that's much more difficult for logs. It's actually not in the application. It doesn't is not very intrusive. It's it's a bit like a collector. It can be you know getting data from files or from like sys logs. So it's not really you don't need to change your app. So I think it's actually easier to adopt open geometry from the start using logs rather than tracing. So I said tracing because it's like history most people use it like that. But a new customer that wants to adopt I it does make sense that they start there for sure. Yeah. And and maybe also to the point where you say like it's vendor agnostic one one of the typical use cases I see when people are collecting logs in an enterprise context is that they're using logs for observability. They're also using logs for security. And typically security is kind of a different store. So people use typically a kind of a seam um like like Splunk is for example very popular. So what you can do with open telemetry collector is that you can choose which logs to send to Loki which is typically everything and then you're going to send a subset to seam. Yeah. Where it makes more sense to send like very specific log streams. Oh interesting. So you have like processes inbuilt that can kind of like redirect based upon like the sensitivity or Yeah. That's that's one of the the benefits of open telemetry is you have the flexibility to filter and routt data to the endpoints that make sense for you and as of course the uh open telemetry landscape matures all all the vendors and all the projects open source projects will support open telemetry. Yeah. Yeah. And I guess the benefit of that is that if you spend time engineering like your processor and filtering, uh you don't need to change that if you're going for another vendor. You keep that configuration, all the engineering you did around that for your platform. You don't need to change that. Just change the output and then you're done. So it's it's much easier to uh make a change. So what what would you say are some reasons not to go use hotel? See, me and Nicole are skeptics before we agree. That's a good one. Um actually I I think there's like cases where open termetry is a bit behind uh in in term of like there's probably some um you know logs types that are not accessible in open termetry. So I don't know if six log is the case. I think it's not I think it's fine but you know that's the the example of log you know log type that may not be available in uh open termetry. So like specific router logs that you that you have that open geometry doesn't support. So in that case, um I guess that's uh that's going to be difficult. And then obviously if you don't have the time, you know, it's it's it's definitively like you need to make a change. So you do need to uh uh invest, you know, in it. So if you don't necessarily have the time, I guess that's that's going to be a Yeah. Yeah. Yeah. And and maybe one use case that I can think about is sometimes people don't have like an always on connection to the database. Um so typically that's solved uh uh in two ways. So in uh uh like in our agents I know that we have like write a headlog um um but I'm not sure if that is already made it into our alloy which is our open telemetry distribution. Uh another way is just to solve it with Kafka in between but then you have another component that you need to manage right and typically when you're just starting out you want to keep it as simple as possible. So um it that might make sense in those types of scenarios but it's kind of an edge case. It's not kind of the normal case because most of my customers they uh that I talk to they are typically always always on always connected to the database. So talking about that with the the amount of customers that you're talking to um how many are looking to go sort of open telemetry how many conversations do you have and then sort of like what are the other routes? What's the other routes you can go if you don't want to jump onto the open telemetry sort of trend? Yeah, I I think most of the companies uh that are um looking to modernize their logging environment and that's why they're looking at Loki, I think they already make make the jump to open telemetry. It's like okay that we're rep platforming anyway so let's also do the ingestion uh correctly and use open telemetry because that's what uh the entire community is talking about like you said right all the booths that we have here around us they all all have like a very big open telemetry sticker uh which is great um uh so that's uh that's one uh reason the other uh conversation that I sometimes have is that they have already kind of a big investment in their existing infrastructure so one of the systems that I typically see something like fluentd or fluent bits and they're like okay uh we don't maybe maybe they cannot uh change that because of like the way that enterprises sometimes work it's like it's not always that standard it's like that's the standard uh it works for us uh so they need to work within that uh boundaries and then they can indeed uh and they will then uh ask us okay how can we use Loki uh with fluent and fluent bits and then we we help them there uh but like I said that's probably like an outlier. So I think 95% of the conversations is open telemetry. Oh wow. Yeah. Yeah. It's that big. Yeah. Yeah. We see with the So I'm on call for for the SAS product and I definitely see in the next in the last few years in uptick. It's not just like small startup that just you know start from scratch. There's also large company that have like platform engineering team and they're thinking about this and then they're moving to open temperature. So there's a big uptip uh we can see in in our cloud. Yeah, I can kind of see both ways because like uh there's a law called Gaul's law that says it's always easier to start with a simple system and then add complexity than it is to start with complexity and then need something simple. So it really I think depends on where the company's going and the growth and how what your what your needs are going to be. I mean we're here at CubeCon. Kubernetes is a perfect example of this where it was conceived as Borg by Google who had really complex needs. It was not a small shop. It started huge and then afterwards we saw like the mini cubes and kind like smaller kind of ways to use Kubernetes and it kind of seems like uh there are there are some people that obviously need should go to hotel and there are some people that are just testing out and should obviously not go to hotel but it's the middle bit where they're like well we're not quite there yet. it it would be a little too much complexity to go into hotel but what if we need it in the future anyway maybe we should you know take the leap that's I think where it's hard to decide where you fall yeah you do you do need to factor in like the the investment that you're going to have to do like we we talked about 3D 3D is probably a superet of open right now like open doesn't support all the features like for filtering transforming so if you're a relying on this it's a big change for you to to move to that and you're probably going to lose some of the features it's probably not a good choice right now. If it if you don't see if you already have correlation somehow, it's maybe not a good choice. Yeah. Yeah. And and some of the other reasons that I see is performance. So, uh the optric collector is um um compared to like systems like fluent bit which are very optimized for low resource environments. probably open tele optical elector I don't have the numbers there but my um my suspicion is that it's probably a little bit heavier to run it exactly what the guy said yesterday he that was his so at his company it was mission critical to keep like performance low and he that and so his concern basically came from the overhead that you know using an hotel collector and stuff brings and I said well um we do a lot of that within alloy to actually bring the overall performance down but you know you still have the overhead with all that extra metadata and all the the the push versus pull methods and you know everything else in between. So yeah and and what you will probably see is like opt is still relatively new. So you will see more and more performance improvements. So if you compare to like pro projects like Prometheus where uh like the the the way that the data is being collected and the protocol that's being used to send uh those metrics is incredibly highly optimized and but uh that project is around for I don't know how long the permission project already exists but it's around for a long time right so uh open termmetry will probably get there and that's also one of the benefits when you adopt like something that's so heavily carried by the community is that you get all those benefits of the community innovations out of the box. So that's uh I think uh one of the the reasons to go for it. So again I I I definitely think there are edge cases where it makes sense to go for a much more lightweight version. Uh but if it's a business scenario, it's a company scenario, I would definitely take the time and invest in open telev with we went all in with 3.0 zero to create sort of an OTLP endpoint. Can you guys talk exactly what the what this endpoint is and you know why is it so important for hotel compatibility? Yeah, OTLP is a is basically the the protocol definition uh for uh hotel for sending u you know telemetry data uh and so now we have a native endpoints that supports that and you don't need you know a transformation layer to be able to send from the collector to Loki anymore. So and automatically this endpoint try to figure out what are the good labels for instance for what should be a structure metadata we try to you know give you a you know better experience. Um I think before that we the way we were um adopting open term was via loi exporter. So it was like more like some sort of a plug-in that you install in in your collector like the hotel contributor. Yeah exactly. Yeah hotel contributor. And then you will you would uh basically uh set that up to make the transmission at the collector level and it will send the data um there. Yeah, we're laughing because these two strangers have walked up to the booth, start making faces behind the not really strangers. They let everybody in here. Oh, it's our CTO. So we're there's there's a big push now in graphana to make OTLP to make all of Graphfana project projects and databases first class citizens of hotel. What does that mean to be a first class citizen? Like what is the state of of hotel specifically in in Loki right now? Are you say would you say we're there already or not yet? Um so I I wouldn't say we're like fully fully there. There's there's more to do to make it uh better. Like the the Loki 3.0 Oh, was the probably the first step to say, "Yeah, we're in. We're going to we're going to go for this." So, this was just the first step. It's going to take time to get it better. Especially that uh the open territory um model is a bit different than the Loki model. Like Loki is supposed to be just like logs and labels. Open territory is like, you know, uh logs, attributes, and there's a tons of attributes. So, it's not it's not like a onetoone. Um so, we're changing Loki also to make it uh better with open telemetry data model. And then obviously in the in the in the future and we're looking at this right now as like making the UI much much better, right? So the UI right now kind of hides a bit those like uh metadata from uh open telemetry. We're trying to make them much better. So being able to see them from the start. So you know there's a lot of UX improvements to uh make open telemetry more first citizen. Yeah. Yeah. because because of that one thing is of course the Loki project in itself but the way that people consume it is using graphana and um uh so there's all kinds of stuff that we can do in graphana to make uh the data that's available within Loki more accessible so think about uh the recent improvements that we did in the drill down apps within graphana it's like if we leverage the uh the open open telemetry semantic conventions then we can have a much more powerful UI so the products doesn't up with the Loki server. It is definitely like all the tools that you use to interact with it as well. So, so without getting too much into the weeds, I think Ward, you sort of um indicated there sort of best practices that we kind of instill in in how we ingest data through the OTLP endpoint. So, is there if someone's experimenting say Loki um OSS and you can change these about is there certain attributes they should keep in mind that they should keep as labels versus structured metadata? Is there you is there a fear of getting too high in cardality and do we have to be careful of that and yeah that that's a great question and and the fun thing uh or the good thing is that we um Loki has a default config that does the right thing automatically. So if you use open telemetry uh like servo was saying it's like you have the log attributes and the resource attributes. So the resource attributes are typically low cardality. So uh when you're are used to Loki, Loki has a concept of streams, stream labels, but uh those stream labels we don't want you to put in like transaction ids or anything that has kind of a large range of values. We want to keep uh keep it quite limited. So think about like cluster name, namespace, that kind of stuff. These are like the typical good labels. So these are the resource attributes that you also have in open telemetry. Then you have the log attributes and log attributes can be anything that can be indeed a trace ID uh like a transaction ID, a user ID and what we do uh in Loki is we make sure that we map them correctly. So the ones that are low cardality are automatically mapped to the stream labels and all the other ones are going to be put in structured metadata and structured metadata is a way that we can store those types of labels and can interact with it but uh we support them in a high cardality fashion because we don't need to index them. So apologies for that. Um and um so we do the right thing automatically. So when you use OTP, you don't need to think about it actually. Just send it through OTP. Use the OTP best practices or the telemetry best practices and you should already have a good start starting point. Fantastic. Yeah. And u if you have any like additional attributes that you uh think okay these are important we do allow you to configure uh to have like an additional label so you can like promote and you can re yeah so one typical use case that I see and that's actually one one of the only use cases that I see where it makes sense to modify that uh default configuration is that people want to do team based attribution. So you want to uh make sure that you can for example uh have a showback dashboard or chargeback dashboard on what people are sending on a team basis. Uh it can also be like just using it for filtering in dashboards and that kind of stuff and there it makes sense to uh modify the configuration so that you can also send a team label as as kind of a resourceful work attributes and get it mapped to a stream label. Very cool. So what if someone was already using the Loki exporter that you said was there before? How would they migrate to using the OTLP endpoint? Is it like a big convoluted process? Um so you you need first to have the Loki 3.0. Uh so you need to upgrade to that depending and we have like documentation about upgrading to 3.0. There's definitively a change that you need to make uh in the in the configuration. You need to get rid of your Loki exporter. Uh and uh yeah, it's it's pretty well documented like we we we're trying to get people off the the Loki exporter because the experience is much better on the native endpoint. So, you know, we have a lot of documentation. I guess we we'll be able to share that after. Okay. Well, I still want to get into like the landscape of log collection in general beyond Loki, but I think we're has a meeting and I I feel like I'm feeling anxiety about So maybe if you don't mind, maybe we can continue the three of us and then we can let War off the hook. Yeah, that sounds like a great plan. Thanks. Thanks so much for meeting. Yeah, absolutely. It was great to have you. It's been awesome. Thank you for the invite and uh yeah, good luck. That's all right. See you later that customer call. Yes. Yeah. So, now that Ward has gone, we can talk about the really important things. No. No. It was good that Ward was able to join us for a while. Um, but I also wanted to talk about the like different ways that not just Loki but other other tools have have used to be able to get logs from within Kubernetes clusters in particular. um what are the what are some of the standard approaches and what are emerging? Yeah. So the uh so the open telemetry collector as a as a file input source um uh file input I guess that's the name and uh you can use that to collect uh pods logs directly from community and then you can add uh transformation that uh uses the uh community attributes. So the uh pod annotation uh labels and automatically add that to the uh files that you're scraping so that you are enriched. So your logs are enriched with like pose attributes and uh well metadata basically about uh the workload. So it's uh it's basically the uh the most common way. Um there is also uh the Kubernetes uh event receiver uh which is which I actually really recommend people to uh activate because it gives you uh the logs about the Kubernetes events that that are happening. So you know crash looping pods pods going out of memory replica that um have have an issue scanning app. So there's tons of events that you can alert on for instance if something uh is going wrong with your community installation. So in your opinion then um in terms of where where seeel at in terms of infrastructure monitoring for kubernetes do you think it's in a good place to get started or do you think there's other avenues people should try first and what's kind of like the best way to go? Is it is it better to look at alloy and go down the conventional methods and then swap later? What's the Yeah, I think so this is the an interesting question. So alloy is like distribution of uh the open open telemetry collector and it's basically support the same but it's an addon. So it has more feature to it. Uh and we definitively provide a lot of features around like sis log receiver journal D receiver. So sometimes depending if you have a custom installation of a cubernet a lot of logs from uh the cublet and and you know the component of kubernetes or tcd for instance will be on journal and you can collect that. So it's the alloy is a way to enhance a bit more on top of the uh um open telemetry collector. Obviously I expect the open telemetry to catch up and add all all those feature but it's a good way if you were already having all of this to not lose it that that's the reason why to use uh I guess alloy uh and obviously it still supports promoters uh and uh and you know it's a first class citizen for using web mloud. So I guess you get like the best of both worlds. keep your standard pipelines that you had and and so we like because we integrated promtail into alloy. There was ways of scraping logs like pod logs through using prompt tail. So you can now use that through alloy and then wait for some of these other features to be in. Yeah, for sure. Yeah, pod logs is another interesting one. If you if you uh if you have a you know a cluster where you don't necessarily want to run the collector as a as a demon set so have the uh the pods on every node you can actually scrape the logs from the community API directly. So that means that that means you can run it as a as a deployment and you just collect uh the logs like this. So that's a that's a pretty cool feature. I think it it works through CRD. Uh and to make it simpler we have a we have a Kubernetes monitoring chart. Yeah. uh that that allows you to set up all of this. So this alloy is baked in and everything is pretty much uh well configured for you. Let's shout that out because we actually also have the Kubernetes monitoring Helmchart office hours that we that's on the same channel. So I'm going to leave a link over there um and also in the description below because uh Pete Wall has already done a bunch of other uh I think he's done like maybe five of them or so. Massive shout out to doing that by himself the whole time. He's done a great job. Yeah. If you if you want all the telemetry signal for Kubernetes is definitely the M to look for you definitely get everything from the start. So you know we talked about the Kubernetes event logs you're going to get that for sure and then you have many option of scraping uh the logs as we said and you can use what what fits your use case. I mean I do massive shout out Kubernetes helm chat we've been uh in another Loki community call we'll look at like meta monitoring for Loki and it's actually allowed us to completely sort of like sunset the old methods of meta monitoring and then just use the Kubernetes meta monitoring helmchart to with the Loki integration just to do most of the health metrics for Loki. So a win. Yeah. So I guess sort of like I guess rounding us off, you know, we we've talked a lot about like Kubernetes, talked about about open telemetry. Um what are you excited for next? What would you like to see coming from open telemetry? Um it may not have to be to do with logs. Is there anything else that you would like to see have semantic conventions? And um I'm excited to see about what's going to happen with EVPF definitively. So you know uh profiling is one like if if everyone is already using uh the open telemetry collector if with just a configuration they suddenly can start activating on all the host um via eB profiling that would be insane right that's that's probably one of the benefit of having uh the open telemetry collector is you know when new features are added you just you know configure it and you get it done and you're done and you get the new features and one of the features I'm excited about is definitely profiling the IMPTF via what? Give you a Jeff. I hear there was a cool talk yesterday from Marilia. What was that on Nicole? It was like Yeah, it was on semantic conventions like um having open telemetry semantic conventions so that it could be adopted by databases not just looking but just multiple databases and all the databases if possible. Um because it's good for the whole industry when that happens. When you standardize on something and you agree on these conventions, then it means you can change it means that you are actually achieving the neutrality that open telemetry was built for the the vendor having no vendor lock in. It was really cool. Yeah, she she mentioned it took a year to get to this point because no one could agree on the definition of a table because everyone was told it was different than or like some databases didn't even have tables. So, like what what does that mean then? Well, I think this has been a really good lowkey community. I'm so glad we actually made it happen. This is pretty wild. An early start to the day. Yeah. And also, the music came on and people are starting to arrive. So, yeah. Kicked out. Yeah. Well, Sarah, thank you so much for coming on again. It's always awesome having you having you off again on again. We're going to be having you on to talk about something super exciting. Yeah, we're we're going to talk about the new UI plugin. Did he say UI? Okay, we better stop that. Okay, stay tuned for that. Thank you everyone for watching and we'll see you next time. See you later. Bye. That was cool. That was great. That was good. That was great. But how do we start? Guys, what's the I don't want to press the wrong button. Just stop recording. Which one? Is it the red one here? Yes. You never or you record through OBS.

