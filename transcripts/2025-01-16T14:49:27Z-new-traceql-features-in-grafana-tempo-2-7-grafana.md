# New TraceQL features in Grafana Tempo 2.7 | Grafana

In this video, Joe Elliott does a deep dive demo into the experimental TraceQL features in Grafana Tempo 2.7. Blog post: ...

Published on 2025-01-16T14:49:27Z

URL: https://www.youtube.com/watch?v=0jUEvY-pCdw

Transcript: hey everyone my name is Joe Elliot and I excited to release Tempo 2.7 uh just this week and we have an exciting set of new Trace ql features as well as a lot of performance improvements memory improvements a lot of operational improvements so I really think it's a very strong uh Tempo release so Tempo 2.7 let's get into some of the new Trace ql features um right [Music] now so first of all we're going to talk about a new scope uh when I say scope we're talking about uh if you've typed a lot of Trace ql you'll know like resource scope or if you're familiar with otel observability open Telemetry there's also a span scope so I can query for attributes on my spans on my resource and the new one we added is called uh instrumentation so instrumentation is a scope in the open Telemetry specification that uh contains information about your like instrumentation it's actually kind of vague and it seems to be uh kind of particular to different applications as well as the libraries they use so I have a link to the um to the documents here and the documents kind of get into this I recommend reading through this but it's basically like any kind of logically connected section of your code and let's look at some actual real world examples because just kind of reading through this probably is not going to give you a strong idea but uh everything we're about to look at is the open Telemetry um demo so their actual demo code so we should presume that these values are are pretty well set right presumably these are somewhat correct um so if I go in here and look at instrumentation name and do my autocom complete this is again all from the open Telemetry demo I'm seeing a lot of service names so I presume you know this instrumentation scope is the entire service but here you know kind of looking around I see some Library names system net HTP is a net Library um and we can see the names of some other ones I see like a grpc here um some other kind of examples as I go down through sonat not sure what that is I think uh some folks know I'm sure but a lot of these different libraries are just different like sections of your code right so let's kind of get focused on one here um if I look at uh grpc and do a query I can see a handful of different services that are performing grpc calls so in this case I'm looking for an instrumentation scope a section of this code uh the actual service is called front end I can see um and then if I look down here and fa I'm looking at the actual uh Trace itself right I can see that uh the instrumentation name is instrumentation trpc with a version here as well so this is a really good way to look for applications that are using specific libraries or maybe specific uh uh versions of open Telemetry uh and we can use this maybe more at an operator level than a user level I actually be really interested in seeing where people use this uh a query that occurred to me that would be kind of fun is uh by resource service name so I'm going to take that original uh query there I'm going to look for spans where the instrumentation name is this grpc library and let's rate by the service name and this is going to quickly show us what applications are using this grpc Library so this could be really cool maybe it's a way as an operator you can find applications in your you know out in your uh infrastructure that are using different libraries maybe they're on an outdated one and you're looking to move them forward maybe you could use this to find people here using CCO or people who are using you know system net HTP or whatever so it gives us some nice flexibility there I'll also point out uh that we have Exemplar support this will be in grafana 11.5 so not out just yet but it's coming very soon uh but we have Exemplar support in Tempo in 27 we fixed some bugs uh and it was actually in 26 in 27 we fixed some bugs and then in grafana 115 we have actual support uh in the UI so I did my uh Trace ql query there um I can see that I have my uh Exemplar little examples here and I can jump to the traces that were aggregated to create this metric it gives me a really clean way to immediately jump in and see some of the traces that you know were aggregated to create this metric so I think that's a really awesome feature uh that people are going to enjoy so instrumentation scope is our new scope and it's going to allow you to ask new questions of your traces uh at this kind of like uh Library kind of level like what applications are using what library in your in your infrastructure uh the other uh the other set of functions we added to trace ql are average over time so average overtime is going to take a number of some sort I'm going to put a little placeholder here that's not real chice ql so we have average overtime uh we have Min overtime Min and we have Max overtime so three new metrics functions average Min and Max over time and in this uh in the field here the parameter that's expected is any number basically that it can average to so we're going to do duration that kind of makes a lot of sense right this is going to me give me my maximum span duration over time uh for the uh for the specified spans here so I took this F or this query instrumentation name is this grpc Ser or Library I then pipe that to Max over time and I ask for duration and I think duration is one that's going to probably be most commonly used and make the most sense I'm probably looking for like what's my average call times what's my minimum call times what's my Max call times you know so Min average and Max are the three new Trace ql functions metx functions we've added I mean I'll point out and I think this is one of the fun parts of Trace ql uh is that uh because this function takes any number duration is going to make a lot of sense but we can do kind of fun things maybe silly things depending on how you look at it like we could ask for the average status code this is kind of a silly thing I don't expect a whole lot of people to do a query like this but but it's possible uh because Trace ql is a very flexible language uh minimum overtime status code maximum overtime status code so definitely some fun kind of uh queries there again just pointing out the flexibility of language any number is going to go into these metrics functions so Trace ke roll we added the new instrumentation scope as well as three new metrics functions average overtime Min overtime Max overtime also very excited to have a nice set of bug fixes to exemplars in 2.7 along with in grafana 11.5 so you can start you know writing queries in your front end in your Trace ql Explorer uh and immediately jumping over to those traces uh that were used to create that metric all right uh hope you all are having fun with Tempo 2.7 expect some performance improvements as well as resource uses improvements and the features we talked about today uh take care everybody

