# Madrid, June 27, 24 - Meetup de verano üèùÔ∏ècon Grafana &amp; Friends en Celonis | Grafana &amp; Friends

1. Innovando con Grafana: Observabilidad y Mejora Continua en Datisa - Miguel Angel Diez - Responsable del √°rea de ...

Published on 2024-07-09T09:17:37Z

URL: https://www.youtube.com/watch?v=VVNHXU7wZ3A

Transcript: bueno bueno Muchas gracias por estar aqu√≠ a todos os vamos a Bueno vamos a intentar explicara hemos hecho un viaje hacia la observabilidad antes de todo tamb√©n dar las gracias a celonis por supuesto por estas instalaciones tan fant√°sticas y dar las gracias a grafana no y a todos los que han participado para que podamos Pues eso contaros esto nuestras batallitas no Nuestra Empresa C√≥mo hemos abordado observabilidad bueno Yo soy Miguel √Ångela Yo soy el responsable del √°rea de desarrollo de latisa latisa Somos una empresa de producto tenemos un rp Y bueno pues mi compa√±ero es Yo soy t√©cnico de y de los servicios web y buo importante soy leon√©s esto es importante para decirlo orgullo leon√©s bu Y bueno pues vamos en principio datisa es una empresa que lleva eh en en el mercado desde 1979 vale eh Como os imagin√°is pues eh en el sector inform√°tico lo que ha cambiado desde 1979 hasta hoy ha sido ha sido impresionante nos nos caracterizamos porque nos adaptamos a los tiempos nos adaptamos a las circunstancias Y bueno pues uno de los cambios que que hemos realizado es eh Buscar la observabilidad dentro de nuestro producto con el fin de conseguir que nuestros clientes Eh pues eh nos acerquemos m√°s a ellos sepamos C√≥mo C√≥mo trabajan C√≥mo funcionan Para ofrecerle mejores servicios y para que estemos mu acercar ellos que es lo que pretendemos no os voy a contar un poquito as√≠ brevemente de d√≥nde venimos no y hacia d√≥nde queremos ir en datisa Eh bueno la observaci√≥n la salsabil dad esto es un t√©rmino que se emplea ahora mismo pero realmente siempre hemos observado los sistemas inform√°ticos no O sea desde que comenzaron lo que pasa es que antiguamente pues hac√≠a manera se hac√≠a a trav√©s de ls ficheros no se mandaban se pod√≠a hacer tambi√©n a trav√©s de los usuarios no le preguntabas Oye c√≥mo qu√© ha pasado no cu√©ntame c√≥mo manejas la aplicaci√≥n no entonces Bueno qu√© pasa todos esos mecanismos esos caminos que utiliz√°bamos eran pues lentos no y no eran muy muy eficientes y muy poco exactos no entonces eh Hacia d√≥nde queremos ir bueno consideramos en que la observaci√≥n es fundamental es fundamental para conseguir acercar Nuestra Empresa a nuestros clientes es decir eh observando las cosas conseguimos saber c√≥mo c√≥mo funcionan las nuestros clientes las personas C√≥mo podemos mejorar d√≥nde est√°n nuestros clientes dici√©ndonos con el producto que Eh hay problemas por un sitio o por otro vale Entonces nos da una una informaci√≥n fundamental para poder acercarnos m√°s a nuestros clientes y hacer lo que consideramos fundamental empresa desarrollo de Software que es mejorar continuamente de acuerdo Entonces la observaci√≥n es fundamental para nosotros e Entonces vamos hacia ese camino de de observar os voy a comentar un poquito C√≥mo funcionamos desde que hemos empezado con grafana Y c√≥mo nos ayuda grafana hacer este camino de la observaci√≥n es decir esta herramienta para nosotros ha sido eh impresionante porque tenemos ahora eh un sistema de de de control de de de acercarnos a las personas de sa ver c√≥mo est√°n trabajando con la aplicaci√≥n ahos contar√° √ìscar entrar m√°s en detalle de c√≥mo lo utilizamos y es alucinante porque hemos conseguido una cosa que para m√≠ es fundamental en unaem precia es acercarse a las personas que manejan tu producto de acuerdo Entonces ahora os contar√° un poco Oscar no eh Entonces como veis aqu√≠ Bueno lo que contamos es que no tienes una empresa tienes un socio o sea realmente las empresas de desarrollo producto antiguamente eh lo que vend√≠amos era producto entonces nuestro negocio era vender producto yo creo que hoy en d√≠a hacia donde vamos es a a utilizar ese producto para acercarnos a cubrir las necesidades de nuestro cliente es decir el producto es como si fuera una herramienta que tenemos en datisa para para acercarnos a nuestros clientes de acuerdo y bueno Pues un poco eso es lo que lo que os quer√≠a contar Vale ahora el objetivo de esta presentaci√≥n fundamentalmente como os he dicho es que os vamos a contar Bueno pues lo que hacemos si os sirve a vosotros de ayuda saldremos satisfechos no porque este es el objetivo conseguir que vosotros con lo que os contemos os ayude en vuestros negocios en vuestra en vuestro √°rea y bueno para eso un poco dejo a a √ìscar que que que bueno os va a contar un poquito todo esto todo el camino y que adem√°s es el experto vale Much√≠simas gracias Pues eh No s√© cu√°nta gente hay que es desarrolladora que trabaja en producto etc√©tera etc√©tera no pero una simple frase de que√© es la observabilidad para que todos partamos de una de una base muy muy simple pu es un poquito como la definici√≥n que hemos puesto Ah pues pensar como bien dec√≠a Miguel que los sistemas inform√°ticos es muy importante el tener claro qu√© es lo que ocurre hist√≥ricamente siempre en una caja negra la famosa caja negra y no ten√≠as ni idea de qu√© ocurr√≠a dentro de tu producto esto os pod√©is imaginar que en 44 a√±os de historia Pues aqu√≠ ha ocurrido no sab√≠amos lo que ocurr√≠a dentro del del propio producto eem datisa tiene unas necesidades especiales tiene unas necesidades que quiz√°s en vuestras empresas esto siempre cuando yoy una charla Me parece muy interesante focalizarlo y bajarla a lo que a m√≠ me interesa no nosotros vamos a contar c√≥mo lo hemos utilizado nosotros y vosotros pod√©is ir pensando Oye c√≥mo lo pod√©is ir encajando en vuestro sistema nosotros ten√≠amos las necesidades de la monitorizaci√≥n de las m√°quinas nosotros nuestro producto se vende tambi√©n en los Sas y en los hosters pensemos que esto cuando nosotros lo montamos era Pr√≥ximamente 2017 20188 Entonces ya ha llovido vale en los a√±os que han pasado en en el tema inform√°tico bien sab√©is que unos 6 a√±os es un tiempo m√°s o menos prudente tambi√©n necesit√°bamos dar soluci√≥n a incidencias tanto graves como irre reproducibles de nuestros clientes nos encontr√°bamos con errores eh que eran irreproducible y que son los errores que m√°s nos cu cuestan luego tambi√©n necesit√°bamos optimizar procesos como bien os pod√©is imaginar en 44 a√±os de historia hay c√≥digos de programaci√≥n est√° la aplicaci√≥n est√° hecha en C y en c+ m√°s os pod√©is imaginar que hab√≠a Books y que hay Books e que son muy raros y que hay c√≥digo de Dios sabe c√≥mo e y luego por √∫ltimo que no est√° en un orden de acuerdo mejorar la experiencia de usuario para nosotros es clave que el usuario est√© contento con nuestro producto muy bien eh Me he pasado voy la siguiente vale como os he comentado el proyecto lo comenzamos en 2018 eh nacimos de una manera muy org√°nica a utilizarlo e resultaba que en 2018 e Cuando entr√© en la empresa eh ten√≠amos a una persona de producci√≥n eh que se encargaba de revisar las m√°quinas los Sas y los hostings todos los lunes durante unas 6 horas ten√≠a puesto pore dar la risa a algunos vale Pero s√© que hay pymes nosotros pensamos que somos pymes vale es decir pensar que la pyme respecto a una multinacional los recursos son muy limitados y el recurso hay que apuntarlo y focalizar a veces ocurre que precisamente por intentar focalizar tienes a personas haciendo trabajos repetitivos porque siempre se ha hecho as√≠ no esta famosa frase que a muchos nos refat Eh entonces esta persona ten√≠a 6 horas de agenda revisada revisar los s los Hosting etc√©tera etc√©tera imaginaros 2018 2017 eh qu√© ocurr√≠a que que revisaba si los discos duros se hab√≠an llenado si la cpu estaba correcta etc√©tera etc√©tera Pero si el lunes por la tarde se ca√≠a la m√°quina qu√© ocurr√≠a pues hab√≠a que esperar a que el cliente te llamado Ten√≠as que ser reactivo y nada productivo por lo tanto eh Como muchos que han empezado a utilizar grafana fue utilizando promicious no con el ww mi sporter etc√©tera etc√©tera entonces al montarlo os pod√©is imaginar eh el cambio que hubo no s√© de aqu√≠ Cu√°ntos recuerdan grafana 5 o grafana 6 Qui√©n ha utilizado grafana 5 o grafana 6 est versi√≥n 6 esta imagen Es muy importante y os la pongo porque justo eh hemos actualizado versi√≥n 10 y pico hace un a√±o hemos estado con versi√≥n 67 es esta en concreto que nos normalizamos en 6,7 hace un a√±o para nosotros no s√© cu√°nta gente trabaja en en pyme o tal vale eh pero para m√≠ es muy importante esto y quiere decir una cosa que los chicos de grafana cuando hacen un producto lo hacen muy bien porque hemos estado durante muchos a√±os con el mismo producto sin actualizarlo y si√©ndolo Eh Yo estoy muy contento con ellos aqu√≠ simplemente lo que ve√≠amos es sistema de m√°quina Aqu√≠ vemos la ram todas estas historias vale la cpu eh discos duros y evidentemente esto tiene un sistema de alerting que nos avisaba Pues cuando hab√≠a una ca√≠da para nosotros era suficiente y hab√≠amos pasado de edad de piedra o sea pr√°cticamente a Edad Moderna para nosotros continuamos e con Al poco tiempo de trabajar con promius eh claro El Salto l√≥gico era Oye aqu√≠ Hay que meterle trazas a todo nuestro sistema que es un rp que como bien sab√©is los rps es de los programas en programaci√≥n de los m√°s ca√≥ticos no porque el programa est√© de mal hecho sino porque puedes hacer 1000 cosas de 1000 maneras distintas y la caridad de pruebas que puedes hacer son infinitas recordemos no perdemos el foco 44 a√±os rp T√∫ pod√©is imaginaros test unitarios no existen test tampoco existen qu√© era eso no exist√≠a Vale entonces eh toda la observabilidad que nosotros pudi√©ramos dar a todo el producto eh marcar√≠a la diferencia muy bien en qu√© nos centramos aqu√≠ por ejemplo ya empezamos a tener trazas de sistema donde ya podr√≠amos ganar bastante en en competitividad respecto a como est√°bamos nosotros antes podr√≠amos saber desde qu√© puntos geogr√°ficos son los que nos est√°n eh atacando desde qu√© puntos geogr√°ficos m√°s nos est√°n no busc√°is datos de clientes porque no hay ninguno en principio los he tachado todos vale No eso hay azul no es que salga as√≠ que no s ni niif ni nada eh Porfa y si sale dec√≠melo que paso r√°pido e ver√≠amos Pues bueno mapas calientes Esto est√° muy chulo para la gente de de producci√≥n o para la gente de de producto para a saber desde qu√© punto son los que m√°s me est√°n interesando eh luego evidentemente Eh Esto creo que tiene un l√°ser que no s√© si funciona no refleja Bueno pues aqu√≠ esto eh es un histograma que nos puede ser muy √∫til fijaros que bobada nosotros cuando actualizamos en los en los Hosting t√∫ no sabes si el cliente est√° trabajando est√° trabajando nosotros como somos rp tenemos gente que trabaja de noche gente que trabaja de d√≠a gente que trabaja alternas entonces t√∫ cuando quieres actualizar el producto t√∫ no sabes cu√°ndo puedes actualizarle Entonces hasta hist√≥ricamente antes que hac√≠as acordaba con el cliente una fecha y un tal al tener un histograma y una evoluci√≥n de cu√°ndo est√°n trabajando nosotros podemos decidir hacer algo parecido como hace Microsoft pero intentamos hacerlo un poquito mejor que ellos es actualizar sin molestar al cliente gracias entonces lo que intentamos es actualizar Pues cuando es de noche cuando detectamos trabaja de noche pues lo intentamos actualizar en las horas de d√≠a al rev√©s en horas que no trabajan gente que trabaja fin de semana etc√©tera etc√©tera Bueno luego eh 2018 algunos trabaj√©is con op etc√©tera etc√©tera no exist√≠a de aquella de acuerdo nosotros nos hemos sacado de la manga Entonces nosotros mentamos hicimos como las diferentes niveles de de logs que pod√≠amos estar detectando eh Pues los fatales los errores los Warning etc√©tera etc√©tera e luego los nos parec√≠a muy interesante las opciones que m√°s estaban utilizando los tiempos m√°ximos los tiempos m√≠nimos la moda porque puede ser que un pico puntual tuvi√©ramos eh una opci√≥n se tardara durante mucho tiempo pero que fuera algo inusual porque pues est sacando la contabilidad de los √∫ltimos 10 a√±os de una empresa que pu imaginal como puede ser pues multinacional que tiene mucha facturaci√≥n Pues eso tarda un ratito vale e bueno Esto un poquito as√≠ la idea para que ve√°is unos gr√°ficos vale como se graba no puedo hacer demos ni nada lo siento em Bueno entonces Cu√°les son los casos de uso espec√≠ficos que tenemos en grafana pues como hemos visto eh la monitorizaci√≥n principal El el entendimiento de c√≥mo funciona nuestro cliente todo el an√°lisis que podemos hacer de su comportamiento y tambi√©n nos interesa mucho la detenci√≥n de riesgo de Fuga que vamos a ver ahora tambi√©n en un poquito monetizaci√≥n de usos de m√°quina b√°sicamente lo que hemos visto vale Lo que pasa que ahora las opciones m√°s modernas eh Ya es un poquito se ve un poquito mejor que lo que habemos visto antes y pero en concepto es lo mismo versi√≥n actual versi√≥n 67 a nosotros para andar por casa nos vale Exactamente igual es datos de m√°quina Donde nos va a ir avisando en el caso que m√°quinas se caigan discos se llenen eh las bases las bases de datos las copias no se est√©n realizando etc√©tera etc√©tera un cliente no pueda acceder o incluso e una posible riesgo de brecha de seguridad de que est intentando acceder a una m√°quina nuestra nosotros lo que nuestros nuestros Hosting son Linux vale em esto es muy importante para nosotros y es entender c√≥mo funciona nuestro cliente creemos que uno de los puntos maestros en cualquier empresa es entender c√≥mo funciona tu cliente eh con una intenci√≥n es ayudar a ese cliente a mejorar a aumentar su facturaci√≥n si t√∫ ayudas al cliente el cliente dejas de tener un cliente para tener un socio no que es un poco tambi√©n el concepto que queremos eh tener con ellos e Cuanto m√°s conozcamos al cliente eh su experiencia ser√° mejor porque nosotros trabajaremos para que su experiencia cambie y trabaje de una manera pues m√°s reactiva no eh Y por supuesto e no s√© de aqu√≠ los lo de los Warning que nosotros tenemos decimos una frase muy chula que la haby a robar a Miguel es un ejemplo e que pone muchas veces el ejemplo de un parking no vosotros pod√©is entrar a un parking y si todas las columnas veis que tienen un mont√≥n de golpes por todos los sitios corr√≠ si lo cuento mal pero es algo as√≠ Eso quiere decir que quiz√°s esas columnas no est√©n en el sitio mejor puestas No porque no tiene sentido que en un parquin toas las columnas tengan un mont√≥n de goes Aunque la gente conduce muy mal pero eso no lo queremos pensar queremos pensar que no est√° bien construido no entonces queremos ese esa idea y por lo tanto t√∫ puedes dise√±ar un camino perfecto en programaci√≥n porque de aqu√≠ no s√© cu√°ntos son programadores o relacionados y mamente Vale pues nosotros podemos dise√±ar un camino que decimos esto Cliente va por aqu√≠ tal Y luego que te encuentras que el cliente va por donde sale no Entonces esto para nosotros son desperdicios y esto porque el tiempo que t√∫ has dedicado en ponerlo alquines en ponerlo perfecto to maquetado todo Tal para que luego el usuario no lo utilice mal entonces hay que detectarlo lo antes posible subir a producci√≥n detectar que el cliente lo est√° utilizando que le es v√°lido y en funci√≥n de eso actuar no continuamos eh detecci√≥n de riesgos de fua este panel para nosotros eh es muy interesante vale esto Bueno voy a ver algo un segundo de mur vale riesgo de fuga La idos crafia que vivimos ahora respecto a la que viv√≠amos antes ha cambiado por completo pensar que antes un usuario cuando ten√≠a un error llamaba o enviaba un correo no Pero de aqu√≠ cuando falla Netflix o Movistar o or Cu√°ntos llama atenci√≥n al usuario de de producci√≥n o les Env√≠a un correo o un algo nadie no Entonces qu√© haces s√≠ env√≠a peroo pero nosotros yo no env√≠o nada entonces hay una cosa m√°xima que es cuando te cabreas t√∫ te vas no dejas de utilizar ese producto porque dices no me vale Por qu√© Porque es mi obligaci√≥n como producto como due√±o de producto eh de detectar que est√° fallando y corregirlo no puedo estar esperando a que me avisen no hay que dejar de ser reactivos para ser m√°s productivo no en en el sentido de de todo lo que viene siendo las las fallas entonces de esta manera pues montamos paneles espec√≠ficos para poder detectar cuando un cliente detectamos que puede estar caliente o que puede ser susceptible a que se puede ir y no queremos que se vaya o sea si se quiere ir que se vaya pero que se vaya con motivos eh de peso y y razonables no pues porque una opci√≥n le haya fallado y nosotros no nos hemos enterado de que esa opci√≥n le est√© fallando cuando va a hacer una declaraci√≥n a la agencia tributaria le haya dado un error y nosotros no nos hubi√©ramos dado cuenta Eso no lo queremos y nos tenemos que dar cuenta y no falla Eh vale e aqu√≠ llegamos al punto Por as√≠ decirlo el m√°s importante o el que m√°s ha cambiado todo el concepto mapa conceptual de datisa que es el tema de los errores antes pregunt√≥ Cu√°ntos sois programadores han levantado pocos la mano pero estar√©is acostumbrados a tener errores os pongo en mapa de concepto para que os hag√°is un poco el ejercicio como cuando llegu√© en 2018 eh casi la mitad del tiempo dedicado eran errores el 40 y pico por del producto que se realizaba era correcci√≥n de errores y aqu√≠ hay gente que puede levantar la mano y decir que no miento esto es un esto es un problema como pod√©is imaginar no puedes estar desarrollando para corregir errores el error evidentemente va a existir porque no lo puedes quitar pero tiene que ser tendencia cero no puede ser que el 40 y pico por sean errores t√∫ tienes que hacer producto es para lo que t√∫ tienes que aportar valor y encima algunos de estos errores son los m√°s divertidos los desarrolladores se acordar√°n son los que llevan el apellido irreproducible estos son los m√°s Guay de todos porque no tienes ni idea de por d√≥nde cogerlo y el cliente tampoco tiene ni idea Por d√≥nde cogerlo o sea que es divertid√≠simo qu√© ocurr√≠a con estos errores pues ten√≠amos algunos que llegaban a decenas de d√≠as pod pensar centenares de d√≠as tambi√©n hasta 700 d√≠as un error en el que el cliente no se le daba soluci√≥n Por qu√© Porque igual era una declaraci√≥n que hab√≠a presentado era un error tipo rar√≠simo que no sab√≠amos qu√© hab√≠a ocurrido eh de aquella se sonaban de aquella las famosas frases que a muchos os sonar√° de hay que traer los logs vale la que ya se usaban esas frases eh Y a√∫n as√≠ no se le daba soluci√≥n al cliente porque ni el cliente ten√≠a idea de que estaba ocurriendo ni nosotros pod√≠amos darle soluci√≥n esos 700 d√≠as no hab√≠a un programador detr√°s para corregirlo vale esperar un poco prueba y error y al ser irreproducible era un jaleo a todo esto a d√≠a de hoy en el √∫ltimo a√±o el 2023 el tiempo medio de de resoluci√≥n de este tipo de incidencias ha pasado a menos de 22 d√≠as vale o sea para que ve√°is la diferencia de de tiempo de unos a otros sigue siendo alto 22 para m√≠ s√≠ Lo que pasa que puede ser incidencias que solamente produzcan una vez y haya que revisar que es lo que ha pasado y hay que esperar a que vuelvan a pasar no imagin que son incidentes que pasan una vez cada semana una vez al mes hay que intentar que vuelva a ocurrir no eh cosas que hayamos eh corregido gracias a este tipo de errores Pues problemas que hemos tenido pod ar muchos pero como est√° siendo grabado no puedo contar todo lo que me gustar√≠a despu√©s podemos hablar y os digo ejemplo pero ten√≠amos errores en la aplicaci√≥n que llevaban igual eh hab√≠amos creado incidencias de intentar encontrar el problema durante m√°s de 10 a√±os y no se hab√≠an encontrado el problema ni para jor idea ni el cliente ni nosotros pod√©is imaginar la frustraci√≥n que tiene para cliente como para desarrollo para producci√≥n para toda la organizaci√≥n no al final cuando gracias al sistema nos hemos nos dimos cuenta de Cu√°l era el problema era simplemente que no le daba a un enter el usuario te r√≠es despu√©s porque dices me cago en la leche todas las pruebas que habemos hecho y habemos dado aqu√≠ y era dar un enter y el sistema nos lo dijo gracias a la a la trazabilidad y la observabilidad Muy bien pues el siguiente ser√≠a el impacto de grafana que ha tenido en latisa esto creo que para nosotros eh Como bien comentaba Miguel eh ha sido fundamental tatis yo creo que ha tenido un antes y un despu√©s desde la implementaci√≥n de grafana como sistema vamos a ver eh tenemos muchas mejoras vale os pod√©is imaginar mejoras eh operativas en todo lo que es el sistema eh reducci√≥n de tiempos liberaci√≥n de una persona 6 horas Todas las pu√±eteras semanas haciendo algo similar que encima no tiene sentido Porque si se cae la m√°quina por la tarde has perdido 6 horas e hemos reducido el tiempo entre que un cliente te avisa eh a a darle soluci√≥n eres capaz de ser proactivo Y en lugar de esperar a que el cliente te llame t√∫ ya saber si ha habido un fallo ya puedes incluso corregir el fallo avisar al cliente es decir lo tienes ya arreglado esto os pod√©is imaginar que es un cambio brutal que no se podr√≠a haber hecho de otra manera eh Y esta es un punto tambi√©n muy importante que es la optimizaci√≥n de procesos cr√≠ticos nosotros como rp trabajamos con algo eh muy importante pod imaginar con persona frontal dinero es es lo que al final trabajas por dinero entonces en el rp t√∫ dile a una empresa que gana mucho dinero que la suma de balances hay un descuadre no le va a hacer gracia es un c√©ntimo no le va a hacer gracia igual aunque sea un c√©ntimo no le va hace gracia Entonces nosotros tenemos procesos que est√°n hechos en C en c+ m√°s de hace mucho tiempo esos es c√≥digo legado Premium es c√≥digo legado guapo y ese c√≥digo no sabes lo que hace realmente porque bueno c code aquella no exist√≠a ch unitarios como decimos tampoco os pod√©is imaginar No o sea eso son ifs If If If y de canches entonces meterle mano ese c√≥digo tiene un riesgo brutal de acuerdo Entonces Nosotros hemos utilizado grafana hasta para esto Esto es un poquito como la la del la del Ay lo dir√© la del crecepelo no la f√≥rmula del crecepelo estamos grafar un poquito a todo como pod√©is ver lo utilizamos tambi√©n para optimizar procesos que son cr√≠ticos eh c√≥mo lo hacemos indirectamente realizamos y os comento superr√°pido sobre todo para los desarrolladores o para productos y os quer√©is quedar un poquito con la idea Entonces tenemos funciones que son antiguas no que sabemos que est√°n funcionando y que nos est√°n dando de comer que decir aunque sean antiguas t Oye Muchas gracias porque es lo que ha dado de comer la gente antes que a m√≠ y lo que nos da de comer ahora vale est no nos podemos olvidar el c√≥digo alado Oye Muchas gracias Pues tenemos funciones donde sabemos que est√° funcionando genial de acuerdo pues nosotros hacemos una similitud de esa funci√≥n con c√≥digo correcto m√°s actual m√°s nuevo etc√©tera etc√©tera y esos c√≥digos Al fin y al cabo esas funciones devuelven valores Por as√≠ decirlo No pues imaginaros una un balance de sumas y saldos esto no deja de ser para que me entend√°is es cuando entr√°is en la cuenta bancaria la suma de saldo es la suma que del debe lo que ha salido vuestra cuenta lo que ha entrado al final de todo os pone el el saldo que ten√©is no los millones de euros que teng√°is en la cuenta y si eso me hac√©is un Pues de todo ese dinero que pongan esa suma y saldo eso es un poquito lo que hac√≠a antes no que es lo que hacen las empresas para poder funcionar en este en este ejemplo la balance de sumas y saldos al sacar la contabilidad de 10 a√±os est√° una de las empresas pod√≠a tardar unas 5 se horas pod√©is imaginar un listado 5 o 6 horas es un tiempo Oye est√° chulo eh lo dejaban lanzando por la noche porque tardaban un poco sobre todo cuando hacen los cierres anuales Oye c√≥mo va ido la empresa C√≥mo va ido evolucionando Respecto a los √∫ltimos a√±os datos de negocio No pues de la manera nueva conseguimos reducir los tiempos a unos 5 o 6 minutos C√≥mo sabes exactamente que est√° funcionando correctamente lo tuyo no lo sabes qu√© se nos ocurri√≥ ponerlo en producci√≥n en 5 o 6 horas 5 minutos m√°s alguien va a llamar para quejarse No nadie se va a llamar ejecutamos las dos opciones Por as√≠ decirlo dentro del que tarda 5 horas tambi√©n va a ejecutar el de los 5 minutos al final del todo compara los valores si los valores son exactamente iguales el test ha pasado si no si no lo si no son iguales nos avisa nos alerta nos va a enviar un un emil o un correo o nos va a enviar al chat de Google nosotros trabajamos con con con Google chat eh dici√©ndonos Oye esta empresa ta ta ta con estos datos todos los valores para que lo podamos Reproducir aqu√≠ echar un ojo y verlo cu√°nto tiempo lo tienes el tiempo que nosotros decidamos hasta que damos Est√° correcto por ejemplo se meses en producci√≥n en todos nuestros clientes nuestros as todo tal V Cu√°ntas opciones tenemos y cuando ya vemos que Estamos contentos y satisfechos es decir no ha habido errores durante todo este tiempo ya podemos decir lo hemos hecho muy bien vale continuamos Oye claro pod√©is imaginar con todo esto C√≥mo ha cambiado un poquito la idea de nuestros clientes no quiero decir el concepto de nuestros clientes imate el cliente 300 d√≠as que no me resuelves el problema y ahora que no me tienes ni siquiera que llamar que yo te aviso y que en menos de una semana tengo arreglado tu problema hombre pues esto cambia un poco la idea no e y esto que consigues pues consigues fidelizar clientes Eh Esto que nos interesa m√°s los clientes los que soy desarenadores Espero que tambi√©n os guste yo tengo mucho por los clientes que son puntillos son los que a m√≠ me gustan porque son los que te hacen ir mejorando no el cliente que dice todo me vale ese no me gusta Yo quiero el que sea puntilloso porque te va a hacer ir mejorando poco a poco en esto Qu√© cosas hemos conseguido pues por ejemplo en un caso pr√°ctico un cliente el cual se quejaba de que no pod√≠a funcionar la aplicaci√≥n con nosotros etc√©tera etc√©tera que ya dijimos nos parec√≠a raro que ten√≠a que reiniciar todas las ma√±anas a las 8 de la ma√±ana el servidor suyo no nuestro esto es importante porque si fuera nuestro nos hubi√©ramos enterado que la aplicaci√≥n no le funcionaba que le iba muy lento ten√≠a que reiniciar el servidor Pues un compa√±ero de producci√≥n entr√≥ en la m√°quina y dijo yo veo todo bien en la m√°quina evidentemente una foto instant√°nea no pero dijimos vamos a instalar un promos ah√≠ en un moment√≠n y vemos a ver qu√© ocurre pues al d√≠a siguiente ya salt√≥ la libre y vimos a las 8 de la tarde ellos lanzaban un proceso que consum√≠a la leche que atacaba la base de datos la dejaba frita le dijimos oiga que tiene usted aqu√≠ lanzando ay madre unas pruebas que hice tal Pues mira problema resuelto menos de un d√≠a cliente satisfecho cliente que dec√≠a es que yo esto no lo hubiera encontrado soluci√≥n en la vida much√≠simas gracias y en dos d√≠as incidencia resuelta entonces para que ve√°is el ejemplo de de cosas que podemos hacer e tiempos de respuesta los queer clientes opciones que pueden ser es mucho tiempo un listado de balance sumas y saldos eh que salta de en 5 minutos de 10 a√±os de una empresa que genera millones y millones y millones que con compras y ventas de mayorista al d√≠a pues quiz√°s no no los tiempos son relativos entonces tambi√©n podemos ver si ese tiempo que se est√° consumiendo es correcto o no y en funci√≥n de eso que nos avise si tenemos que actuar o no Si hay una opci√≥n que est√° consumiendo m√°s tiempo del que tendr√≠a que consumir eh No s√© si damos bien si no s√≠ e Vale ahora vamos a ir a las a lo que hemos aprendido de todo esto porque evidentemente como os hemos dicho eh nosotros Nacimos en 2018 con esto no hab√≠a Open telemetry que si est√°is pensando No s√© lo ten√©is eh ahora mismo actualizado etc√©tera etc√©tera os animamos a a hacerlo con op telemetry 2018 nosotros nos inventamos somos temas m√°s si no nos conoc√©is somos muy Juan Palomo yo me lo quiso yo me lo como hacemos nuestras propias librer√≠as casi siempre y hacemos nuestras historias porque nos es m√°s r√°pido hac hacerlo que eh meternos con con terceros eh Entonces vamos a ver cu√°les son las leciones que hemos aprendido eh nosotros nos hemos pegado mucho para llegar a lo que tenemos y conseguir lo que estamos contando la cara ve por detr√°s es muchas horas de sufrimiento y dolor eh previamente hubo tambi√©n dolor y por eso hemos aprendido vale pero la mejora continua es una de las m√°ximas que tenemos en la empresa entonces eh Cu√°les son lo lo m√°s importante para nosotros eh siempre decimos una frase que si todo es importante Nada es importante el tener todo lleno de trazas eh No aporta valor solamente ruido nosotros queremos poner puntos de control que es lo que hemos conseguido puntos de control en donde nos interesa en los sitios donde realmente nos interesa e se escapamos vamos pero de lleno de el panel esto que dec Oye tengo un panel que vale para todo noos tenemos paneles para cada cosa y para loe tiene que ser eh Y luego paneles no no creamos porque sobre todo al principio hablo en plural pero soy yo eh creaba paneles que digo qu√© bonito Qu√© chulo pero digo si no lo ve nadie Sabes y no puedo entrar yo a ver el panel no por muy bonito que te parezca un panel por muy chulo tiene que nacer de un objetivo y una finalidad detr√°s si no pierde toda la toda la gracia entonces e como comento eso paneles que sean muy efectivos como como consejo eh cara futuro eh Y los puntos que sean lo m√°s precisos posibles eh cu√°les son nuestros siguientes pasos Hacia d√≥nde vamos porque en plan Oye ya lo ten√©is conseguido tal no Nuestro objetivo es que no haya errores de hecho este viernes posiblemente cerremos como seis viernes seguidos sin ning√∫n error O sea que vamos bien como os pod√©is imaginar seis semanas seguidos sin ning√∫n error al nivel de desarrollo Comparado como est√°bamos hace a√±os 47 de de trabajo que se hac√≠a en desarrollo eran errores hay un cambio radical y una de las ventajas es precisamente detecci√≥n temprana de los errores y posible eh correcci√≥n y detecci√≥n de error los pasos m√°s importantes que tenemos cara a futuro es meternos con Open no me hubiera encantado llegar aqu√≠ dec tenemos pero no tenemos tiempo y esto estamos acostumbrados a nadar y salvar la ropa de acuerdo Entonces no lo tenemos cuando nosotros hicimos una librer√≠a que la verdad funciona bastante bien que no deja de ser para que nos enfrentamos todos no deja de ser escribir de manera as√≠ncrona un hilo unos blogs en un archivo este archivo es enviado Y nosotros a partir de ah√≠ bebemos las trazas los logs y montamos los paneles no tiene No tiene m√°s que escribir en un fichero para que nos entendamos todos y a partir de ah√≠ todo encaja e evidentemente usar loki mimir que est√° muy chulo eh mimir chul√≠simo e meternos en paner de ciberseguridad esto s√≠ que hemos empezado Ya esta semana ya hemos empezado con paneles de ciberseguridad eh eh asistiendo a todos nuestros tod nuestros Hosting en caso de cualquier vulnerabilidad en caso de que haya cualquier de que tambi√©n a nivel de organizaciones porque estamos convencidos buen la Inteligencia artificial la utilizamos todos tambi√©n los cib criminales eh el nivel de ciberataques que est√°n recibiendo las empresas es brutal y hay que trabajar para evitar que seas Eh Pues bueno pasto de de los ciberataques entonces una de las maneras que tenemos es a nivel organizacional Pues si alguien Desactiva una an virus alguien crea un usuario dentro de su ordenador eh si alguien est√° entrando se ha equivocado de poner contrase√±as que a nos avise etc√©tera etc√©tera todas estas cosas que est√°n bastante chulas Pues tambi√©n que nos avise todo grafana lo hemos centralizado a que grafana nos ayude con con con ello e Oye y esto Aunque dentro de la tisa est√© bastante implementado y t√∫ coges a cualquier persona de aa y le pregunt qu trabaj lo saben explicar o sea hemos hecho un trabajo Guay e pero eh Nos gustar√≠a que los todos los paneles o cada √°rea tiene algo que aportar porque la organizaci√≥n creemos que somos todos no entonces cada √°rea producci√≥n tiene valor que aportar eh producto tiene cosas que aportar eh atenci√≥n a usuario tiene cosas que aportar desarrollo tiene puntos de vista distintos y entre todos podemos dar m√°s valor para que nuestro producto llegue a mejor sitio y que nuestros clientes est√©n m√°s satisfechos con nosotros y ya por √∫ltimo lo que tambi√©n lo tenemos pero bueno panel de copias de seguridad de la base de datos de los clientes externos y se est√° haciendo las copias de seguridad porque luego es un jaleo que no el cliente pensaba que era el encargado de hacer las copia de seguridad y que no las ten√≠a hechas y es una fiesta si se le entra un virus como he dicho antes en el ordenador y ya por √∫ltimo creo vamos a concluir eh de lo que hemos estado viendo as√≠ en El Paso pero no ha vivido excesivamente r√°pido perdonadme los nervios e en resumen grafana para nosotros es una pieza fundamental ha sido una pieza fundamental para mejorar nuestra observabilidad entender nuestro producto entender a nuestro cliente no creemos que nuestro producto tiene sentido sin nuestros clientes esto es muy importante esto lo hemos dicho alguna vez que que la √©poca de que t√∫ le dec√≠as al cliente lo que √©l quer√≠a que datisa lo viv√≠a porque pensa que hace 44 a√±os el cliente no ten√≠a ni idea de lo que ocurr√≠a entonces t√∫ le dec√≠as no no t√∫ quieres estoo a d√≠a de hoy no pasa o sea sabe perfectamente qu√© es lo que quiere y c√≥mo lo quiere y sabe lo que es la competencia t√∫ no le puedes decir t√∫ quieres Esto entonces entender Qu√© es Qu√© quiere el cliente Por qu√© camino es por el que quiere ir y t√∫ le tienes que ir guiando no le tienes que ir imponiendo caminos e todo esto lo que nos va a hacer es mejorar la satisfacci√≥n del cliente Si mejoras la satisfacci√≥n del cliente vas a tener un cliente eh fidelizado Y un cliente que se va a mantener contigo y que te va a recomendar como no pasa y antes de pasar a la sesi√≥n de preguntas y respuestas no s si se me olvidado algo Quieres comentar algo he mentido algo que comentar o Alo se me buo simplemente reforzar esto que creemos que que la manera de de mejorar siempre es observar y en ese camino estamos creo que es muy importante en un mundo tan tan vers√°til como hay ahora con tantas plataformas con tantos actores en en los sistemas inform√°ticos que se integran que es muy complicado si no tienes bueno ex Vale pues pasamos a las preguntas y respuestas las f√°ciles para m√≠ las dif√≠ciles para m Gracias bueno lle tard mejor lo han dicho pero estamos cl o tenemos en nuestras Ah vale otro los conceptos de pye es no tenemos dinero entonces todo lo que nos podamos ahorrar pues lo siento tipo de cosas el punto es √∫nico lo que tenemos son paneles diferenciados para las √°reas paraciones que necesitas no lo mismo por ejemplo analizar las o no tiene la misma importancia analizar las m√°quinas que nosotros llevamos de de los Sas o de los Hosting vale Y tambi√©n los roles no no para m√≠ como desarrollador o o como t√©cnico no me interesa la m√°quina como tal como la gente de producto o la gente de direcci√≥n igual le interesa eh amos tambi√©n para la polar para analizar Cu√°les son las opciones que m√°s est√°n consumiendo y hemos lanzado una nueva opci√≥n la est√°n utilizando ve entr el producto est√° gustando es el tiempo medio ent ha cambiado respecto al mes pasado la observaci√≥n la observaci√≥n en el fondo cada uno si dais cuenta en la vida vais observando lo que os entonces una empresa hay muchas √°reas cada √°rea observa lo que a √© le interesa pasa que intentamos adaptar los paneles a esa Ob comercial por ejemplo le puede interesar panel que haba an Oscar Oye d√≥nde me est√°n comprando producto est√° en qu√© parte de Espa√±a lo mejor tengo que atar zonaa comercial y luego el panel por ejemplo la persona el equipo atenci√≥n usuario puede visualizar eso pensando en Oye qu√© incidencias tengo qui√©n es el que m√°s falla no qui√©n m√°s problemas tiene no entonces Claro daos cuenta que la observaci√≥n final como un 3 lo que hacemos intentamos hacer es adaptar los paneles a a esa ese punto de vista esa perspectiva y en de producci√≥n por ejemplo le interesa Oye estas que est√°n lanzando desde Turqu√≠a Rusia o china Qu√© hacen aqu√≠ sabes o sea cada uno con los mismos en lugar de un panel para todos es focalizado el panel a lo que a m√≠ me interesa lo que quiero observar en ese no s si te estoy respondido la pregunta alertas entonces las alertas est√°n confirmadas encima con la manera nueva est√° super chula Porque yo Es verdad que estamos utizando la antigua la 6 y con la nueva est√° super chuna las alertas van cada uno poniendo hay unas alertas grupales por ejemplo las alertas de m√°quina no Claro t√∫ te puedes alertar de las que t√∫ quieras por ejemplo nosotros tenemos una cosa que hemos llamado eh clientes con incidencias graves que son clientes que digamos que est√°n lo que ser√≠a s√≠mil con la ufi entonces esos clientes estamos observ√°ndolos en especial porque han tenido o alguna incidencia que es un poquito m√°s grave o hemos visto que la ley murfi le ha tocado dos incidencias eh que no les Tendr√≠a que haber tocado Y entonces est√° como un poquito m√°s caliente de lo que tendr√≠a que entonces cualquier error que le ocur en la aplicaci√≥n e cualquier error tal avisa ha en grupos donde hay las personas que le interesa esos errores que se han suscrito a esos tipos de alertas para tomar acci√≥n incluso nosotros como Bueno probadores hab hay errores que no salen losdos de B que no salen al al usuario final usuario puede estar dando errores en la base de datos y el usuario no se est√° enterando absolutamente de nada Yo me quiero enterar antes de que el usuario se entere es Nuestro objetivo para poder solventar el problema sin que el cliente lo sepa que ha habido ning√∫n problema no cuando son errores graves evidentemente deur nos pasa si nos pasara deur porque tiene sobre todo hay que tener mucho cuidadito con todo el tema del dinero imaginar que ah√≠ d viene tengo dos preguntas entiendo que hac√©is una correlaci√≥n laci√≥n la memoria una pregunta Gracias eh efectivamente nosotros recalco que tenemos eh una ilinca que es importante y lo podemos rear nosotros cu√°nto consume todo esto pues 300 es decir nosotros no podemos guardar muchas cosas de acuerdo un poquito a tu pregunta e utilizar m√©tricas eh trazas tal nosotros tenemos b√°sicamente bebemos todo el mismo archivo para que nos entendamos de acuerdo 2018 cuando lo montamos nuestras m√©tricas no m√©tricas de m√°quina m√©tricas de de nuestro producto est√°n impl√≠citas dentro de lo que es la traza lo que es la traza propia del c√≥digo pensar tambi√©n que tenemos una ventaja que a nosotros para este caso nos interesa somos monolitos Aunque tengamos librer√≠as internas y tal somos al final un monolito 44 a√±os vale tengamos servicios web tengamos e Entonces nosotros los spam no lo necesitamos como como tal Vale entonces Esta es una gran ventaja para nosotros Porque primero consumimos muy poco para tener much√≠sima informaci√≥n eh Y no rund informaci√≥n no est√° porque a veces te puede pasar que tengas las m√©tricas los logs las plazas sean pr√°cticamente iguales vale Entonces nosotros eh Para evitar eso cuando lo montamos en 2018 como lo pensamos fue Pr√°cticamente todo igual y nosotros sacamos las trazas de a partir de las trazas las m√©tricas y de ah√≠ tiramos todo y respecto a lo que estabas comentando e comentaba antes lo de que nosotros estamos depurando la aplicaci√≥n eh Tambi√©n desde hace ya bastante tiempo cuando nos interesa no la depur siempre es un poco como lo que t√∫ comentas no est√° hecho evidentemente no lo no lo ten√©is que hacer como lo hemos hecho nosotros esto es usar Open telemetry usar loki mimir etc√©tera etc√©tera nosotros lo hicimos 2018 no hab√≠a nada de esto no hab√≠a no estaba entonces lo que hab√≠a Era muy poco y no se encontraba ten√≠amos recursos limitados y dijimos tiramos por aqu√≠ tenemos este problema no me duele el zapato me cambio el zapato paraa futuro Loor efectivamente cu√°ndo me [M√∫sica] gustar√≠a una pregunta m√°s fuentes de datos a fuente de datos Han conectado aici aluna cosa m√° tambi√©n bueno amos bueno la de la sq llam tenemos varios por ah√≠ verdad lo coment una cosas que mua mucho rafana es que lo puedes conectar quieras mientras que transmita datos lo puedes conectar de una o de otra manera eso tambi√©n est√° super guay porque nos da una vilidad brutal luego el tema de las alertas puado a todo nuestro sistema de empresa a correos y pr√°cticamente hasta el m√≥vil si es el fin de semana y te llaman al m√≥vil de pues hacer esto es como todo a ver podemos dedicar un mont√≥n de tiempo a hacer paneles hiper mega chulos pero el panel no lo va a mirar nadie Realmente el panel o sea yo creo que te tiene que avisar mucho tiempo much pero que el panel en S√≠ este muestra informaci√≥n inmediata que yo quiero consumir en un momento a nosotros nos interesa mucho tambi√©n el alerting y el alerting creo que lo tenemos bastante chulo que nos avisa de cuando haya incidencias es lo que digo antes de que el cliente incluso sepa que ha habido una incidencia ya nos enteramos la idea chula Que en 2018 ni por cabeza hubiera pasado eso cont sachos tien alg√∫n set de reglas para saber d√≥nde poner cada a ver hay gu√≠as de estilo es un poco o sea tenemos en nuestro nuestra aplicaci√≥n tiene un controlador de b√°sicamente de pantallas y ah√≠ est√° traceado todas las pantall todo lo que t√∫ vayas haciendo con el programa Pues en plan pasando opciones consumiendo todo eso est√° ya integrado y todo eso ya est√° traceado perfectamente hay ocasiones donde en un c√≥digo que imag√≠nate nos volvemos al c√≥digo de hace 40 bueno no tiene 40 a√±os pero 30 y pico a√±os eh un c√≥digo super churo 6000 l√≠neas de una funci√≥n bien f√°cil tema m√°s maravilloso t√∫ Esa esa funci√≥n tarda mucho muy bien ahora d√≥nde tardas pues qu√© vas haciendo pues como bueno puedes t√∫ vas mordiendo El Chulet√≥n como t√∫ puedes vas dividiendo haciendo spam y vas viendo o divides por zonas y vas diciendo primera zona ha tardado tanto segunda zona tanto tercera zona tanta cuarta y vas como dividiendo y creando ls a tu pregunta eh No hay un un sitio Exacto donde t√∫ vas a poner los losos es en funci√≥n del programador que lo va a hacer cuando va a atacar eh al problema para intentar dar una soluci√≥n ya nos salimos directamente no al gra es Eh bueno hola Ah en zoom has estado atento ah√≠ eh Ahora s√≠ un Open source No pasa nada eh Bueno Hola eh Traigo una charla sobre las miserias de promicious O sea me gustar√≠a decir que son como cosas menos obvias y que cosas que alguien nos espera pero pero bueno yo me las he encontrado muchas veces por mi trabajo y me han As√≠ que las comparto con vosotros pues para que no os duelan tanto yo me llamo leg trabajo en grafana mimir soy ingenieros desarrollador grafana es una base de datos de series temporales y distribuida altamente disponible muchos m√°s keywords que est√° basado en promicious con lo que el c√≥digo de promicious De hecho est√° importado en en grafana mimir y por tanto yo tambi√©n contribuyo a promicious y bueno arreglo b y a√±ado alguna que otra peque√±a feature luego hablo con Jes√∫s para que me lo apruebe que es el maintainer y as√≠ Cerramos el c√≠rculo e grafana m so es Open source igual que grafana lo pod√©is correr y Ah y tambi√©n quer√≠a subrayar el hecho de que yo trabajo en grafana mimel con lo que grafana para m√≠ es un producto como para vosotros y de hecho seguramente sea m√°s novato us√°ndolo que mis compa√±eros de datisa Entonces qu√© es premici Cu√°ntos hab√©is usado premici de aqu√≠ Ay qu√© Guay maravillosa Vale pues podemos ir m√°s r√°pido aqu√≠ promos es una base de datos de series temporales recoge las m√©tricas de vuestros servicios es muy f√°cil de correr hac√©is un docker Run y ya est√° corriendo resuelve las los problemas de muchas empresas hasta un tama√±o mediano grande dir√≠a yo de hecho es un poco el dolor de grafana porque Bueno hasta que no duele promicious nadie se pasa m claro luego ya la migraci√≥n es otra cosa eh en esta presentaci√≥n voy a hablar de de promius que es una base de datos que tiene su ui para ver las las consultas las queries voy a usar span english voy a decir queries en vez de consultas y las slid las escrito en ingl√©s porque no quiero traducir los conceptos inform√°ticos que Vais a googlear Y es m√°s f√°cil para todos eh yo voy a usar capturas de grafana no de premici porque nunca uso promos uso grafana el Explore para para ver las m√©tricas tampoco uso dashboards no uso paneles y solo uso la Explore y s√© cu√°les son mis m√©tricas eh grafana Solo es una ui bueno es una ui con muchas m√°s cosas con aderin y muy muy potente para m√≠ es una ui que usa la Api de promicious y que tiene algunas funciones que promicious no tiene c√≥mo funciona pricio pricio recoge m√©tricas las recoge normalmente por xtp en plano va a Barra Matrix normalmente y y recibe una respuesta que es una m√©trica veis mi rat√≥n verdad por ah√≠ vale eh recibe m√©tricas tienen un nombre y unas etiquetas aqu√≠ la m√©trica my metrix tiene etiqueta Label a cuyo valor es un y Label B cuyo valor es 6 cuando la recoge las guarda en la base de datos con el timestamp de cuando se ha recogido la la m√©trica por poner un poco de contexto Eh Esto es una cuerie de promicious le he puesto color H inchis para que as√≠ sea m√°s chula Pero lo que quiero que tengamos claro es que lo de abajo es un Instant vector que que es recogerla unos datap points en un instante concreto de tiempo y lo de arriba es un Range vector que es recoger unos Data points en un Rango de 2 minutos de 2 minutos mirando hacia atr√°s desde el instante en el que se est√° evaluando la query y digo desde el instante bueno Rango son minutos digo desde el instante en el que se est√° evaluando la query es porque aparte Instant queries y y perd√≥n Instant vectors inst y Range vectors existen Instant queries y Range queries las dos cosas se parece mucho en el nombre pero son cosas completamente diferentes Yo no los hubiese llamado as√≠ entonces Instant queries una Instant query es una consulta que se ejecuta en un punto de tiempo el punto en grafana lo veis ah√≠ y habr√≠a que configurar grafana para que te haga solo la consulta instante y devuelve valor en este punto del tiempo por otro lado la Range queries la Range queries lo que hacen es ejecutar desde un punto del tiempo hasta otro punto de tiempo diferente con un paso de evaluaci√≥n establecido en grafana normalmente lo dejamos autom√°tico y Que decida por nosotros dependiendo de scrip interval y de Si queremos pintar un a√±o pues no queremos hacer un Step de 5 segundos y y lo que es una Range query no es m√°s que muchas Instant queries en muchos puntos y creo que este es el punto anes de la charla que yo venido a contaros porque no comparten absolutamente nada entre ellas O sea cada cada punto cada instante de una Range query es independiente del anterior de hecho cuando mimir se ejecuta mimir cachea los instantes por separado de da igual si si sobran o faltan instantes y luego recalcula los que faltan en en el tiempo y no deo porque es lo m√°s importante que vengo a contaros hoy y y el corolario de esto es la primera cosa que me top√© cuando Jes√∫s y yo entramos a trabajar en grafana y est√°bamos ah√≠ escribiendo unas queries es el topc que es un agregador no una funci√≥n que le pasas un Instant vector y te devuelve los tres Time series con sus valores m√°s altos bueno tres n voy a decir tres porque mi ejemplo van a ser tres Yo quiero tres pero me da 48 y es chocante para gente que viene de otras bases de datos por ejemplo en cabifi us√°bamos datadog en datadog t√∫ le ped√≠as tres y te daba tres y todo el mundo contento y por qu√© ocurre esto Pues porque yo lo que le he pedido es una Range query es un grafiques Instant queries y cada una de las Instant queries se va a evaluar independientemente de la anterior y a lo mejor en un instante las top 3 son ABC y en otro instante las top 3 son cde entonces por eso me va a pintar pues cada instante los los m√°ximos que son en este caso hay una l√≠nea continua que es el el m√°ximo com√∫n de todas las series pero luego abajo hay muchos puntitos que es c los m√°ximos de cada uno de las otras series las m√©tricas que he usado en la presentaci√≥n son me las O sea me las he sacado la manga he ido poniendo nombres los que lo que me ha salido Pues es lo que he usado Entonces c√≥mo c√≥mo arreglamos el topc porque el topc se puede arreglar realmente se le puede pedir lo que uno quiere primero que estar de acuerdo en lo que uno quiere para m√≠ por ejemplo el top Ke es las tres series cuyos m√°ximos valores de todo Rango que vamos a pintar son los los tres m√°ximos pod√©is interpretar otra cosa diferente a lo mejor alguien quiere los tres √∫ltimos valores los m√°ximos de los tres √∫ltimos valores y pintarlos a laro del tiempo c√≥mo lo podemos hacer eh la cueria se empieza a complicar entonces lo que tenemos que hacer es pedir la m√©trica la cruzamos con un an con el top Ke del Max overtime porque queremos el m√°ximo de todo de todo el l√≠nea temporal de nuestra m√©trica sobre todo Rango esto lo explico ahora y evaluada al final de la query creo que aqu√≠ es m√°s f√°cil de entender si lo si lo miramos desde el final hacia hacia fuera el Range es una variable m√°gica de grafana eh Por eso yo uso grafana por estas peque√±as tonter√≠as que te ayudan mucho cuando haces cueros a promicious en vez de promicious El Range lo que significa es el cu√°nto tiempo pasa desde el Drop down cuando has elegido que quiero mirar desde no s√© cu√°nto H no s√© cu√°ntos Pues los 15 minutos aqu√≠ en este caso es de menos cuar a en punto 15 minutos cuando grafana manda la cueria promicious manda 15 minutos y el lent lo que quiere decir es que este √∫ltimo selector esto es un Range vector y este Range vector siempre se va a evar en el final entonces para cada uno de los pasos Aunque evaluemos aqu√≠ aunque evaluemos aqu√≠ lo que va a hacer siempre es Mirar los 15 minutos mirando hacia atr√°s desde el final es decir b√°sicamente lo que lo que eval√∫a es cruzar la m√©trica en cada uno de los puntos con un dato que es independiente de de esos instantes de esta forma cuando seleccionamos el el top 3 de de las m√©tricas sobre todo Rango Ya solo nos va a devolver las las primeras tres eh he mencionado el atend hay tres diferentes offset modifiers est√° el Start el end y el offset eh C√≥mo pueden ser √∫tiles Start Por ejemplo si tenemos dos m√©tricas bueno muchas m√©tricas que tienen diferentes digamos diferentes magnitudes un servicio usa gigas de memoria y otro usa varios megas pero queremos ver si alguno tiene un Memory le Por ejemplo si pues es dif√≠cil porque claro el que tiene los gigas de memoria pues est√° comiendo toda la escala de la Gr√°fica podr√≠amos ponerlo en logar√≠tmica podr√≠amos pero en Explore no se puede poner las escalas logar√≠tmicas por desgracia y adem√°s Eh Pues perder√≠amos un poco de visibilidad de qu√© es lo que est√° pasando en realidad entonces a m√≠ lo que me gusta usar es el truco de restarle una m√©trica su valor at Start que quiere decir su valor al principio del Rango que est√°s pintando entonces en vez de ser valores absolutos se convierten en deltas de c√≥mo va creciendo cada valor a lo largo de de esa gr√°fica por ejemplo eh he usado esta Porque la que quer√≠a usar no la pod√≠a usar que es el coste de cu√°nto nos cuesta correr grafana Cloud pero en eso s√≠ que se ve muy bien cuando un servicio empieza a subir much√≠simo y ah√≠ es cuando dices Ah mira este es el caro ah√≠ hay que recortar offset Esta es otra que tambi√©n uso a diario Y supongo que la gente lo usa m√°s que Start atend que es para datos que tienen estacionalidad Pues tengo una m√©trica c log size no sabes lo que significa son 28 trillones de algo y no sabes si 28 trillones es mucho pero sabes que tu patr√≥n de tr√°fico es estacional entonces pues le restas el offset a un d√≠a Y dices Ah pues mira Son 35 billones menos que ayer de algo no s√© de qu√© pero si lo divides adem√°s entre el offset hace un d√≠a y lo multiplicas por 100 pues dices Ah pues es un 10% no es un es un 0,10 por menos que ayer pues maravilloso Entonces ya no me preocupa tanto porque es algo que no var√≠a de d√≠a a d√≠a o sea me me quedo tranquilo y eh para entender lo siguiente hay que entender los Data points eh cuando evaluamos una Range query en grafa por ejemplo pone Step auto no s√© c√≥mo lo hacen prici la verdad y el Step auto pues te pinta unos puntitos ah√≠ este Step que est√° aqu√≠ yo lo puedo modificar puedo poner que quiero el Step de 3 minutos y entonces me pinta una gr√°fica cada 3 minutos pero como pod√©is entender los puntos en stor son los mismos que antes con lo que ya te da un hint de que lo que pinta aqu√≠ no son los puntos que est√°n guardados en la base de datos y y esto es la otra cosa importante que quiero recalcar son las cosas que son importantes porque son las cosas que me viene a preguntar la gente en la empresa y me dice pero yo veo un punto aqu√≠ ya pero es que no no est√° all√≠ Este es el punto donde hemos pedido a promicious que eval√∫e la m√©trica no donde est√° el punto de hecho si nosotros le pedimos un min Step de un minuto 12 segundos y 97 milisegundos pues pues nos lo pinta pero uso tiene poco la verdad y hay un truco que en bicios no se puede hacer pero en grafana s√≠ que es hacer una Instant query y meterle un Range vector entonces lo que hace promicious es devolver para un instante determinado el un Range vector que al final es una matriz y grafana lo ve y dice pues me han dado una matriz pues la pinto y lo que pinta son los Data points que est√°n en el storage estos son los Data points de verdad los que est√°n los que est√°n en el storage y pod√©is ver por qu√© es √∫til porque pod√©is saber si falta alguno si aqu√≠ no ha recogido las m√©tricas promicious y entender muchos puntos cuando alguno hace un zo overtime por ejemplo pues si hay muchos puntos pues m√°s sale m√°s suma obviamente o a lo mejor hay el doble de puntos en alguna m√©trica de repente porque Alguien ha cambiado la configuraci√≥n de promicious Y recoge el doble de de r√°pido Eh bueno Esto lo mencion√© antes que aqu√≠ ser√≠an 15 minutos en este Rango porque es para lo que es √∫til el de hecho es que el dropdown de arriba normalmente no tiene sentido en Instant queries y Este es el √∫nico caso en el que tiene sentido el dropdown de arriba que tenga from y to para una Instant query porque se usa para Rango Entonces ahora que entendemos los Data points podemos hablar de lookback y de stess a Jes√∫s le encanta esto eh el lookback tengo una m√©trica esto es un pricio y yo le he pedido el app de un slack Ops estos me lo O sea la query me la pasaron el otro d√≠a pregunt√°ndome que si algo estaba roto yo le pido una Instant query pero me est√° diciendo que hay que vale Uno Vale uno Yo s√© que vale uno pero pero seguramente ahora mismo no haya un Data Point en ese storage o sea porque el datap estaba antes promos lo ha recogido la m√©trica en alg√∫n punto de de antes no exactamente ahora qu√© es lo que ocurre que hay una cosa que se llama lookback y lo que hace premici es cuando le pedimos un Instant vector siempre va a mirar 5 minutos hacia atr√°s hasta encontrar el √∫ltimo valor de esa Time series Y ese es el que va a pintar esto es otra m√©trica esta m√©trica no ha entrado por pricio entra por por un Remote ride de otra cosa que que hace mi amigo Mario que no s√© d√≥nde est√° por ah√≠ ah√≠ culpa tuya entonces pues decir bueno es una m√©trica que la he seleccionado y llega hasta las 1514 casi si yo le hago el truquito de Range y a la m√©trica la sumo uno para que suba en la Gr√°fica est√© a otra altura pues pod√©is ver que podes ver que me esperaba que los puntitos fuesen muy peque√±os a lo mejor no se ve muy bien as√≠ que aqu√≠ he usado un dashboard y he pintado los puntos muy grandes los puntos de de la del Instant vector que hemos calculado llegan hasta las 1714 aqu√≠ me ha cambiado la hora a a mi hora en vez de utc y los puntos de del otro solo llegan hasta las 1709 porque hasta las 1709 es hasta donde se ha empujado la m√©trica a premici Porque en cada uno de los evaluation stepes se ha aplicado un lookback y se ha mirado y se ha visto el √∫ltimo sample que hab√≠a en la m√©trica Esto es algo que ver√©is muchas veces si us√°is pricio se os cae un servicio y la l√≠nea sigue le dais a f5 la l√≠nea sigue y viende dices pero est√° vivo no est√° vivo no es que no hay samples te est√° mirando el lookback de los 5 minutos los re se convierten en cero porque claro no cambian de hecho en alg√∫n momento se van a a se desaparecen y y es un poco molesto de hecho a veces ver√©is que o sea esto es un problema Claro porque si un servicio se te reinicia arranca con otras labels y t√∫ tienes una suma de lo que sea que est√© haciendo pues te va a sumar el anterior valor con el con el actual que no Mola y c√≥mo lo hace promicious estas s√≠ son m√©tricas que que ha recogido promicious y las he pintado sin sin el offset de uno aqu√≠ porque as√≠ las vemos m√°s juntitas en la misma gr√°fica y veis que en los Instant values acaban en el mismo tiempo donde est√°n donde acaban los los los samples de verdad que est√°n guardados en la base de datos C√≥mo hace para no pintar m√°s sample pues promos tiene una cosa que es bueno recoge las m√©tricas de los targets y las va traqueando en memoria y cuando algo desaparece pone un timer y cuando ese timer se acaba dice vale eso se ha ido ya no va a haber m√°s m√©tricas no tiene sentido seguir alargando las l√≠neas y lo que hace es escribir ah√≠ una cosa que se llama St marker si St marker no lo veis pero est√° all√≠ escrito y esto es lo que hace que a veces deis f5 ese dashboard que ese servicio se ha muerto y se extiende se extiende y luego dais f5 m√°s se ha escrito este marker y la l√≠nea se han hecho m√°s cortas Pues esa es la raz√≥n de Por qu√© Por qu√© se han hecho m√°s cortas y Y eso es entonces estees smark lo que indica premici es que no hace falta mirar m√° hacia atr√°s porque no es que las samples todav√≠a no hayan llegado es que los samples Nunca van a llegar porque premici ya sabe que que ya no va a haber m√°s los teles markers afectan solo a los Instant vector porque son los que miran hacia atr√°s porque los porque el lookback solo se aplica a los Instant vectors que tiene que mir hacia atr√°s porque en un instante nunca hay sample los Range vector solo seleccionan el rango establecido t√∫ le dices 2 minutos y va a mirar 2 minutos eso pues tiene tambi√©n sus cosas c√≥mo Por cierto he encontrado la m√©trica que he buscado antes porque claro tenemos muchas m√©tricas yo mucho tiempo yo ten√≠a que encontrar un sitio donde una se acabase justo pues hice esta query esta query lo que hace es me encuentra todas las traces Target info a no ser que tambi√©n tengan samp los dos √∫ltimos minutos y esto selecciona Solo aquellas que que justo se han acabado y no tienen est marker entonces ahora que hablamos de rangos podemos hablar de rate y del scrape interval eh A veces quer√©is ver un rate un rate es como C√≥mo va cambiando una m√©trica ao de tiempo un Counter y y lo veis con un minuto de resoluci√≥n y est√° genial pero quer√©is m√°s resoluci√≥n dec√≠s vamos a verlo con 30 segundos de resoluci√≥n y empez√°is a ver cosas raras le pasan cosas a esta m√©trica dec√≠ Bueno si lo miro con 15 segundos con 15 segundos no hay datos tambi√©n la m√≠tica para que no pase esto lo suyo es poner una variable que hay en grafana que se llama Range rate interval creo que se llama que lo que hace es tener en cuenta el scp interval lo que ocurre es que los 15 segundos son scp interval rate necesita dos samples en el rango si seleccionamos en ese Rango solo un sample Pues no hay r porque dentro de un r no hay cambio y y por eso es por lo que por lo que a veces hacemos zoom en una gr√°fica y de repente desaparece en grafana se puede configurar Cu√°nto es tu scp Inter de promi para que grafana nunca haga el interval lo suficientemente peque√±o y nunca desaparezcan los datos la regla es usar cuatro veces el scp interval para los rangos que se pasen al rate y el increase Yo pensaba que era dos pero hoy me han ense√±ado que era cuatro eh Ya que hablamos de raate a veces tienes un contador y ese contador es pues n√∫mero de request una 2s 3 cu 7 enteros si miras su rate y te da Pues 86666 por por segundo la verdad es que a lo mejor no te dice mucho dices Bueno voy a mirar el increas y as√≠ s√© cu√°ntas ric se han hecho porque el increas no s√© si sab√©is el increas y el rate es lo mismo Solo que el increas dividido por Rango es es el rate Pues si miras el incris pues te dice ha subido 89,33 yo dudo que ha recibido com33 rqu en ese minuto la verdad es poco cre√≠ble entonces Esta es otra cosa m√°s que hay much√≠simos clientes que vienen quej√°ndose y dicen que devolvemos el dato mal puede ser eso el dato efectivamente bien no est√° lo que hace promic es una cosa que se llama re ex operation que es si t√∫ tienes un minuto y tu primer sample es a los cco segundos y el √∫ltimo samper es a los 55 Pues el el rate no lo mira del 5 al 55 lo que hace es la extrapolaci√≥n de para saber cu√°nto valdr√≠a el sampel a los c segundos y Cu√°nto val√≠a a los 60 hace una extrapolaci√≥n ah√≠ y en este caso pues sal√≠an como 33 esto es bastante molesto la verdad muchas veces cuando quieres saber un n√∫mero exacto de algo que ha pasado no hay soluci√≥n que yo sepa y Ah tambi√©n est√° el eate el eate si lo busc√°is en Google es un rit mejor hay un blogpost que dice que es un rit mejor tambi√©n hay gente que dice que no us√©is ir raid o sea es como dos dos familias de gente Eh yo no uso irid y raid lo que hace es Mirar los dos √∫ltimos sampers de Rango est√° muy bien para saber si el dato est√° cambiando muy r√°pido pero si vuestro pricio se ha escapado dos veces muy r√°pido y ha recogido el mismo valor pues vuestro raate es cero o sea vuestro raate es cero pero a lo mejor est√°is mirando un d√≠a de de re no es cero con lo que yo no lo usar√≠a pod√©is decidir vosotros si lo busc√°is en Google Pues hay opciones y casi el √∫ltimo topic es la labels bueno el metric name solo es una deel especial se llama und und name y pod√©is seleccionarla pod√©is hacer count by name pod√©is ponerle expresiones regulares lo que quer√°is a veces es √ötil no muchas pero a veces s√≠ y claro es es Es una lbel como otra cualquiera Solo que no es como otra cualquiera Porque si yo hago esta query por ejemplo y digo quiero sumar por name todas las m√©tricas que empieza por go de un cont en promicious el rate de ello me da este error este error me encanta porque no ten√©is que googlear es un error que es imposible resolver si no si no sab√©is lo que pasa y te quedas as√≠ como igual te quedas Y si haces el zoom y solamente lo multiplicas por uno que ya ves t√∫ que parce m√°s inocente multiplicar por uno pero ocurre lo mismo Entonces esto ocurre porque hay c√≥digo espec√≠fico para quitar el metric name cuando se aplica una funci√≥n que no sea Last overtime porque claro una excepci√≥n es mucho m√°s mucho m√°s divertido todo si la funci√≥n no es Last overtime o o si se aplica una binary operation o sea multiplicar por uno o no s√© cu√°ntos a no s√© cu√°ntos el metric name desaparece de de Label set y cuando desaparece el metric name lo que ocurre es que el resto de las Label set se parecen mucho o sea se coinciden en labels por eso dice que que el vector no puede contener los metric con el mismo Label set Tampoco s√© qu le costar√≠a sumarlos si solo quiero sumarlos pero el caso es que no funciona y y tambi√©n es un un caso especial el Max without si veis aqu√≠ digo Max without cluster Job instance names space de esta m√©trica el resultado no me da el metric name eh Eso es porque el without y el on tambi√©n asumen que el metric name hay que quitarlo siempre o sea no hay forma de hacer un without sin sin el without del matric name si estas cosas no os han pasado nunca me alegro por vosotros y ya voy a acabar Solo tengo un punto m√°s que es el punto de de las expresiones regulares acordaos de que el punto no machea las los New Lines los saltos de carro entonces cuando vosotros hac√©is una petici√≥n de punto asterisco para vosotros es cualquier cosa pero para premici es escanear todas las labels una por una todos sus caracteres y verificar que ninguno sea un es mucho m√°s caro Eso que que no poner la por ejemplo pod√©is poner esto que es el modificador de que acepte los New Lines en la expresi√≥n Regular o puis ignorarlo y ya est√° lo mejor de todo es que grafana cuando t√∫ le pones la versi√≥n all s√≠ que manda el punto m√°s sin el modificador con lo que bueno nos disparamos nuestro propio p y ya est√° Muchas gracias gracias por venir Gracias por la charla de la tia y celonis por este magn√≠fico sitio hay preguntas Cu√©ntame Mario se ignora dec√≠as ench no O sea el Step solo aplica la Range queries como yo estoy haciendo Instant query no hay Step es esta O sea la cuer es Instant con lo que no no hay Step S√≠ alra con el primero estando di av√≠same a los 5 minutos de que esto falle a te est√° avisando a los 10 minutos reales de que falles si no lo pones bien o sea en algunas condiciones podr√≠a ocurrir eso Si t√∫ normalmente no te va a avisar porque el balor no cambia con lo que peor no va a ser pero pero si tu alerta es como una diferencia de algo algo que es igual que hace 5 minutos Entonces s√≠ tu alerta va a saltar Porque ahora mismo es el mismo valor que hace 5 minutos o sea en ciertas condiciones en las que esto te podr√≠a afectar una alerta normalmente las alertas miran el unos raid o alguna funci√≥n que agrega un Rango y el lookback no afecta a los Range queries los Range vectors ah√≠ Ah√≠ te salvas pasa que hay cosas cosas que mejor la s√≠ que hay cosas ha yo cuando yo cuando abro grafana Yo veo que hay botones ah√≠ el qu builder que no uso y hay un bot√≥n que que creo que vale para cosas no lo s√© es que no no soy un experto en grafana la verdad hay este este de aqu√≠ Este lo que est√° diciendo es que estoy haciendo un de algo que no acaba en total vosotros ver√©is es complicado avisar sobre porque se supone que es una funci√≥n v√°lida Y alg√∫n uso tendr√° Yo no digo que no hay gente hay gente que dice que es un r mejor la gente que yo sigo dice otras cosas algo m√°s muy bien Hay comida [M√∫sica] zo d√≥nde

