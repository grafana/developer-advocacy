# Grafana Tempo Community Call 2024-06-20

Join our next Tempo community call: ...

Published on 2024-06-20T18:44:29Z

URL: https://www.youtube.com/watch?v=mH0YqCfQfX0

Transcript: ah okay now it's recording I'm not sure what it was maybe we just need somebody to leave maybe maybe rejoin I don't know okay cool uh well hello everyone and this is the June 2024 Tempo Community call uh we postponed it from last week uh the team was out out of the office for kind of like a shared shared offsite so now we're doing it this week and let's see I'll go ahead and share my screen there we go cool um yeah I mean we have some stuff to talk about I think it's a little bit quieter this month so the big news is that 2.5 is released so that's pretty cool and I think you know we're kind of have some stuff in the pipe so I think uh it's a little bit quiet this month while we're working on the next release and the next round of features but yeah we'll go ahead and cover cover what we have there uh 2.5 uh here's a link to the blog post oh okay cool um big stuff in here so I guess the biggest one would be the new block format so VP park4 has a new new block format new columns that will let us search uh kind of like the additional parts of the trade that we haven't been able to yet so that is including events links event attributes um those are been on the list for a long time uh but it took a took some time to get the the column layout right the performance where where was acceptable and then you know adding that support to the language and stuff yeah Mario go ahead yeah also erase uh in case anyone uh uses them for I don't know HTTP haers maybe yeah oh yeah yeah yeah that's a good one so um what it means is if like the audit instrumentation for HP request headers some it puts the values in an array even if you only have one and I'm not sure if it's linked in here uh but the way it works is if you just write the query as if you wanted to match on it it will work so the existing language um for that will work maybe what we could do is get like a little snippet in here like of what that would look like for the request header um and it will search any value in the array for you now we have more features coming up uh that we want to do in the language to get like more precise interaction with arrays and things like that U but for now like that handling I think it solves most of the use case so um you want to search your request headers or other things like that yeah the other thing is so more streaming end points um this is really cool streaming search is really really awesome so what it means is um instead of waiting for the whole search to complete maybe it could take a few minutes something like that we search streaming results to the browser right away um this is just kind of a rewrite of a lot of things on the query on the read path so we hope to do streaming for everything else now metrics queries uh autocomplete lookups um things like that yeah yeah I okay so this is cool so I did wanted to talk about this here too but um just a lot of like new really cool metrics functions um so this one is quantile so you write this Computing the P99 P90 p50 of I don't know not that one duration this is a good one yeah so Computing like the P99 of duration um so this is cool because this is right on your tracing data it doesn't require any other dependencies it doesn't require um a metrics back end um so previously if you wanted to do this you had to do through the metric metrics generator you had to pre-configure your cardinality with your labels uh but now you can just query this straight on your data and this is funny this is just kind of talking about how it works for any numerical attributes so even status code so if you ever wondered what your P99 HTTP status code was you can do that now which is super amazing of course yeah yeah it it makes for a great April fools blog post how we build an SLO that cool yeah yep okay so that's 2.5 and yeah I'd like to get a snippet in here to talk about like what searching on request heads would look like that would be cool um the next thing to talk about TR K metrics um so I guess Ruben maybe had to drop but previously we were talking about um redoing the way that works so the approach that we tried like earlier this year was to duplicate everything on the read path and to um yeah that's a good one we can call that out yeah you're talking about in 2.5 Kim yeah sure yeah we'll jump back to that uh maybe Zach is the best one to talk about that Z yeah Co sure yeah I can I can add some context in the doc um so basically we changed the ownership of the um the process that runs Tempo inside the default Docker container and so any files on disk will need to be updated um so there are some kubernetes tricks you could do for this if you're not in kubernetes um you know probably just a Chone of the data makes some sense um in it container would work in a kubernetes environment too where we just Chone um on Startup that would need to be done once and then that way all of the files on dis continue to be owned by the user 10,001 so this follows the same uid pattern that uh that Loki's had for years we're just a little bit late to the game and um feel free to jump into slack or file issues if you run into anything there was an ongoing thread I think we missed the tempo um chart not the tempo distributed chart but the tempo chart itself uh did not have the security context and so um some users bump into some problems but they there are solutions posted on the um the GitHub issue um I think that's all there is to say about that yeah by all means ask questions if if you run into issues though we want make sure you're working cool thanks Z and thanks Kim for calling that one out uh yeah Tre scale metrics so what we a tried approach to D duplicate on the read path so if you have replication factor three for like a production cluster it means we write the data three times um it proved just really difficult to do that efficiently to dup on the read path so what we're what we've done in this release um and and also the next one is we're switching the read path over for metrics queries um to an alternate one but what it means is generators are a big component of that so you have to be um like enable of the local blocks processing um and there's some other settings that go along with that and um maybe we can get a link in here to what the settings are we can come back and put that link in but basically Bally you have to enable local blocks which sends a copy of traffic over to the generators and then you have to update the query front end to query the generators um and it also queries an alternate set of all the blocks so we'll write like a d duplicated copy of the data which makes reads way more efficient makes metrics ques a lot more performant um so this is the path we're going now but it also lends itself into in the future if we for instance take on to Kafka dependency it would also be an alternate way of getting to that D duplicated data um but either way this is definitely the way forward um and I guess you know I was kind of hoping like um if we could hear from people any people using metrics queries on larger clusters um you know it would be fun to work through this and show you what we're doing and how you could do that in your cluster yeah okay cool yeah the other thing yeah so that's enough about that one the other thing is the new functions I actually was just coupling together a dashboard here that I thought was cool looking um and I wanted to show off the histogram functions with another thing um because I think these are really important for dashboarding things that's something Tempo has been missing is cool charts so now that we have metric queries it's uh time to start using them so things like that yeah so this is just quantile over time this is the P99 P90 and p50 duration so you know you can have a chart like this is common that we do it's in the dashboards that are in the Json it um it's common for us to kind of print these three metrics you know for the read path things like that well now we can do that with a trace cual query and yeah it's pretty standard so duration and the other thing to noce you can actually plot multiple uh quantiles like in one query so that's really cool too um but the other one that I wanted to show is the other function this one this is cool histogram over time it's kind of like what's internally driving the quantiles but it's also exposed and you can use this to create heat Maps so it's as easy as calling this function changing the panel type to heat map right um yeah and this is cool so I think this is like pretty pretty fun and I would wonder you know like to see this in more dashboards too I think this could be cool um I don't know about this color scheme I think normally I see something maybe not that one but you know some other ones yeah they look cool yeah so yeah so those are fun and I think the other functions pre-exist but you know in 2.5 everything got a little bit more perform so that's cool oh yeah cool so we do have we have a document here cool all righty uh anything else Mario do you anything else you wanted to talk about for metrics or anything at 2.5 that maybe we want to highlight before we move on to the upcoming stuff um no I think you've covered almost all of it uh yeah I was hoping someone would ask about Aran or Kafka or yeah was cous on on that front uh but yeah if you're I think if you're running um trade school metrics in a large cluster uh this is something you'll be interested in um the documentation might not be the best that's somewhat delivered uh cuz it's also serving I would say as a um validation for for this new approach of duping on the right path instead of the the read path um but yeah I think doation will get better and if you have any question just go so like go ask us in the community slack or um the temporary for somewh where we can be found cool uh okay upcoming features so this is cool we have a couple of PRS here that I want to show um being able to search on events and links um so now these are added to the language the blog format is there in 25 and now in the main branch and these were just out of the 2.5 cuto off so but now they're they're there so if you want to experiment with those on the latest builds and they will be in the new one or in the next release and the other one looks like this yep so these are cool so this is great to see the new format uh kind of like powering these language features um in a performant way and I think after even more that's those are the intrinsics but you would also have event attributes so that would be something like event dot attribute this value something like that yep that's cool Yep this one is very exciting so oh yeah cool so we have a PR here um I will let whoever wants to take this one go forth um yeah so we're adding support for generating native histograms from the metric generator um so so far we we generate like the the the classic histograms in which you have to Define your buckets in advance um but prmia developed a new type of histograms which uses spars buckets which will adapt based upon the data it is you know observing so it's means it has a higher resolution and it's also more efficient because um it kind of adapts the buckets based on the data it drops like zero buckets in between so it's just like more efficient overall um so we want to also generate this generator so we have this nicer higher resolution histograms um unfortunately this means we have to change like a large part of how we generate histograms because the implementation is a lot more complicated so we're moving to using more of the pricious library to generate histograms um which is what we're like trying out right now um it will be an optional toggle to switch between generating the normal histograms the native histograms or both of them at the same time so you can kind of pick um the isue with the reason we're doing this with a toggle is because the native histograms are queried differently so it is a breaking change you cannot use the existing queries on Native histograms you have to change them so this SW break uh dashboards um and other existing queries we have um but like by the time we releases we also like try to provide as much guidance as possible um but yeah like I think it's going well and looks really cool because you have like very detailed um histograms that way cool yeah that's awesome um I mean the increased resolution for for that like just what we touched on I mean that's what they're for like they're it's great yeah really excited yeah and uh once we do this it opens up the possibility for kind of like addressing um you know kind of like using it for metric queries as well so we're using histograms behind the scenes for these kinds of things and the accuracy is just you know it could definitely be improved because native histograms is like the best way to improve that um so even like this this uh heat map here right that you can see the buckets here maybe uh they're just generalized they're not tailored to your data so that's what we need the native histogram for yeah that's cool um yeah we were like trying to um focus on getting this PR merged which will have like a feuture toggle and then we'll improve stuff like memory usage and make it more production already so you might be able to try it soonish cool yeah do you think that this would become the default behavior in a future release um we'll kind of have to see the issue is it it breaks the existing histograms right so we can just enable it across the board um but I would recommend it for like new installations for sure um I think we still have to like figure out how much it breaks and like how difficult it is to migrate but like mimir like the mimir team has also been pushing native histograms because it's you know just like better so I think we can also piggy bag on a lot of material they have cool yeah uh cool any other uh upcoming features that we wanted to call out I think these are like the main ones cool uh yeah so we had slotted here time for Q&A um so yeah I think because we shifted the calendar around attendance is kind of light so we might just actually wrap up here did you post it in the communi link I did oh yeah okay yeah well yeah I was glad to see my ability to Ping at here still work Zach knows what I'm talking about yeah you have that channel add Channel yeah maybe maybe that would be good yeah you're right Jenny the calendar not getting moved might have impacted that too surprise Community call [Music] yeah I had to go calendar Snoop to find the information so if if I if I had trouble I'm sure there were a lot of people that just slipped their minds they thought it was last week that's why you publish it on YouTube yep that's right all right unless uh viewer one has questions ready viewer one cool uh all right yeah I think this is good think we can wrap it up all right sounds good okay good okay see y by take bye bye

