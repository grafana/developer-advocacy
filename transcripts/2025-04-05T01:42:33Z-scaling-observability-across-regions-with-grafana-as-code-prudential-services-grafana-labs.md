# Scaling Observability Across Regions with &quot;Grafana as Code&quot; | Prudential Services | Grafana Labs

Learn how Prudential Services Singapore (PSS) uses Grafana Cloud and "Grafana as Code" to streamline operations, boost ...

Published on 2025-04-05T01:42:33Z

URL: https://www.youtube.com/watch?v=-cBwBzNNv5E

Transcript: few words about myself right so um my name is Ronald i've been with Credential Services Singapore as Mikuel just explained uh for about four and a half years i recently got a new title that's why I'm I'm I'm I'm very happy to say I'm the head of something right that's um I run a small team called cloud reliability within credential okay uh we are part of a cloud uh infrastructure engineering function and what we do is we we basically enable the organization to consume cloud resources public cloud resources in a repeatable reliable compliant safe and secure way and um everything is done in code right uh from uh so we are part of global technology and we basically support a lot of countries in between Taiwan and Nigeria and if you were to look at the map really it's most of the countries that are somewhere somewhere in between uh I again I try to enable the business to use uh cloud based infrastructure uh in as much of a self-service way as possible right uh we don't want to be in that situation where somebody gets a company credit card and creates their own Azure or AWS account and then starts spinning up virtual machines and somehow I don't know saves uh root passwords on their on their laptops we'd rather have to we rather follow and enforce uh a bunch of compliance and security policies and make sure that everything is in line with what our regulators and our uh legislators are requiring from us we are financial services after all and uh yeah we have to we just have to take care of this uh what I'm going to talk about here a little bit is there we go the basically the classic problem right the reason why we ended up using Grafana is is is very very simple right we have far too many uh opinions about how to do monitoring how to do observability far too many solutions far too many tools in uh in the place and before the meeting earlier today I was talking to Anthony about this outside and he was basically echoing that same sentiment right rather than trying to make all of these go away you just embrace that and we found that um within our team within the organization as a whole Graphana is basically a known quantity um we know that uh we can probably rely on this we know that we can probably use that to somehow tame that beast a little bit right uh I tried to keep the slide as simple as possible right but just just to give you an idea right today we are using uh two different public cloud providers we still have some infrastructure that sits around in various uh small data centers uh that are somehow in country uh we are using a vast uh stack of technologies regardless of how opinionated we are and how much we're trying to uh advocate and educate our customer base our client base internally to adopt let's say nice cloudnative type of approaches we're struggling with this of course right um you can imagine that there's still a lot of legacy tools around this all all the usual things that you might have heard of in the past like your BMC true sites and I I I I don't want to go into this um but the point is right all of these are basically data syncs that we can hook into that we can somehow um that we can somehow um tap into and try to make use out of this so again Gravana really here came to the rescue right because we looked at my team in particular our team in particular we're of course we're huge fans of open source we're huge fans of uh open standards and open technologies and all of the service that we provide is basically built on open source technology so it's very very natural for us to look in that space as well right um we go out and there's the usual suspects you have your kafana stack with your Prometheus Loki and all of this kind of stuff then maybe we have something like an influx DB and then the other usual suspect here is an elastic search and and kibana stack of some description so I've got some varying uh degrees of experience with this as well as many of my peers and many of my uh co-workers and collaborators and um we decided ultimately to go with Grafana um the idea here is really simple right um we think of everything as an experiment so when we doubled down on Grafana we said if it doesn't work in in 3 months and 6 months then we throw it out and we start over we try to apply this quote unquote agile or startup type mentality to that enterprise business that we're part of right so like I said a lot of a lot of the guys in our team already know Graphana or or or knew it or have had some hands-on experience with this before so very very small learning curve this is brilliant we have a a huge active community a lot of the service that we bring and a lot of the service a lot of the engineering that we do traditionally used to be that we would redesign or quote unquote reinvent the wheel couple of small wheels not not the whole wheel as a whole but a couple of small wheels and we very very quickly recognized that uh out in the open source community there are uh we do a lot of a lot with Terraform there's a lot of billion Terraform modules out there that we can just reuse where we just maybe have to bring a small wrapper around this and then that Terraform module will already uh or the developers the many many developers of this will have have thought of many many eventualities that you know might uh come up with this with this particular module it's the same for for this stuff right uh the graphana open source ecosystem is huge there are so many integrations available there are so many dashboards that I can immediately import i'm going to find uh if not an outright solution I'm definitely going to find a lot of inspiration out there uh we don't have to ingest any data actively right uh we are big fans of having cloudnative tools in place so our Asia monitors your GCP stack drivers your big queries all of those kind of places and we're a big fan of having this there because it allows us to use this data uh transparently over there if that means I write an alert rule in Azure uh I don't have to somehow fetch this data every 5 minutes i can I can do this natively in Azure and it allows us to scale uh look we started out with uh Grafana open source i've been banging on about open source right for the last five minutes or so we started out with a very very small open source instance running this as part of a small Helm chart on top of a Kubernetes cluster and it was working fine it was honestly it was it was okay it was an interesting learning experience to figure out how to run uh this uh HA mode and do all these kind of things but we uh we needed to put this onto a bit more solid feed right uh from from our team's perspective uh what we were doing uh was catching on right we were using this to basically uh try to advocate for a bit of a different way of thinking and um as part of this whole application process uh also a larger project within the organization came up which wanted to double down on graphana um when we were evaluating that use case and those requirements and were just kind of looking back and reflecting on the last 18 or so months uh that we've been running this ourselves we realized that you know there's a a number of shortcomings and there were a number of uh certain areas where we had to kind of work around a a problem or come up with some sort of a workaround and we really got to the limits of what uh what the open source instance for us can do right um when I say we spend more time managing graphana and less time creating and sharing dashboards that's basically me i spent far too much time at some point operating our open source instances we were running multiple because we were trying to implement some sort of development to production uh promotion process where uh I've got some guys sitting somewhere in a lab building out some new dashboards building out some new use cases and then we were trying to shift them somehow into production then we had separate production instance uh for a specific use case where we're again trying to advocate for uh a particular way of of obs of observability and I ended up spending far more time uh with this stuff and you know every now and then somebody would come up to me and would say hey can we do this can we do that and I would realize yes in theory we can but that requires us to make some sort of change that's down here that nobody will ever see that I will not get any any credit for but that will just cost me time and it may cost me two hours or it may cost me two days it's just it was it was getting a little bit difficult um native Terraform we're huge fans of Terraform right we I shouldn't say we're huge fans we we recognize that Terraform itself has a lot of uh uh limitations as well but uh we are using it very very heavily we have developed some some patterns within the organization that have helped us uh very well and we can apply those same patterns to Grafana to the Grafana cloud uh based service right there's a native Terraform provider you can uh interact with this thing you can build up your own stacks can manage resources in there it's fantastic and yeah so we can now actually focus on uh using this thing rather than having to manage it and rather than having to to orchestrate it right we we like to refer to them as general uh as actionable insights right rather than showing somebody that their CPU utilization is 95% well what am I going to do with this if I can show them hey 30% of those requests going to this particular API gateway are failing that's something that uh you know they they find some inspiration in this they find some motivation in this to actually do something with this so it's hard to go into some actual I guess nitty-gritty juicy kind of details here but um what we're doing um and how we're and how we're actually using this is like we uh we took inspiration from the whole agile model right divide and conquer if I if somebody were to ask me today hey can you write me some sort of a Terraform blueprint or manifest or something like that that builds a a graphana stack on on top of the cloud and then does arbback and creates some folders and manages I don't know data sources and plugins and all of this kind of stuff and if I were to try to squeeze this all into a single blueprint it's not going to work right uh we're going to have uh some layers of dependencies that we may or may not be able to work around but far more importantly right we're going to make it very very difficult for ourselves we're going to again find that we're cutting corners so everything is is just layered up uh we use um today we use GitHub we used to use uh Bitbucket and Jenkins and were to uh use these basically as our execution as our execution the other day we use GitHub it doesn't really matter so much um but what's what's far more important here is that as part of our traditional infrastructure self-service offering we also do a lot of secrets management right you can imagine that with thousands of VMs and hundreds of clusters and managed databases and all of this kind of stuff there's a lot of credentials that are constantly being created and maybe passwords or keys that have to be constantly rotated and rather than having any of these secrets stored on someone's laptop or VDI all of this is tightly integrated with some sort of secrets management uh in the back end and we just make use of this here as well right um so today uh I'm in the position where I can offer graphana as a service for an application team within credential and these would be the five steps that I'm going that I'm going through right i would first build out or would first well I would write some small TF vars file that helps me to produce a new graphana stack on graphana cloud uh and in this I will specify what plugins I want to install with the exact version maybe they want to use dino trace maybe they want to use some bigquery or some Google some other Google service or something like that it's a fairly simple it's a fairly simple it's maybe five or six lines of code that's that's really all all that uh that it takes uh once this is provisioned then I can go uh well I I provision this i create a service account inside of this graphana instance and I immediately take those credentials for the service account and I stash them back into my secrets management engine uh then I can run my second layer and in the second layer maybe I'm configuring those data sources maybe I have I don't know three different GCP organizations or projects that I have to connect to so I create three instances of this data source and for each of them I fetch a different set of service uh account credentials i then tie this all into our SSO mechanism just so that end users can just you know open their browser and then authenticate with their with their regular day-to-day uh AD accounts then we apply some arbback uh controls of course we have a team that uh builds and manages some dashboards and then we have maybe myself who uh sometimes has to go in and and do some some I don't know some break glass type of stuff and then we have our end users uh like I mentioned earlier there was a a rather large uh project and I can share a little bit about this project right they are running a uh a network operations center style um environment where they have a wall of screens basically in a in a room and a lot of those screens are showing graphana dashboards today so for that we are of course we're using uh their regular unprivileged accounts to access this kind of stuff uh and and again this is all this is all managed uh inherently uh today we do not manage dashboards in code uh to be honest I tried this in the past with uh the open source instance and I was asking uh Jim about this after his last session here a few minutes ago uh because he he briefly touched on this right um the the actual problem that I had uh I believe I I mentioned this very very early uh we were running multiple uh self-hosted open source instances of graphana and the idea was that I have a sandbox environment where I give my dashboard developers uh wide ranging access they can basically do whatever they want they can basically go completely nuts and they can uh build a new nice uh shiny dashboard for me and then we tried to establish some uh promotion process to move this dashboard from this non-prod environment from the sandbox environment into some production environment and if you know anything about this you know that you will have to somehow sanitize this old dashboard you will have to uh in essence do search and replace on uh data source ids and if as we do it uh we uh work with anywhere between I want to say maybe 12 different data sources today across all the different technologies right again it it's it gets uh it gets very difficult to manage and then naively hey we're using terraform terapform has a templating engine it built in we can kind of do this but again I I'm coming back to this point where I'm operating graphana more or operating some aspect of graphfana more rather than actually focusing on building the dashboard this graphana itself has a built-in mechanism to sort of do that to uh uh simplify this process a little bit and we for the moment we're doing this manually But anyway uh everything ideally is infrastructure as code at this point I treat Graphana as my cloud platform and uh a folder an arbback role assignment or something like that in this graphana I treat this infrastructure in exactly the same way as uh we do this elsewhere right so the journey so far right uh like I just mentioned we have a crap ton of data sources and a crap ton of data in there we're across two clouds we are using Prometheus we are building I I've wrote I've written some custom integrations uh I can share for instance we are we're using some uh VPN concentrators from a popular networking uh vendor and um we were asked to uh monitor VPN end user capacity so again there's as you can imagine there's some licenses involved here i buy for site A I buy 250 licenses and I want to see on an everyday basis how many of those 250 licenses am I using that thing does SNMP but for a number of reasons SNMP didn't quite work out so again uh I'm we're in an open source world they have a regular REST API that I can plug into I can evaluate the output and I can maybe just stash this in Prometheus so we do a lot of that uh we plug into some of our enterprise legacy tools right we we plug into Salesforce uh today and that's part of this um command center initiative uh we are again from from what I touch and what I work with most we are dealing with infrastructure uh telemetry data infrastructure logs and and traces but uh there's a huge demand of course for dino trait for application performance management within the organization And we are bringing again some opinions here and some suggestions on how we can do this and we are standardizing the integration with Grafana already uh similar to what I just explained with where I read some sort of capacity data out of some VPN concentrator we're doing the same thing with Influx DB right uh infrastructure self-service by definition means that we have hundreds thousands of cloud resources that are somehow that are not directly under our management but from where we gather event data that's constantly happening right people are constantly managing their own stacks they're constantly making changes to this they're maybe they're adding firewall rules maybe they're removing VMs maybe they're scaling up or scaling down some stuff we have we have a ton of event data that we capture with influx uh we recently migrated from Bitbucket to GitHub again uh open source the world it's already there somebody has already done that integration for us somebody has already given us some inspiration of what we can do with this so we integrate with this uh it's a bit hard to see but we do uh custom JSON data sources right uh so we use this infinity um this infinity data source which is really really good um we have a I like to call it a meta uh meta data service that we run uh that we that we uh operate ourselves and this data service is in is there to help us tag let's say a virtual machine to a specific business unit and stuff like that and we can query this one directly so actionable insights right uh and this is again I'm while I'm a big believer of dashboards I feel like uh showing a lot of dashboards to you guys here they're going to be completely out of context it's very very difficult to actually bring the meaning of this um but this is an example of one of those actionable insight dashboards that we created right rather than rather than um well typically the idea here would be to say okay I don't want to highlight all of the all of the positives i actually want to focus in on the negatives right i want to identify all of those things where maybe where there's room for improvement maybe where there's something going wrong but if I were to build a dashboard that only shows where things are going wrong only shows where things are red I'm going to struggle portraying a message because I'm going to have numbers that are well I'm going to have numbers like this i have maybe a three or a two and it's going to be a little bit out of context so when we say actionable insights what we try to bring is we try to bring uh large overviews right where we run some sort of automated process and where we can uh very very easily demonstrate that the vast majority of this is working and we have a few small ones that we have to that we have to dive into a little bit uh deeper again I mean this is a token rotation dashboard what I was uh referring to earlier also um the amount of resources the amount of again the amount of credentials that are going through that are flowing through some aspects of some layer of our system is far greater than anyone could manage uh personally individually there are thousands of these and we are we need to rotate their their credentials on a regular basis so this is something that we're very very closely attached to but of course there's a lot of other stuff in here where where maybe our clients are doing something that we can just simply observe with this right so to try to bring this to some sort of conclusion right where we started out uh we had again I I cannot count how many because everybody there's different things to different people but I cannot we had we had very very varying uh sources for observability observability and monitoring data and we've tried to do a lot of things with them uh we again we've always been a strong believer to leave the to leave the uh source data where it is because it brings certain advantages whether they're financial or whether they're operational there are certain advantages there's certain uh benefits from again leaving a login in an Asia log analytics workspace but we also wanted to have the ability to just sort of combine these things right i want to be able to show something from GCP and something from Azure or something from a database or something on on the same screen and this is what this allows us to do right we can we can scale this across multiple technology stacks we can scale this across multiple business units it doesn't matter what we want to scale this across but we can simply scale yeah i mean this is this is okay fine this is what I wanted to have what I wanted to share with you guys today uh I hope it wasn't uh too high level i hope you got something out of this uh I believe we do have a few minutes if you have any questions wait we have a a mic here so uh you have a two public clouds and some workload on a data center also right yes yes so that uh all you are managing on a one dashboard or it's like uh no oh no okay i mean if this wasn't clear we have multiple different dashboards right and maybe I should have touched on this okay we use we use um Graphfana for multiple different personas right uh we are targeting some senior management who wants to have some sort of highlevel strategic overview but we're also of course uh thinking about our developers our our our technical our engineering user user base and the nice thing about this is right uh depending on on my desire of how much I want how much data I want to expose I can share with them that uh maybe we have a separate dashboard that dives in a little bit deeper i can instruct them on how to uh inspect the actual data that sits behind a query that sits behind a a pie chart i have a simple pie chart somewhere i can show them how they can see that raw data from behind how they can maybe dive a little bit deeper and go back to the source system if that is somehow already publicly available within the organization so we have today probably something to the tune of 50 different dashboards and there's anything from ad hoc troubleshooting maybe some sort of a major incident for which we want to build some sort of small custom uh visualization or some sort of small custom dashboard to longunning um initiatives where we're observing some trends that go over the space of uh of a month or a year or things like that any and and any anything in between yeah i mean do you guys use this fara for event I mean incident management also or just for dashboard and alerting uh we do uh and once again I mean we what we've been doing for a long long time right is we've been managing excuse me we've been managing alerts alert policies across the multiple clouds or across the multiple source systems right so you know you can create an alert policy in Azure you can create some sort of alert policy in GCP you can I mentioned this earlier BMC truite is basically the legacy monitoring tool that does exactly that and we plug this into graphana right we are using this to again try to derive some more knowledge some more insights from from these alerts and a simple a simple thing here would be uh can we can we somehow visualize uh which technology stacks or which business units or which maybe which subsets of of some of our stack are generating the most traffic generating the most noise in terms of uh in terms of incidents uh the is that the the sort of area that you're you're asking about that you're interested in yeah I mean like u because we understand graphana also do incident management so I was just trying to understand if you guys use that or I mean I understood like it's more about analytics so you guys use graphana right yes today it's primarily an analytics tool and a visualization tool uh of course uh we have dabbled with some of the alert manager in there as well but other than that um you're absolutely right we uh we we don't do that much more just yet we have many many ideas and many many opinions about this right thank you so much uh so so what I understood is like mostly you are doing the cloud infrastructure monitoring using graphana so what would you say that the key differentiator using graphana then the standard you know cloud infrastructure monitoring capabilities like most the GCP as its own and then Azure has their own tools and now we have some PHOPS tools which work across you know the cloud providers mhm okay uh for for that to uh to explain maybe you would uh I I would have to uh take half a step back and say um like I mentioned in the introduction right we're we're present in many many countries represent in many many different business units and the way the uh this manifests within uh the multiple different cloud service providers is with many many different cloud accounts with many many different cloud subscriptions and uh the vast majority of this cloud native monitoring stuff or observability stuff is scoped to those cloud accounts we have a we have we literally have a requirement to be able to uh demonstrate uh this cross regionally across multiple regions across multiple countries and and business units and things like that so this is one big uh aspect the second one is this right if you look at your uh actual cloud resources today it doesn't actually matter if you're if you're interested in running Kubernetes as an end user as a client does it matter to you if that Kubernetes cluster runs in GCP whether that's a GKE whether that's an EKS and AWS whether that's an AKS and Azure it doesn't actually matter right at the end of the day we're just using cloud as an abstraction layer ultimately what we want to do is we want to run some sort of an application that brings some value to someone right whether it brings value to us or some client it doesn't matter but ultimately we're using cloud infrastructure just as an abstraction layer and once we're past this abstraction layer we can try to at least aspire to to unify again to a certain degree it of course it depends largely uh to what type of data you have available to play with to visualize but it's getting better and again through the many many efforts open telemetry was discussed earlier right through those standardization efforts these things are getting more and more plausible today thank

