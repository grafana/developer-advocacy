# New TraceQL features in Grafana Tempo 2.5 | Grafana

In this video, you'll see a deep dive demo into the experimental TraceQL features in Grafana Tempo 2.5. Blog post: ...

Published on 2024-08-30T16:59:51Z

URL: https://www.youtube.com/watch?v=c4gW9fwkLhc

Transcript: hey everyone Tempo 2.5 has just been released with a set of new Trace ql features which we are excited to talk about today let's dig in first we're going to start with the empty query just selects everything and the last few months in tql I've really been focused on some metrics additions uh if you recall we've added uh the rate so I can do rates of spans now this is rating all my spans as always I can add some fil here like name equals Let's test one of these let's for authenticate perhaps and I can see how many times per second this particular span this rate function so that was in Tempo 2.4 in 2.5 we've added two new metrics functions which we're going to talk about today the first is the much requested uh histogram actually let's go with quantiles over time quantile over time duration we're going to name field so I'm going to name one of the fields in the span this can be anything I want in this case I'm going to say duration and we'll pick a few quantiles so I'm going to say some pretty common ones here P99 P90 and p50 and we can clearly see uh down here that um we're looking at the quantiles at these various points for this particular span name authenticate so I have p50 down here P90 looks to be about 160 milliseconds or so and the uh P99 is about 300 or so milliseconds 250 to 300 so uh quantel over time are going to let us have a nice way to aggregate our uh duration or our um or our any kind of numeric attribute on the span if I look kind of closely here I can probably find one let's have some fun with status code for instance so uh name list articles what might make sense what would definitely make sense if I ask for quantiles of the duration like most people want we're interested in how long some of these uh activities are taking but let me just have some fun and do spam hp. status code uh the quantile overtime function can take any field from our span including the duration and we can do some fun things with it like this and we can get the P99 and the p50 and the P90 of our status code which makes no sense but it's kind of fun to calculate I suppose uh in addition to quantel uh we have added histograms histograms are or quantel are actually kind of based on the histograms I'm going to switch over to this uh dashboard here because the histograms the heat maps are not supported and explore so here I have a name a span name list articles and I've just asked for histogram over time of the duration so with the quantiles we specify the quantiles we're interested in because we're doing that math to go from a histogram to quantiles but if all you're interested in is the histogram itself you want to see this raw data the heat map is kind of cool to look at we can see that with the histogram overtime function so two new uh two new additions to the language uh for the trace spal metric histogram over time and quantile over time a new change in Trace ql also is we're moving away from these intrinsic names that we've been using so far so you all are used to things like Trace duration for instance to ask a select for traces that are over a certain uh duration over a certain time period in this case 1 second and we have a lot of these we call these intrinsics like kind equals server we have um duration this is spam eration we have uh all kinds of stuff right status equals okay error any kind of all these different things that we call intrinsics of the span uh we're moving away from these uh uh plain intrinsic names and we're adding a scope to all of them so we're not going to remove the old ones uh but we're going to start adding a scope to all added intrinsics so now instead of just status you're going to type span colon status and instead of kind we have span colon kind and the old ones AR going away and then we have no uh no reason to get rid of them just yet my bad span kind equals let's do client PRS uh the old ones are going away but we now have uh the ability to have these scoped intrinsics which I think is going to work a lot better for instance before we are Trace typing Trace duration uh which might be a bit unwieldy and now we have Trace colon duration which kind of is nicely symmetrical with span colon duration depending on what you're interested in we have two new Trace ql intrinsics one is Trace ID which you can see here as well as span ID so these are going to allow us in the trace qo language directly to query for uh Trace IDs which can we can use to do some really neat things especially with metrics for instance um it is not uncommon for Tempo or Loki to create tens of thousands or hundreds of thousands of span traces I love this new Trace ID uh in uh intrinsic because I can ask cool questions like how many spans per second does one Trace create I could also ask a question like how many times does my uh does this particular Trace hit cash how fast does it hit cash or now that we have the new the new functions in place I could say uh how slow is the cache for this one Trace so when uh Tempo does their its read calls over large amounts of data it often creates 100,000 plus span traces and this can be very difficult to uh to look at and understand and get information out of with a single trace view now that we've added Trace ID to the language directly where you can select a trace ID I think we're going to see some really neat applications especially over metrics where I can find out how fast a specific request is doing a a one of its doing one of its operations or how long a specific operation is taking for a given Trace some people don't have this problem your traces are maybe more normal in the tens of spans to hundreds of spans but I think for those of us with extremely large traces this new Trace ID intrinsic is going to be fantastic so there you go we have uh we have the new functions for metrics histogram over time and quantile over time we have this transition from uh the uh old style intrinsics to the new style intrinsics where we're going to start using colon we're going to start scoping all of our intrinsics Trace colon duration span colon ID span colon kind uh and then the final thing is the two new intrinsics that we've added Trace ID and span IDs to do some some neat and Niche things I think with Trace SQL for uh for power users for people who are looking to do some maybe some things that I want to do perhaps but anyways take care uh enjoy the new features of trace ql and we'll see you in 2.6

