# メトリクス、ログ、トレース、プロファイルから迅速にインサイトを得るためのベストプラクティス

Published on 2025-10-24T17:13:00Z

## Description

Grafana Mimir、Grafana Loki、Grafana Tempo、Grafana Pyroscopeといった高性能なオープンソーステレメトリバックエンドを ...

URL: https://www.youtube.com/watch?v=D9MH7hpmMKM

## Summary

このYouTube動画は、エンジンダイレクターが日本の東京で行ったプレゼンテーションの内容を紹介しています。彼はオーストラリア出身で、日本に11回目の訪問をしており、東京やピザについての個人的な体験を交えながら、専門家に頼るアプローチと自己解決型アプローチの違いを説明しています。主に、メトリクスのドリルダウンやログドリルダウン、トレースドリルダウンの技術を用いて、システムの問題を迅速に特定し、解決する方法について解説しました。また、プロファイリングの重要性やその利点についても触れ、パフォーマンスの向上やコスト削減の事例を紹介しています。

## Chapters

00:00:00 Introductions and welcome to Tokyo  
00:02:30 Speaker's personal experiences in Japan  
00:04:15 Questioning the audience about their locations  
00:05:45 Discussing favorite foods in Tokyo, specifically pizza  
00:08:00 Exploring options for finding the best pizza in Tokyo  
00:10:30 Introduction to metrics drill down for faster insights  
00:12:45 Demonstration of metrics drill down features  
00:15:00 Explanation of log drill down functionalities  
00:18:30 Introduction to trace drill down for identifying issues  
00:21:00 Overview of profiling and its benefits in performance optimization  

# トランスクリプトの整理

こんにちは、皆さん。今日は、エンジンダイレクターとして、リログ・トレースプロファイルからより早くインサイトを得る方法について説明したいと思います。これは、先ほどお話しした内容とも関連しています。

私の名前は、オーストラリアから来たもので、東京にようこそ。皆さんを歓迎するのは少し変な気もしますが、今日は幾つかのテーマについてお話ししたいと思います。私は日本が大好きで、1995年に初めて日本に来て以来、今回で11回目の訪問です。

## 参加者への質問

ここで、皆さんにいくつか質問をしたいと思います。東京に住んでいる方はどれくらいいますか？（観客の反応）横浜に住んでいる方は？（観客の反応）少ないですね。私は最近、横浜に12月から2月までの5週間ほど滞在していました。その間に、娘と一緒に新宿のライブハウスでピアノを弾くこともできました。素晴らしい体験でした。

日本国外から来ている方はいらっしゃいますか？（観客の反応）ありがとうございます。こういった質問をした理由は、今東京にいる皆さんが、世界でも素晴らしい年を迎えているからです。

## 東京での体験

東京の観光地には行きたい場所がたくさんあると思いますが、私が大好きな食べ物はピザです。東京では比較的簡単にピザを楽しむことができますが、東京で一番美味しいピザのお店はどこか、皆さんも検索してみてください。

ピザを探すには、主に2つのアプローチがあります。一つは、専門家に聞くことです。東京のことをよく知っている人が、どこに美味しいピザがあるか教えてくれるかもしれません。もう一つは、自分でいろいろなオプションから選ぶことです。

### 専門家への依頼 vs 自分で探す

オプションAは専門家を探すこと、オプションBは自分で選択して最終的に自分のピザ店を見つけることです。先ほども話したように、これらの二つのアプローチには違いがあります。

私たちの目指すところは、皆さんの体験を変え、オブザーバビリティのやり取りを改善することです。専門家に適切な質問をすることで、すぐに回答にたどり着くことができます。一方で、オプションBでは、Googleマップなどの検索ツールを使って情報を探すことができます。

## メトリックスのドリルダウン

さて、次にメトリックスのドリルダウンについてお話しします。例えば、ブラックフライデーの後に顧客数がピークになることを確認したい場合、システムがうまくいっているかどうかを確認する必要があります。朝2時に問題が発生した場合、電話が相次いでかかってきます。

このような場合、メトリックスに入って、ログQLを使って必要なマトリックスを探し、レスポンスタイムが遅い原因を特定することが求められます。これを自動的に行う方法として、メトリックスのドリルダウンがあります。

## ログドリルダウン

次に、ログドリルダウンについてお話しします。ログを見ながら、さらに具体的な状況を把握するために、ログQLを使います。サービスが遅れている場合、手動でデータを確認するには時間がかかるため、エクスプローラーでロギングのボリュームを確認することが重要です。

急上昇を示すパターンを見つけた場合、その内容を深掘りしていきます。興味深いエラーログを見つけることで、問題の本質を理解することができます。

## プロファイリング

最後に、プロファイリングについてお話しします。プロファイリングは、リソースのホットスポットを理解し、最適化を可能にする手法です。これにより、コストを削減できる可能性があります。具体的には、プロファイリングを通じてパフォーマンスを向上させ、コストを削減することができます。

### 結論

本日は、ドリルダウン、ログ、トレース、プロファイリングについて説明させていただきました。これらの手法を使うことで、効果的に問題を解決し、迅速にインサイトを得ることができるようになります。どうもありがとうございました。

## Raw YouTube Transcript

パのエンジンダイレクターでもそれは 先ほどもあの申し上げましたでリログ トレイスプロファイルからより早くイン サイト選ことができるかということについ て説明したいと思いますもこれは先ほど見 た通りですま東京にようこそま私は オーストラリア人でま皆さん京にその歓迎 するのはあの変な気もしますけれどもこの 後いくつかのテーマえこれちょっと理に 基づいたお話をしたいので私は東京日本 大好きですで海外からのスピーカーが日本 に来るとま本当にあなたの国大好きだった みんな言ってますけども私はまあの1番 その大好きなその国であって日本は 1995年に始めてに日本に来てま今回が 11回目私本当に日本が大好きですえ皆 さんにいくつか質問したいと思います皆 さん に東京に住んでる人は何人ぐらいい ますまそこそこいらっしゃいますね横浜の 方横浜に住んでる 方12 少ないで横浜にの12月から2月まで5 週間ぐらいいたんですねあの数週間まで 戻ってきたばっかりなんですけども私の娘 も緒に来てそして あの新宿のライブハウスでピアノを引く こともできましたあの素晴らしい体験でし た本当に楽しみえましたで日本国外の方 グラフラブ以外の方日本国外から来てる方 何いますあありがとうございます海外から 来てくれてでこういった質問した理由なん ですけれども今東京にいてま世界でも本当 に素晴らしい年の1つなんですけどもこの がありますよねでこれいくつかの ランドマークが示されておりますま観光地 に行きたいという方ま結構行きたいところ とか色々とあると思います私ピザ大好きな んですよねま東京では比較的簡単にピザは 食べやすいんですけど もま東京で1番美味しいピザはどこで 食べれるかっていうことを検索してみ ましょうまいろんなオプションがあると 思いますが基本として2つのアプローチが あると思いますこのような問題がある時ま 専門家に聞くまこの東京のことよく知っ てる人は1番美味しいピザのお店はどこで あるかと教えてくれるかもしれません私の 同僚がまこのようなスライドをあまとめて くれたんですけどもま実際にその東京の ピザの専門家みたいな人がい てただまちょっとスライドいくつか外す 必要がありまし たまあのオプションAというのが専門家を 探すということでオプションBとしまして は ま自分でそのいろんなそのオプションから え選択をしてま要件に満たすものを見つけ 最終的に自分のピザ店っというものがえ 見つけることができるとで先ほどシフトに ついて話しましたけどもこの2つの オプションについてはその違いがあります ファラにおいては皆さんの体験を変えたい えオブザーバビリティのやり取りを改善さ せたいということをやっておりますでその 左右とオプションが示されてるます円は そのえ車内の専門家もしくは専門家に市場 を仰ぐでコエリーベースのシステム言語を 使う適切な質問をすることができればすぐ にその回答にたどり着くことができますで ま正確でもう専門家だったらこれがいいか もしれないオープBはえピザを Googleマッスなどで探すっていう ことま専門家である必要もありませんその 検索ツールを使ってそして情報必要な情報 を探すっていうものでありますまこれが そのドリルダウンの 使うことができるん ですまデータとからえブラウゼしてま1番 いいピザ店を探すもしくはオブザベてィの データを探すことができるませも知識は なくできるというとこ ですでそのまトンさんも言及してくれたん ですけどもその今そのえクエリー不要の ドリラスイートっていうものが導入されて おり ます でそのま最のその改善のあの仕方を説明し たいとログQLとかを使わなくてもできる ようにでま先ほどと同じように前のビデオ なども紹介しつつ説明していければという 風に思っておりますで まずえメトリックスのドリルダウンから 始めたいと思い ますのからなんですがでこのメトリクス ドリルダウンえそれからロングドリル ダウンも見ていきますけどもま今日も何回 か出てきましたけどもほぼまブラック フライデーになった後まみんな準備してる とシステムがまその顧客数のピークに頼 できることを確認したいもごうまくいっ てるで朝2時にまじさんに問題が起こった とま電話がどんどん来てる とでウェページの方がタイムアウトしてる とパニックしてるとまあままこの解決法と しましたはメトリックスの中に入ってま 色々 とプQL書いてまログQを書いて必要な マトリックスを探すでリスポンスタイムが 遅いなのでここかもしれないいや違うえ そしてCPUを見てみるで様々な リクエストメトリックスを試してみる見て みるでそこでも解決できないで最終的には はまCPUかもしんないともし高したら これかもやそうじゃないかもとでかなり タイプしなければいけないどっから スタートするのか知る必要があるとまその ポロqmを学ぶためにはかなり能力も必要 であるとこともありますそれではなくて このメトリックスのドリルランスフィトて いうものがあります自動的にえプロミスの データソースからえそのクエリを書くこと なく全てのマトリクスを可視化することが できるっていうものであります各をえその ディグインしてそより早く確認することが できる ファースト インサイス実際にのまたベッドに戻ること ができる時間を短縮できるというもので ありますま簡単なそのビデオをまずお見せ したいと思いますで米国のそのキャスリン がこのマトリックスのを説明しますで マトリックのその機能についてですけ もでここでそのメトリックブラウスが示さ れておりますでそのうちに入って マトリックスのデスクリプションタイプを 確認できますまたサーチしてマトリックス をフィルターすることができますまその クーティ2の方から入ってるものもしくは コンテナから入ってるものまそういった ところでフィルターをかけることができ ますしまたマトリックスを検索することも できますこの場合は分かってるのは顧客は リスポンスタイムが遅くなってるという ことで metxで検索してでこの12か時間で何 が起こってるってことが分かってるので フィルターをかけますでスパイクがこの マトリックスの方で出てることが分かるの でその内部を内容を確認してみます そしてでこのブレイクダウンタブを使って そのラベルを確認するまこの辺りのエンド ポイントからこのラベルをその選んでもう 少し深掘りして みるそしてまどこでこの急上昇があったの かをま確認をし ますそうしますとこのフィルターでヘルス エンドポイントで他のメトリックスで同じ ような急上昇があるところがな確認をし ますそうしますとこちらこの辺一部の メトリックスで急上昇が見られ ますですから も選んでもう少し調査を進めてみ ます他にも この内容を共有したりと他の方に問題が あった場合に 例えばこちらにブックマークを設定をし このビューをブックマークした後で見 られるようにしますそしてこちらの内容を 同量に共有しますこのURLをコピーし ます あるいはこのエプロを確認すにあたっ てクエリーを使ってもっと複雑にすること もできますつまりダッシュボートに追加 するということもできますエスプラ メトリックスに戻ってあと履歴も見ること ができ ますえステップ感を生きすることができ ます例えばフィルターアプライのステップ に戻ったりあるいは他のマトリックスを見 たステップに戻ることもでき ますキャサリンさんありがとうございます 次ですけれどもログドリルダウンです同じ ような状況においてマトリックスを見てい てまログも見ていてえさらにより具体化し ます状況 をロQLを使っ てサービスが遅れていたりする状況におい てえデータをまその手作業を入れたりする にあたっては時間が十分な時間はないわけ です そういった状況においてエクスプロスを見 ていきたいと思いますこのページには サービスの一覧が示されていますこの グラフがログのボリュームそしてログ ラインがサービスごとに示されてい ますえこちら中を見てみ見ていきますいく つ かこちらのインジェシャタでですねその パターンが示されていますのでこのログの ボリュームを見ていきますでログのリスト も記載されてるので まずはパターンに着目します興味深いえ ログラインのパターンについ てどこに急上昇が見られているのか見て もう少しそこを深掘りして見ていき ますこのようなパターンがありまして興味 深いえその急上昇がログボリュームの中に 見られますなのでこれをフィルターに追加 しますここでラベル2も行きましてここ でかどっかのインスタントでこのログが 増えボリュームが増えている理由に関連し ているインスタンスがないか確認をします そしてフィールドに入ってフィールドが これはキーvaluペアですログラインに 関連したでここにを見ますとテナント フィールドにで何か起こってるとことが 分かりますこのテナントIDに様々なえ タイプのその急昇が見られますのでこの 1218テナントIDをこちらに入力し ます でそしてフィルターにかけてログ ボリュームとログを確認をするといくつか のエラーログが今表示されています最初の このパターンに基づいてこういったエラー ログが出てきますのでこのログボリューム をもう少し細かく見て問題の本質を理解 することに務めますさらにテーブルの表の 形で確認することもできます があります非常に有なテーブルですあと マネージコラムもありますのでこちら フィールドをクリックをしてこれ をコラムとして追加することができ ます同様にエクスプロアで開くこともでき てこれをダッシュボードに追加することも できますしこのクエリーをもう少し動かす こともでき ます雑な仕組みになっています色々ラベル もありますしログラインのパターンも色々 ありますしクエリーの中になのでま私とし て は何を探せばいいのか事前に分かってい なければまそのえこういった作業は難しい もの ですまこのロンチの一環としてマトリクス ログ ドリラ テメーだったりこういったものもサポート できるように取り組んでいますいろんな 機能がありますけれどもえその比較のため のえそのマトリックスログだったりを用意 しようとしていますマトリクスドリル ダウンログドリルダウンを使うことで最初 のインサイトを得るための時間を短縮でき ますしそして診断のための時間を短縮し 時間とコストをえその節約しベッドに戻る 時間を早めてくれますそしてでログドリル ダウンメトリクスドリルダウンは両方え そのクラウドでえオンプレミスでも クラウドでも使え ますでは状況が理解できましたら次は トレースのドリルダウンということでどこ で問題が生じてるのかを確認しますこちら のスクリーンショットがトレースドリル ダウンの表示になりますが先ほどのえので もえ素晴らしいデモがありましたけれど も少しじゃコンピューターに移ってどの ような形でえこちら使っていただけるのか をお見せしたいと思いますがまず最初に ドキュメンテーションチームの観点からえ 我々の素晴らしいまドキュメントチームが まとめているこういうプレゼンテーション も紹介したいと思いますまですがま グラファナの環境だとドックスのドックの ページに行ってスクロールダウンいただき ましたらグラファなプレイにアクセス いただけまし てトレースえドリルダンを活用して いただきまして合成データを活用して システムの機能だたりに馴染んでいただき ますえエラーだったりえそういった時間的 な情報だったり様々な側面を 確認することでまどのような仕組みになっ てるのか見て取って いただけることができると思っていますま 今日は時間がないので細かくお見せする ことはできませんのでけれどもなので今日 はスライドに戻り ますま様々なドリルダウンのた マトリックスだたりの説明をしました次 プロファイルの説明をしたいと思います プロファイル が問題がなぜ生じたのかその解決方法 明らかにするえ最後のえポイントになり ますプロファイリングですけれど もえれは極コンテキストえ動的な コンテキストを両方に得ることですけれど も当てはまることですけれどもリソースの ホットポットをラインレベルで把握し最適 化が可能でありますしまたライセンシーが インシデントに対応する サのサポートも提供でき ます最初にホットスポットをその緩和をし ておくということもできます歴史的には そういったところはフォーカスではあり ませんでしたけれども最近では最適間の 一環としまして重要度が高まっています インフラが大きくなってくるとえそのそう いったことをすることでセービングを 大きくえ釣ることができます10%だっ たりといった最初の数週間10%ぐらい コストを作することもでき ますプロファのフレームグラフまこれに ついてはもう言及しましたけれどもまここ の幅が使われてるリソースの量であって 有数のノードも別できますし色は パッケージごとにまグループ化されており ますこれはセンタ我々のユーザーの方の クートなんですがから引用しているんです けどでプロファイリングを続く使う前にま センサタワーのパフォーマンスを測定 するっていうのはまま科学でも明確で なかったとただそのグラファロクラウド プロファイルを使うことによってえコード をしっかりと理解することができ プロダクションのパフォーマンスを高める ことができたとで実際にそのベイの コンピュートのビルは20%削減すること ができたという ことまプロファイリングとトレシーの インテグレーションすることによってその 何十万ドルもコスを削減することできたと ででプロファイリングについてのその対応 的なその対応ですけどまこれは信問題への 対応ま実際にそのえま売上源を直接そのえ 換算できるものであります素トのものでも ありますでまだプレビューの段階ですので レモは流さないんですけども他のドリルラ のアプリケーションと似たようなフロに なっており ますこれはあじゃえシファの方ですけれど も彼のえコメントを告に載せまし たであのファロスコートを使ってまその CPUま20%コ発見することをできたと でエンジニアもま あのまま本当にこれがすごく便性の高い ツルであったということを言っており ますで私がまそのカバーしたかった内容は 以上となり ますまshopifyのパフォーマンスは えその早いその信頼性の高い エクスペリエンスというのが重要っていう ことでそのプロファイルに対するまあの フォーカスが重要であったということで ありますで私はちょっと早めに終えること ができましたまドリルのえログトレース プロファイルについて説明させていただき ました

