# Grafana Plugin Development for Beginners | GrafanaCON 2024 | Grafana

Grafana is an open and extendable platform where it is possible to add support for virtually any service. Plugins enable ...

Published on 2024-04-25T23:59:50Z

URL: https://www.youtube.com/watch?v=zUubNiZ9au8

Transcript: hello folks thank you for joining us on this session of plug-in development so I'm David I'm joined by Marcus together we work on Graf's plugins platform and the catalog of available plugins So today we're going to cover three main areas firstly we'll give you a general overview to plugins what they are why you might want to create one then we'll actually show you how to do it so it's kind of like a teaser to this Workshop that I've now been signed up for Without Really volunteering it um it's just a single command we'll take you through creating a new data source and then as this is going to be a fairly fast-paced talk the intent here is that we'll provide you links and pointers on where to go next so that it kind of serves to jump start your plug-in development Journey uh you can also find us that ask the experts or in our community slack Forum so if you have questions come find us hopefully you've seen some of the new exciting features like the app platform that are coming for this talk we're very much grounding it in what is available today and the current experience so very much Basics what is a plugin a plugin is a way that you extend grafana or that's built-in capabilities and how exactly well this is where we get into what we're calling plugin types and there are three types of plugins there's data sources there's panels and there's apps if we ground it when what people are hopefully familiar with already so even if you not developed a plugin hopefully you know what a dashboard looks like so dashboards are made up of a series of panels when you edit a panel you kind of see something like this for a dashboard first we need data to display so down at the bottom left for folks that can see that uh we have the query for a given data source good one uh once we have that data we need a way to display it uh so that users quickly understand what is going on and they can take actions based on those insights and we pick an appropriate visualization to work with the type of data that we're interested in additional visualizations can be added through panel plugins and then how you actually tweak the behavior of the visualization is through the panel options so just through this dashboard we've introduced the first two types of plugins that we're going to talk about and if we look more closely at data sources the three primary capabilities of a data source come down to like these things firstly the ability to configure a connection to a given service like a database uh that can be things like passing an or token alongside the requests or selecting a cloud region and then once you have that connection providing the mechanism to construct a valid query and actually issue the request and finally when you get the response you need to be able to convert it into a consistent data format so it can then be used by all of those different visualizations right through a data source and this was kind of alluded to with our big 10 philosophy philosophy uh you provide the ability for grafana to get data from anything whether that's something with a rest API websocket whether it's like a Spoke within your or publicly accessible doesn't matter and the great thing is you can leave your data where it lives today without having to migrate it if we look at the capabilities in a bit more detail so this is how you actually configure a connection and say your underlying service needs the user to authenticate before they can retrieve data or you want to provide customization on the connection itself the way you do this is through the config editor and by the way we'll make all these slides available so if you can't see things in detail don't worry you'll be able to see it later uh this is an example of the config editor this is from the promethus STA source and one of the custom things that you can do here is you can change the scrape interval so this is how users interact it when they create a new data source instance in grafana the actual request to the service can be defined either in the front end or the back end of your data source Marx will discuss that a little bit later I'm going to focus a little bit more on the user facing aspects so the other main user facing aspect of the data source is the query editor so this is what shows when you're in a panel edit as I was before or you're in the explore view it can be a simple Monaco code editor or you can provide a builder you can do things like autoc complete links for help there's loads that you can do to kind of make it easier for the user to construct a valid request uh in the data source you transform the response into a consist assistant data format which we call data frames we're not able to go into too much details on these but I have links and docs uh that you can go to to get started again they're defined in the front end or the back end and as part of actually handling the query itself and we provide helper functions which allow you to make this site really easy so you can struct the data frames no matter what format your target data is in now you got the data you want to visualize it and this is where panels come in so if there's a visualization type that's not already covered in the panels that we have or you want to do something bespoke interactive in the front end uh maybe not even relating to querying a data source you can just have it as a widget uh you can create a panel plugin going back to the dashboard from before two main features the visualization and the options to configure it so for your visualization using the props you can basically react to the changes in the sizes of a panel within a dashboard as well as like the query being passed from the data source to the front end and then you can use this information to craft an appropriate means to display something to the user this is a really simple example from create plugin that just creates a circle then to actually allow users to configure how the visualization behaves so like if you've got thresholds defined how you want to change the behavior there you do that through panel options this is usually defined in the module TS file and that is the entry point for any plugin so that's the first thing that loads the third type of plugin which we've not yet covered and gets a bit more interesting is apps so apps are somewhat special in terms of their flexibility but you can kind of think of apps as providing these three distinct features so firstly you can create completely custom Pages which are accessible from the gra navigation and you can use our scenes Library so you've seen this is starting to get used in dashboards as the new way that we actually render dashboards um secondly within the application you can create multiple components so your app can include a data source and X number of panels but you distribute it as a single binary or a single artifact um but all of those subcomponents exist as they would if they were externally published so they're generally available within grafana and within your app and finally this is a relatively recent Edition which which we quite like uh UI extensions so this is where an application can register its functionality to different parts of the grafana UI and other plugins so you basically expose your functionality within a user's current context uh examples of this are like the incident amp so if you're in a panel through the panel menu you can declare an incident from there and then it gets the link to that panel straight from the point of creating the incident so it kind of jump stats jump starts the creation of these things but also provides good breadcrumbs to users of what's important uh this is an example of one of the custom pages from our front end observability app and this is using scenes so you can see some of the features that you get like tabs for organizing the content you've got the time picker up at the right so you kind of get dashboard like experiences and they're really easy to build just using the scenes Library uh as I mentioned so apps can either leverage or depend on an external data source or you can bundle it all within the app itself we call this nested plugins this shows what it kind of looks like from a folder structure you have the data source folder it has its own plugin Json so that's the definition of any plugin within the app itself we also have a plugin Json for the app then grafana will load these uh as individual plugins apps can also include a custom backend component and this basically gives you the ability to write any API request you like uh so you can grab data you can issue a command some of the examples that we have are using as like a wrapper for another API server so this is how the ml app works for example finally we have UI extensions so this is just to actually show you what this looks like today so if you go to the explore page we've made the add button uh an extension point so any application can register functionality there so any query that gets executed and explore can then be used to jump start a workflow from an extension point so you can create a forecast based on the data you can detect outliers you can declare an incident right now we're going to head over to Marcus to talk about Anatomy cool um so let's talk a bit about the anatomy of a pluging um so uh all plugins has a plugin. Json file and it's basically a static metadata information file that contains um all the information necessary to to run and to uh work with the plugin uh in this illustration we have a frontend only data source so um as in addition to what David mentioned earlier with the query editor and the config editor we also have a check health and a query data H functionality uh the check health is being used to verify that the plugin is correctly configured and working as expected and the query data is used to run the query that user has defined in the query editor um then we have a data source with backend so they are similar uh the only difference is that we only have the query the query editor and the config editor on the front end and you implement the check health and the query data in the back end in addition if you have a backend you can also add something that we call uh that we call call resource and it's basically uh a capability to um provide custom endpoints so things such as Provide support data to uh build your query editor or yeah whatever could be needed uh then we have panel plugins um so it's only implemented on the front end uh it has two main components so it's the panel itself which visualize data and then I have panel options which DAV mentioned so everything you need to be able to uh configure that panel how it's going to behave and how it's going to visualize the data uh then we have frontend only apps so um there we only have a a root page which is the page that user can end in if you want to have custom navigation this is where you define it uh and then I have a config page and it's basically just to be able to configure the app and enable or disable it um you can also have uh plugins uh app plugins with backend so it's basically the same thing uh you have the root page the conf page on the font end but in addition you have check health and you also have the call research fun call resource functionality uh which you can use to provide Uh custom end points for your front end part uh so now we have some basic understanding on the different parts uh of plugin so to speed up development and to have a consistent UI and to be able to share functionality with in grafana but also with all of the plug-in developers external to grafana we have the grafana packages so we have grafana UI H it's basically a component Library consisting of small to medium siiz UI building blocks um we use it internally to build grafana so if you use it you kind of automatically have the same look and feel as grafana uh then we have the graphon data package which contains shared types and structures um it contains core functionality such as um data frame support and value formats and finally we have the grafana run time uh it provides functionality and information about the current running grafana instance uh one example would be to use the data source SRV to uh fetch all the current configure and installed uh data sources from the current running Gana instance so do I need a backend for my plugin uh it depends so if you're building a panel plugin uh you don't need that since you're only working in front end uh if you are uh targeting apis that you want to communicate with in the plug-in that are uh that can be connected from a browser then you might not need an back end uh but if you want to enable for example graan alerting or you want to connect to some API that doesn't really can that can be connected from the browser or if you want to H keep State between users um use some Custom Security checks that we don't support out of the box um or provide custom endpoints uh then you need a backend uh I guess the only drawback with having a back end is that you need to write your plugin in two languages so you need to write the front end in typescript and the backend and Goen um so if few shoes have a back endend we also have a building block for that and it's the grafana plug-in SDK SDK go package so it will uh give you a bunch of structure contract and building blocks for for to build backend plugins quickly and easy uh you will get instance management out of the box so you don't have to really care about that grafana will just run the plugin for you uh and you will have a bunch of utility and functionality to uh transform the data that you receive from the Upstream service into Data frames which is really nice uh so let's uh try to create a plugin we're going to do this live so we're going to switch computers uh I prepared something on this computer so let's see if this works see if we get a picture okay cool uh so uh we have a pretty neat tool called create plug-in which you can use to scaffold a plugin uh you just run it by uh typing this in uh in your prompt of your choice uh it's going to ask you a bunch of questions so uh you when you answer the questions we're going to tailor a a plugin to specific to your needs so we're going to call this one demo raon can be the going be an organization demo so I'm going to create a data source I would like to have a back end I would like to have release and CI flows uh we can skip the graphon API comp compatibility stuff so what this going to do is just basically going to create a plugin uh or a template for a plugin uh for you uh so you're basically ready to go uh in the end here you see full instructions on what to do next uh so you get instruction on how to build run and set up your local development environment I've already done that so I'm going to skip this step just to save some time uh so this is my local instance uh I have scaffold a pluging prior to this uh we have also added a some um some uh capabilities to that plugin so it's a it's a data source plugin with a back end uh it won't connect to any external Al data source or data an external Upstream Service uh it will it will generate data directly on the back end just to make it more uh demo proof uh so uh if I go into the demo dashboard I have two panels um and a really simple uh uh data source plug in so um that is up and running so let's see what we have uh what the PL what create pluging has scaffolded for us so I'm G to go into this directory I'm going to open the editor uh can you see the text yeah so I'm not going to go into everything I'm just GNA cover the main parts so in the SRC folder we have the front end part of the plugin in the package folder we have the backend part of the plugin uh in the GitHub slw workflows folders we have the CI and release workflows that are provided for you only available if you version your plugin in in GitHub just so we know that uh then also we are provided uh a bunch of build scripts and all that um but also a doer compose which makes it super easy to run the plugin locally it's going to bring up a Gana instance it's going to pre-install the plugin it's going to enable hot loading and provide a good um developer experience um so let's have a look at the entry point in the front end of the plugin so everything starts in the module. TS and this is basically the same for all plugins um but in this case we are creating a data source plugin um we have implemented a data source instance locally we have implemented a config editor and a queer editor so let's quickly jump into data source so since I uh created a data source with a backend I am extending the data source with backend which will basically give me everything for free so I don't need to implement any logic to connect to the backend it will be provided for me all I need to implement is uh a function which going to return a default query that will be used in the query editor uh and then also I have added a get available data sets function this is optional and I'm going to go into detail about this a bit later uh so let's go back to the Ms and visit the config editor so if we jump over to grafana and we do data source we go into the data source config editor so this is uh the data source config editor for this plugin it's super simple we basically have two sections it's general which provide a Time Field and it's API settings which provide uh the user which is the a secure API key um so why we picked these two is because we have a part of the data that can be available for everyone which is the an one and then we have API settings which is secure and shouldn't be shared um to the front end uh so let's go and see how that looks in code so this is the re component for uh the config editor uh as I said we have two types of data so we are uh we um we have the the general part which is the time field and we have the API settings which contain the API key uh these components here they are imported from the G UI Library so that's why they have that look and feel uh and I think important to highlight here is for um non-secure data you can store it in Json data for secure data you should store it in Secure re data uh the values in secur data obvious yeah aren't provided aren't returned to the clients so we don't really know what value is set so for that we use secur and fields which basically is the key value returning the fields and uh Boolean value whether or not that one is set so in this case we figure out if the secret input is in configure or Not by using the secur and Fields um so when the plugin start I'm going to jump to the back end part uh we have uh this Factory function being called so the secrets are uh passed when the plug-in is started and we are uh using those to load them into a structured mod model that's look similar to the one that we uh basically going to contain the two fields that we defined in the config editor uh then we are referencing referencing that one in the data source instance for later use so it can be used for example when we send the when when we send the a query to the back end or uh when calling check health for example uh if any of the values are uh changed grafana will reinitialize the instance so the new values will be passed to it and it's going to basically start up a new instance U with the latest values so it's going to be cared for so no worries to to store those settings for later use um so if we write something here time and we do da da da da and try to do save and test um we can see that the data source is working so what's happened under the hood is that we have called the check Health functionality in the back end uh it's basically just a go function that you implement in your in your plugin uh this one isn't doing it so much just returning okay but preferably you would check that you actually can connect to your target Service uh you could use the uh the settings that we created earlier to do that um so yeah uh cool so now we have configured a data source uh let's jump back to the to the quer editor so I'm going to go back to the dashboard and we're going to go here so this is again it's a super simple use case and we only have a a queer editor with a dropdown uh it's going to display different uh data sets and when I select here uh it's basically just going to update and rerun the query um so let's jump over to quer editor uh so the queer editor uh also uses the components from gra UI uh yeah and um we used the we have the for that component we will have data source query on change and on- run query pass to it so these are uh props that we're going to use in this component uh every time we change the data source change the value of the dropdown we're going to call the unchange data set with a new value uh and then we're going to create a new query using the old values with the new value and then execute the query um also what you can see the options here they are being fetched from used data sets so uh used data sets are using the data Source if we jump to that one we can see that uh that we are uh calling the get available data sets which I talked about earlier and this one is using a custom resource so it's going to call the SL data sets which is implemented in the back end to fetch that data to to use it in the query editor um so let's quickly have a look how that look so here we're creating uh we're connecting the data sets endpoint with the handle data sets request function uh again super simple function we are just returning uh the list of available data sets and shipping it back to front end but here you can imagine that you maybe would query the Upstream service to feed out like what's available schemas that can provide for query editor so I can provide a good experienceing writing queries um and then finally when we have created the query uh we have the query data function so the query data it's what's been called when you execute the query gra G to pass the query from um from the panel in this this case we create a response uh we run the query and then we return it I'm going to jump quickly into the Run query uh just to see because that's where the interesting bit's happening uh so we are uh parsing the values from the query into a quer model uh then we are using that query model to create uh the fake data that I thought about um using uh the query that I the value that I created in query so data set we either create uh time series table or I also have log frames uh in this case uh we have a look at the table frame and this is a super simple example of how you can create data frames so you add fields to it you add the values and then you create a frame give it the name and pass it to Fields um so I think this is the final part of the demo so I'm going to hand over to you David so you're GNA wrap this up there we go so create plugin is the tool that Marcus used to scaffold uh a new data source and basically this allows you to run single command down there MPX saoner create plugin at latus you can create a new data source new panel new application it provides out of the box Docker composed development environment so whenever you make a change in the front end or the back end we'll do an automatic rebuild and reload so it's really easy to do fast iteration uh it includes l everything you need out of the box including testing libraries for unit tests and end to end tests sneak preview to what we're going to talk about in a second and GitHub actions to make it easy to do CI and actually release a new version so this is going to be very quick apologies we're going to have to uh Blitz through this one thing that we released on Friday because is really fun to release major versions of things on a Friday afternoon uh plugin e2e is now version 1.0 so this is a brand new library for scaffolding end to end test for plugins it's based on the open source Tool uh the framework playwright and it makes it really easy to build plug like tests which will Target multiple versions of grafana catering for the changes in graff's UI between those versions so you can ensure that your plugin continues to work against multiple releases in grafana we're using this internally we're really excited about it a huge shout out to Eric who's been instrumental in driving this forward uh so as I say you have a look at the docs we've hopefully got stuff to help you get started uh there's some Advanced topics that you might want to consider once you've got this basic plugin running I have to just kind of skip through these apologies but we'll make the slides available one or two minutes but that's not precise I mean can be PR no no that's good so very quickly template variables make it easy to kind of like build that interactive experience if you saw Chris's talk um you did a good job of showing that uh makes it easier to share dashboards so you can have a template variable on a server name and then have have a very generic uh dashboard that can be used across places macros similar to template variables but they're executed on the back end and it makes the query more Dynamic so you can respond to like changes in the time picker so like what is your dashboard meant to be looking at alerting you literally just have to add back end equals true alting equals true in your plugin Json and you're good to go uh UI extensions we've covered plugins can also bundle dashboards so if you have a sample dashboard that makes it easy to use your data source you can ship that as part of your plugin then users can import it uh provisioning We've recently built on more in create plugins so this um basically allows you to have everything you need to run endtoend tests or have like a realistic workflow installed in that Docker environment if you do that we can use it as a test environment when you submit it to the catalog it makes our test times a lot shorter so things get published faster speaking of the catalog um why would you do this once you've got a plugin you want to share it with the world you want to make it easy to install by every one you can submit it to the grafana plugins catalog for your graana.com account uh when you do this it gets reviewed by our team so we'll make sure it's not doing anything too dangerous or if it's like going to provide a good user experience um it then makes it more easy for folks to install it and to find it and hopefully collaborate it's very easy to do uh you can package it as a zip using the release workflow that we talked about you submit it using that button and then you sign it if you wanted to talk about signatures come chat to me or read that Doc and very quick reference things new documentation we really do recognize that our docs needed Improvement and we will continue to work on that if you have missing content come yell at me I will make it happen but we have a new developer portal we're putting everything there includes our new design system which has recently been launched so if you want to see how grafana recommends you build UI you can follow the same patterns that we're using today uh includes story book for all the UI components inle f Y and the scenes documentation more links go find them later there we go just about on time come chat to us [Applause]

