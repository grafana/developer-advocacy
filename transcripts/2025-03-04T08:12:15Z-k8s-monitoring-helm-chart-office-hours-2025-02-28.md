# k8s-monitoring Helm chart Office Hours 2025-02-28

In the February edition of the Kubernetes Monitoring Helm chart office hours, we discuss the recent updates to version 2.0 and the ...

Published on 2025-03-04T08:12:15Z

URL: https://www.youtube.com/watch?v=bWiDdHSWhiI

Transcript: hi everybody Welcome to the February edition of the kubernetes monitoring Helm chart public office hours uh I'm Pete wall uh the lead engineer on this project I'm super excited to be talking to you today about uh what we've been up to over the past month uh about what uh what's coming up in the future um and special guest so more on that later so uh the agenda like typical we're going to talk about what we've been doing in the version 2.0 timeline or the version 2.0 train I guess um we'll talk a little bit more about what's going on in version 2.1 hopefully to be uh we'll get some more details on about that um and I also brought special guest my friend basil captain jiv from uh from also from grafana uh and he's going to talk about how the kubernetes monitoring Helm chart enables kubernetes monitoring within graphon cloud and uh and then we'll have some time at the end for Q&A uh so KU monitoring Helm chart B2 what's been happening uh there's been a lot of kind of Maintenance fixes a lot of behindth scenes stuff um some of the things that I really want to call out uh alloy receiver so if you are using uh the application observability feature or any of the other features that use the receivers uh concept you're familiar that we have the separate alloy instance called alloy receiver uh the alloy receiver got an extra service feature what that means is if your applications are already configured to to go to a certain name a certain service inside of your cluster now you can deploy an extra service that that mimics the one that Alo receiver has what does this mean this means that if uh like I said if you have applications that are already configured to go to a certain open Telemetry endpoint you don't have to redeploy all your open your applications you can deploy this extra service feature that matches the name of that uh the the older older endpoint uh and you can already start putting stuff into the kubernetes monitoring Helm chart to that just helps with uh people who are doing migrations if you're upgrading from an earlier version of this own Helm chart or if you're migrating from a different system uh or if you just want to have something that's a little more consistent with your environment uh this is a great service for them uh service Integrations uh we didn't necessarily add cord DNS but I added an example and an integration test that shows how you can monitor your cord DNS uh services within your cluster uh actually using something in the cluster metrics feature U but uh but that's really exciting to get in there um and also we have finished the full integration for the lgtm stack so if you are running grafana Loki Tempo mamir within your cluster you can set up the service Integrations to monitor how those systems are behaving uh this is great for people who are running you know large open source distributions of those or if you're running P Enterprise and you want to understand the health of those uh now you can add that those Integrations from within the uh the K monitoring elter uh open shift platform test this one probably is only exciting for me but I'm super excited about it so uh if you know we do a very large suite of automated tests against this Helm chart because we want to ensure that it's of the best quality uh we do a lot of automated tests against kind clusters which are you know auntu amd64 pretty standard clusters but we do have platform tests that go against Cloud providers to test the specific uh the things that are different about those specific Cloud providers we want to make sure that things will work well uh no matter what kind of kubernetes cluster that you're using and open shift is a pretty particular kind of cluster it uses a lot of extra security context and things like that to make sure that everything within the cluster is going very healthy and secure it's kind of a secure by default cluster so it's kind of a tricky one to deploy correctly onto so I'm really excited that now we have platform test support for that so we can automatically test the helm chart against open shift clusters and make sure that that is going to stay healthy and reliable for uh for from from now on um and then as always tons of dependency updates uh alloy itself BR just released 1.7 uh and so now the helm chart's going to release alloy 1.7 there's some really exciting features in there that I hope to play with um probably even today but over the coming weeks um and then tons of extra bug fixes that's what's happening in the 2.0 uh again the preview for 2.1 unfortunately I still don't have a nice timeline date for that uh the upcoming features that we're looking to add here again uh if you last month's update it's going to be pretty similar to that uh tail sampling service graph metrics the idea here is can we take the trace day that you are ingesting from your applications and do some really interesting stuff with them before sending them off to your destination um there's some figuring out to be done as far as how to best lay out the topology to to do all this calculations um and so that's one of the reasons why we're taking some time on this we just want to make sure that no matter what we build no it you know it meets the functionality but it also is a sustainable and scalable solution uh Dynamic alloy instances uh the thing that you will see as users of this Helm chart what what this will mean for you is that it's going to be much less Bose inside of the values file when you're trying to Define how do the different alloy instances that we deploy what do they look like there's going to be a lot less in your face you think about how we changed from V1 and the values file was you know over a thousand lines long now it's in the hundreds I'm hoping to bring that down maybe even under 100 lines um just make it a lot more user friendly to understand what's what what you are deploying and then more service Integrations uh since the last office hours we had a request for ISO I think that's a really great idea I can I'm not promising with any particular service integration as always we do a lot of our development based on what people are asking for so please talk to us in the public grafana uh slack channels or open issues on the it repo and uh you know that's how we really Drive what our road map looks like all right so without further Ado I'm going to pass it off to Vil uh visil uh I guess I'll thr the slides you just let me know but uh yeah visil and worked together for for many years uh and I'm really excited that he's here to talk about how kubernetes monitoring is enabled by the kuber monitoring onart fantastic thank you very much Pete so I'm here and I would like for us to play a game the game is called I'll give you some and you'll give me some back I'm going to show you what uh we are Brewing into kubernetes monitoring and out ask in return for your opinion everyone here in the meeting room and the people you people in YouTube that will be eventually watching uh watching this please comment in the comments if you like the features that I'm going to present or if you dislike them or you have ideas or anything I will personally come in and uh try to answer them all and if I'm not able to I ask Pete because he was being being a part for kubernetes monitoring squad for so much time so you hear either from me or from Pete and if you're watching this on YouTube or for all of the uh perfect people here uh that are already here you want to hear from him so this is the least that I can promise on his behalf so what I'm here for is to change your perspective and I hope that I'll be able to you never look at your terminal the same way after these two slides want to bet so we have we have at least 360 reasons to pair it with the cornetes monitoring in graan Cloud so your terminal with a UI sounds crazy maybe let's see how it goes speed can we go to the next slide where we're going to go out of the marketing G stuff and into the real world it's a little rectangle that we have designed and the little menu on the left hand side of grafana of monitoring ingr Cloud that enable us doing so it's called the search it's not a really Innovative name but this is what it does it searches so imagine a situation and if I can get some control for some live demo because why not let's try and break the helm chart office hours the first time we're in it want to take it all right yes please thank you uh send request screens screens there we go so please tell me once you're able to see my screen all good I wouldn't be a PM if I don't do a live demo so this is kubernetes monitoring in grafana cloud in the left hand side menu it's just under the cloud provider that I will try to talk just a little bit as a surprise toeat later on but we go to kubernetes and I'm like okay what should I do here it's nice I see it I see the alerts I see the trending memory CPU all of these things I know about them I'm a kubernetes moning Enthusiast but what what can I do imagine that I open a terminal now I don't have one because of this icon don't ask me why it's there but imagine that I W to search for everything Kafka and I type in my terminal I find some I don't find some others but what if I just type kka here oh not Kafka but Kafka nope Kafka I said there we go so everything from the workload to the port to the container that it is Kafka related and when I click on it I go into an insides view the insights view provides me everything that you know about so you go you you do uh uh Cube describe pods you get a pod's name you paste it into kubernetes monitoring in graphon cloud and you end up here you can see everything without having to uh put in more commands or do whatever so it's like a love relationship between your terminal and kubernetes monitoring finally I'll show you assertation assertation is a fancy word for alerts transferred into spans so I come here I click on troubleshoot and workbench and here we go we have this little nice pod that is struggling like hell with its exist it's a failure it's an active controller it have been it has been gone for the last hour and you can see everything about it if you open the kpi there will be a lot of no data but you can get everything from logs here are the logs traces if there were traces there would be traces even some of the kubernetes things that I shown you and further down the line AF cluster kpi so many things and I did it only with one place from my imaginary terminal going into the search and ending into this RCA workbench so I'm going to stop the live demo lower down the pressure and come back to the slide speed I'm on it thank you so much there you go next slide please our second star or maybe uh ACDC Thunder is storage observability if you haven't seen it till now it's already there we have it for clusters nodes for PS every everywhere you can see storage and you can also compare the different uh the different volume bites to uh the to PVC we have so many any nice goodies there and you can also check it at play. graana.com so you can see it real life I'll paste it in the chat and repeat play. graana.com don't forget to dock the left hand side menu click on kubernetes monitoring and then at every level you have storage as the top on top and you'll be able to solve one of the trickiest problems I would say in kubernetes and this is managing uh managing your uh your storage with all of the PVC volumes in it that was everything apart from the little uh surprise that I had Pete can we do an improve an improvisation can you go to graana.com please sure as you're sharing thank you see just one more second and we're done on the top menu there is Solutions yeah yeah and in the middle on the monitor infrastructure and if you're infrastructure Enthusiast apart from kubernetes ra now offers Microsoft isure Google cloud and old friend AWS observability out of the box go check them out see what is there but the tldr is it is better than what the different Cloud providers offer out of the box for their monitoring and we hope that it will give you these 10 20% uh more from being good to being great that was uh that was me thank you very much Pete for having me and thank you very much everyone for listening to me so um I'll start with one of the first questions so there's some really cool stuff that you showed here vasil um would you say I mean because this is my office hours this is the kubernetes monitoring Helm chart office hours would you say that that's all that stuff in graphon Cloud was enabled by just deploying you know someone's got a kubernetes cluster they want to see that sort of stuff what would they have to do to actually start getting that data into graphon Cloud fantastic question it is extremely hard to tailor all of the different exporters to uh tailor all of the needed metrics to bundle these with all of the different queries to have a comprehensive solution it took us more than two years to have this together and this is all glued or all powered by the kubernetes monitoring Helm chart it may sound like an advertisement but it's actually not it's an engineering effort and success that we had and if I go back like an year and a something uh we were like all screaming in Joy when uh we found out that this is actually possible without having to do it again and again and again every single time when you add like three new visualizations for example when you add Network and storage metrics and visualizations what are we going to do and now with the kubernetes monitoring Helm chart is just several clicks of a button like you update your kubernetes monitoring Helm chart and that it if you want to instrument like 50 more clusters and 10,000 uh work uh nodes you just go ahead get the Helm chart get it in it gives you absolutely everything uh what does it get you beat it gets you C advisor it gets you cuet it gets you cost metrics it gets you uh what else it gets you B what more node exporter Cube State metrics all of your cluster information you know service Integrations out of the box you one of the things that um I'm quite proud of you know I think the alloy is an incredible Tool uh but one of the things that I try really hard to use with the kubernetes monitoring Helm chart is making it so that uh the users of this chart really don't have to think in terms of configuration files they can just think about what do they want to do and you take those intentions you turn that into the you know the the commands to the helm chart and it just takes care of that for you so you talk about enabling like the storage information or just you want a couple extra metrics how do I make it extremely easy to just say I just I want what I've got but I want a few extra metrics and I don't want to have to think in terms of config files I just want to go to where it says you know include metrics and just add it to the list so absolutely and at the end of the day if you have a huge Department of people or you have extremely complex visualizations that you need to power in kubernetes monitoring we believe that we have distilled some comprehensive visualizations alerting in the bubbling up the signals from the noise the perfect way to just power them is with with the helm chart you don't have to tailor all of your metrics and have no data shown or bad actually no data is better having bad data shown in your visualizations that is not accurate what do you do with that yeah amazing thank you so much Vil I really appreciate you coming on and talking about what sort of things we can do with the kubernetes monitoring Helm chart Beyond you know what might be the obvious you know what are some of the really cool things that we are enabling kind of on the visualization side of that so I'm really excited uh that you got to join in and uh be the first guest for the kuber bounding Helm chart office hours that's amazing um so I'd like to start into our Q&A section um so if you've got a question feel free to you know unmute and ask it live um I do want to highlight there was one uh there's been a few that have showed up in the chat most of them seem to be answered there's one that Rob asked which is does the lgtm stack integration is that a suitable alternative to deploying the lgtm service monitors for each Stacks chart um in my opinion yeah so one of the things with the with the kuber monitoring Helm chart we try to make it flexible so if you want to continue using service monitors that's fine we have the option to to discover and scrape metrics based on service monitors um you can do it by annotations on pods and services we we really try hard not to force you down a single path as far as how do you want to ingest metrics or logs or anything like that um that being said I do believe that using the built-in service Integrations for the lttm stack is better than just using the service monitors uh and that's for a number of reasons the first reason is we can have built into the helm chart some post-processing rules for those metrics we can understand what's the the the kind of the default set of metrics that you need you might not need every single metric that mamir uh emits to you know from itself uh you you we just care about the ones that are going to show you what's the health of mimir at this time and so the kubernetes monitoring Helm chart makes it easy to just filter down to the subset of metrics that you care about same thing for the other lgtm deck the other thing that I think really makes the the built-in service integration stronger is that we also understand that if you're Gathering the the logs from all of the pods we can un we can flag which ones are coming from the mimir pods or the lowkey pods or something like that and then we can do some additional processing on the logs that we discover from those pods and so we know that these logs are coming in from Loki we know the format of logs that is coming from Loki and so we can do additional processing to uh kind of enrich the metadata that's coming from it we know what the log levels are going to be we know other settings coming from that log data so ultimately when you see the logs from Loki it's going to have a much better experience it's going to have better understanding about what the content of those logs are coming through um and and I think that that's those reasons make the built-in service Integrations a little bit stronger than service monitors uh but again if service monitors are what you're using in your ecosystem I'm not telling you you shouldn't use those or you can't use those um but it's just these are the options that we have available to us all right any other questions this I'll make you ask your question live definitely uh I'm sure that the people will benefit if you uh say a little bit more about Open shift sure what is that thing that makes open shift so special for the helm chart and not like nice vanilla kubernetes right right so open shift uh like I said a little bit earlier open shift is kind of a special kubernetes platform it is kubernetes but it's kubernetes that's built from the ground up to have enhanced security levels uh you can't just throw a pod into your cluster uh and you know expect that it's going to run well because if your pod uses any sort of elevated privileges you need to also declare along with that OD I am allowing this to have special privileges it has a lot of understanding about uh mapping name spaces to projects uh and mapping users of your cluster to those projects and stuff of that so it's really built for kind of Enterprise users of kubernetes um how do you how do you use kubernetes but how do you use kubernetes in a secure way uh in a way that works for all of your developers um there's a lot of great things about open shift with that said developing applic that run on open ship can be a little bit challenging uh the security contexts that are required for that uh the ways that uh open shift tries to kind of tighten down on privileges uh it makes it a little bit challenging to run uh certain applications if you're uh a devops person who deploys a lot of stuff onto kubernetes you'll you you often see actually instructions and here's how you deploy your you know my XYZ widget onto kubernetes and there's actually a second page of documentation for oh and if you're running open shift here's how you do it because there's enough different that often you'll see two sets of instructions now like I said one of the things that's really important for us at grafana for the kubernetes monitoring Helm chart is we try to make it as simple as possible as as easy as possible and um you know if I may say delightful to use this Helm chart and so one of the things that we do is as best as possible we detect that you're running on open shift clusters and if you are we try to automatically deploy all of the necessary security context constraints uh any of of the other modifications uh to run the helm chart in the best way possible on open shift clusters another example open shift often deploys its own monitoring systems so the open shift clusters will have CBE State metrics it will have node exporter already on the system so why should the kubernetes monitoring Helm chart deploy those that's just duplicating the efforts so in the open shift cluster context we recommend that you turn those off that you utilize the ones that are already there uh and we make it easy to show you how to do that that's one of the reasons also why we build a lot of examples in the GitHub repository to show how you do that sort of stuff so excellent any other questions so there's some comments from Andre Andre is saying that uh sometimes it's hard to understand some of the deeper options for example the include metrics for CBE State metrics some of the Affinity uh or spreads for uh the alloy instances and some more complex examples would be helpful that's a great feedback I appreciate that um he's saying also that there are some alloy modules configured in the config map it's not straightforward to understand how to use them in the extra config section uh yeah that's great feedback thank you um the examples section within the GitHub repo uh I try to make that easily discoverable but also kind of showing as many actual real world usages of these different features um something like Affinity note affinity that would be a great one to include uh we have an example for the V1 version that talks about setting things like include metrics uh I will make sure that we have an appropriate one for v2 yeah any other questions great thank you so much for joining uh I've had a lot of fun thank you so much Vil for coming again uh and uh and yeah I really appreciate it oh got I the last slide there we go um as always we are very Community Driven uh you can find us in the kubernetes channel on the public graan slack channel g.s slack.com uh if you have comments or questions you can find us there ask them there uh otherwise the GitHub repository grafana Kates monitoring Helm uh please come and interact with us ask ask questions open issues open feature requests uh we're a very community-driven project we want to make sure that whatever we build is uh useful and helps you be more productive uh so that's really our main intent thanks again for joining I really appreciate it uh and we'll see you next month take care everybody byebye

